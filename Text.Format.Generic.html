<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Format.Generic</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Format strings for Printf and Scanf</a>
<a id="145" class="Comment">------------------------------------------------------------------------</a>

<a id="219" class="Symbol">{-#</a> <a id="223" class="Keyword">OPTIONS</a> <a id="231" class="Pragma">--without-K</a> <a id="243" class="Pragma">--safe</a> <a id="250" class="Symbol">#-}</a>

<a id="255" class="Keyword">module</a> <a id="262" href="Text.Format.Generic.html" class="Module">Text.Format.Generic</a> <a id="282" class="Keyword">where</a>

<a id="289" class="Keyword">open</a> <a id="294" class="Keyword">import</a> <a id="301" href="Level.html" class="Module">Level</a> <a id="307" class="Keyword">using</a> <a id="313" class="Symbol">(</a><a id="314" href="Level.html#512" class="Function">0ℓ</a><a id="316" class="Symbol">)</a>
<a id="318" class="Keyword">open</a> <a id="323" class="Keyword">import</a> <a id="330" href="Effect.Applicative.html" class="Module">Effect.Applicative</a>
<a id="349" class="Keyword">open</a> <a id="354" class="Keyword">import</a> <a id="361" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="376" class="Keyword">using</a> <a id="382" class="Symbol">(</a><a id="383" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="387" class="Symbol">)</a>
<a id="389" class="Keyword">open</a> <a id="394" class="Keyword">import</a> <a id="401" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="416" class="Symbol">as</a> <a id="419" class="Module">List</a>
<a id="424" class="Keyword">open</a> <a id="429" class="Keyword">import</a> <a id="436" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="452" class="Symbol">as</a> <a id="455" class="Module">Maybe</a>
<a id="461" class="Keyword">open</a> <a id="466" class="Keyword">import</a> <a id="473" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="487" class="Keyword">open</a> <a id="492" class="Keyword">import</a> <a id="499" href="Data.Product.html" class="Module">Data.Product</a>
<a id="512" class="Keyword">open</a> <a id="517" class="Keyword">import</a> <a id="524" href="Data.Product.Nary.NonDependent.html" class="Module">Data.Product.Nary.NonDependent</a>
<a id="555" class="Keyword">open</a> <a id="560" class="Keyword">import</a> <a id="567" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a>
<a id="581" class="Keyword">open</a> <a id="586" class="Keyword">import</a> <a id="593" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="610" class="Keyword">import</a> <a id="617" href="Data.Sum.Effectful.Left.html" class="Module">Data.Sum.Effectful.Left</a> <a id="641" class="Symbol">as</a> <a id="644" class="Module">Sumₗ</a>
<a id="649" class="Keyword">open</a> <a id="654" class="Keyword">import</a> <a id="661" href="Function.Base.html" class="Module">Function.Base</a>
<a id="675" class="Keyword">open</a> <a id="680" class="Keyword">import</a> <a id="687" href="Function.Nary.NonDependent.html" class="Module">Function.Nary.NonDependent</a> <a id="714" class="Keyword">using</a> <a id="720" class="Symbol">(</a><a id="721" href="Function.Nary.NonDependent.html#1531" class="Function">0ℓs</a><a id="724" class="Symbol">;</a> <a id="726" href="Function.Nary.NonDependent.Base.html#2330" class="Function">Sets</a><a id="730" class="Symbol">)</a>
<a id="732" class="Keyword">open</a> <a id="737" class="Keyword">import</a> <a id="744" href="Function.Strict.html" class="Module">Function.Strict</a>

<a id="761" class="Comment">------------------------------------------------------------------------</a>
<a id="834" class="Comment">-- Format specifications.</a>
<a id="860" class="Comment">-- Defines the supported %-codes.</a>

<a id="895" class="Keyword">record</a> <a id="FormatSpec"></a><a id="902" href="Text.Format.Generic.html#902" class="Record">FormatSpec</a> <a id="913" class="Symbol">:</a> <a id="915" href="Agda.Primitive.html#326" class="Primitive">Set₁</a> <a id="920" class="Keyword">where</a>
  <a id="928" class="Keyword">field</a>
    <a id="FormatSpec.ArgChunk"></a><a id="938" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a> <a id="947" class="Symbol">:</a> <a id="949" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="FormatSpec.ArgType"></a><a id="957" href="Text.Format.Generic.html#957" class="Field">ArgType</a>  <a id="966" class="Symbol">:</a> <a id="968" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a> <a id="977" class="Symbol">→</a> <a id="979" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="FormatSpec.lexArg"></a><a id="987" href="Text.Format.Generic.html#987" class="Field">lexArg</a>   <a id="996" class="Symbol">:</a> <a id="998" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="1003" class="Symbol">→</a> <a id="1005" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1011" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a>

<a id="1021" class="Keyword">module</a> <a id="1028" href="Text.Format.Generic.html#1028" class="Module">_</a> <a id="1030" class="Keyword">where</a>
  <a id="1038" class="Keyword">open</a> <a id="1043" href="Text.Format.Generic.html#902" class="Module">FormatSpec</a>

  <a id="1057" class="Comment">-- Left-biased union of format specs.</a>
  <a id="1097" href="Text.Format.Generic.html#1097" class="Function">unionSpec</a> <a id="1107" class="Symbol">:</a> <a id="1109" href="Text.Format.Generic.html#902" class="Record">FormatSpec</a> <a id="1120" class="Symbol">→</a> <a id="1122" href="Text.Format.Generic.html#902" class="Record">FormatSpec</a> <a id="1133" class="Symbol">→</a> <a id="1135" href="Text.Format.Generic.html#902" class="Record">FormatSpec</a>
  <a id="1148" href="Text.Format.Generic.html#1097" class="Function">unionSpec</a> <a id="1158" href="Text.Format.Generic.html#1158" class="Bound">spec₁</a> <a id="1164" href="Text.Format.Generic.html#1164" class="Bound">spec₂</a> <a id="1170" class="Symbol">.</a><a id="1171" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a>  <a id="1181" class="Symbol">=</a> <a id="1183" href="Text.Format.Generic.html#1158" class="Bound">spec₁</a> <a id="1189" class="Symbol">.</a><a id="1190" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a> <a id="1199" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="1201" href="Text.Format.Generic.html#1164" class="Bound">spec₂</a> <a id="1207" class="Symbol">.</a><a id="1208" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a>
  <a id="1219" href="Text.Format.Generic.html#1097" class="Function">unionSpec</a> <a id="1229" href="Text.Format.Generic.html#1229" class="Bound">spec₁</a> <a id="1235" href="Text.Format.Generic.html#1235" class="Bound">spec₂</a> <a id="1241" class="Symbol">.</a><a id="1242" href="Text.Format.Generic.html#957" class="Field">ArgType</a> <a id="1250" class="Symbol">(</a><a id="1251" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="1256" href="Text.Format.Generic.html#1256" class="Bound">a</a><a id="1257" class="Symbol">)</a> <a id="1259" class="Symbol">=</a> <a id="1261" href="Text.Format.Generic.html#1229" class="Bound">spec₁</a> <a id="1267" class="Symbol">.</a><a id="1268" href="Text.Format.Generic.html#957" class="Field">ArgType</a> <a id="1276" href="Text.Format.Generic.html#1256" class="Bound">a</a>
  <a id="1280" href="Text.Format.Generic.html#1097" class="Function">unionSpec</a> <a id="1290" href="Text.Format.Generic.html#1290" class="Bound">spec₁</a> <a id="1296" href="Text.Format.Generic.html#1296" class="Bound">spec₂</a> <a id="1302" class="Symbol">.</a><a id="1303" href="Text.Format.Generic.html#957" class="Field">ArgType</a> <a id="1311" class="Symbol">(</a><a id="1312" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="1317" href="Text.Format.Generic.html#1317" class="Bound">a</a><a id="1318" class="Symbol">)</a> <a id="1320" class="Symbol">=</a> <a id="1322" href="Text.Format.Generic.html#1296" class="Bound">spec₂</a> <a id="1328" class="Symbol">.</a><a id="1329" href="Text.Format.Generic.html#957" class="Field">ArgType</a> <a id="1337" href="Text.Format.Generic.html#1317" class="Bound">a</a>
  <a id="1341" href="Text.Format.Generic.html#1097" class="Function">unionSpec</a> <a id="1351" href="Text.Format.Generic.html#1351" class="Bound">spec₁</a> <a id="1357" href="Text.Format.Generic.html#1357" class="Bound">spec₂</a> <a id="1363" class="Symbol">.</a><a id="1364" href="Text.Format.Generic.html#987" class="Field">lexArg</a>  <a id="1372" href="Text.Format.Generic.html#1372" class="Bound">c</a> <a id="1374" class="Symbol">=</a>
    <a id="1380" href="Data.Maybe.Base.html#2035" class="Function">Maybe.map</a> <a id="1390" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="1395" class="Symbol">(</a><a id="1396" href="Text.Format.Generic.html#1351" class="Bound">spec₁</a> <a id="1402" class="Symbol">.</a><a id="1403" href="Text.Format.Generic.html#987" class="Field">lexArg</a> <a id="1410" href="Text.Format.Generic.html#1372" class="Bound">c</a><a id="1411" class="Symbol">)</a> <a id="1413" href="Data.Maybe.Base.html#2365" class="Function Operator">&lt;∣&gt;</a>
    <a id="1421" href="Data.Maybe.Base.html#2035" class="Function">Maybe.map</a> <a id="1431" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="1436" class="Symbol">(</a><a id="1437" href="Text.Format.Generic.html#1357" class="Bound">spec₂</a> <a id="1443" class="Symbol">.</a><a id="1444" href="Text.Format.Generic.html#987" class="Field">lexArg</a> <a id="1451" href="Text.Format.Generic.html#1372" class="Bound">c</a><a id="1452" class="Symbol">)</a>

<a id="1455" class="Keyword">module</a> <a id="Format"></a><a id="1462" href="Text.Format.Generic.html#1462" class="Module">Format</a> <a id="1469" class="Symbol">(</a><a id="1470" href="Text.Format.Generic.html#1470" class="Bound">spec</a> <a id="1475" class="Symbol">:</a> <a id="1477" href="Text.Format.Generic.html#902" class="Record">FormatSpec</a><a id="1487" class="Symbol">)</a> <a id="1489" class="Keyword">where</a>

  <a id="1498" class="Keyword">open</a> <a id="1503" href="Text.Format.Generic.html#902" class="Module">FormatSpec</a> <a id="1514" href="Text.Format.Generic.html#1470" class="Bound">spec</a>

  <a id="1522" class="Comment">------------------------------------------------------------------------</a>
  <a id="1597" class="Comment">-- Basic types</a>

  <a id="1615" class="Keyword">data</a> <a id="Format.Chunk"></a><a id="1620" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a> <a id="1626" class="Symbol">:</a> <a id="1628" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1632" class="Keyword">where</a>
    <a id="Format.Chunk.Arg"></a><a id="1642" href="Text.Format.Generic.html#1642" class="InductiveConstructor">Arg</a> <a id="1646" class="Symbol">:</a> <a id="1648" href="Text.Format.Generic.html#938" class="Field">ArgChunk</a> <a id="1657" class="Symbol">→</a> <a id="1659" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>
    <a id="Format.Chunk.Raw"></a><a id="1669" href="Text.Format.Generic.html#1669" class="InductiveConstructor">Raw</a> <a id="1673" class="Symbol">:</a> <a id="1675" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="1682" class="Symbol">→</a> <a id="1684" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>

  <a id="Format.Format"></a><a id="1693" href="Text.Format.Generic.html#1693" class="Function">Format</a> <a id="1700" class="Symbol">:</a> <a id="1702" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="1708" href="Text.Format.Generic.html#1693" class="Function">Format</a> <a id="1715" class="Symbol">=</a> <a id="1717" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1722" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>

  <a id="1731" class="Comment">------------------------------------------------------------------------</a>
  <a id="1806" class="Comment">-- Semantics</a>

  <a id="Format.size"></a><a id="1822" href="Text.Format.Generic.html#1822" class="Function">size</a> <a id="1827" class="Symbol">:</a> <a id="1829" href="Text.Format.Generic.html#1693" class="Function">Format</a> <a id="1836" class="Symbol">→</a> <a id="1838" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1842" href="Text.Format.Generic.html#1822" class="Function">size</a> <a id="1847" class="Symbol">=</a> <a id="1849" href="Data.List.Base.html#4978" class="Function">List.sum</a> <a id="1858" href="Function.Base.html#3637" class="Function Operator">∘′</a> <a id="1861" href="Data.List.Base.html#1606" class="Function">List.map</a> <a id="1870" class="Symbol">λ</a> <a id="1872" class="Symbol">{</a> <a id="1874" class="Symbol">(</a><a id="1875" href="Text.Format.Generic.html#1669" class="InductiveConstructor">Raw</a> <a id="1879" class="Symbol">_)</a> <a id="1882" class="Symbol">→</a> <a id="1884" class="Number">0</a><a id="1885" class="Symbol">;</a> <a id="1887" class="CatchallClause Symbol">_</a> <a id="1889" class="Symbol">→</a> <a id="1891" class="Number">1</a> <a id="1893" class="Symbol">}</a>

  <a id="1898" class="Comment">-- Meaning of a format as a list of value types</a>

  <a id="Format.⟦_⟧"></a><a id="1949" href="Text.Format.Generic.html#1949" class="Function Operator">⟦_⟧</a> <a id="1953" class="Symbol">:</a> <a id="1955" class="Symbol">(</a><a id="1956" href="Text.Format.Generic.html#1956" class="Bound">fmt</a> <a id="1960" class="Symbol">:</a> <a id="1962" href="Text.Format.Generic.html#1693" class="Function">Format</a><a id="1968" class="Symbol">)</a> <a id="1970" class="Symbol">→</a> <a id="1972" href="Function.Nary.NonDependent.Base.html#2330" class="Function">Sets</a> <a id="1977" class="Symbol">(</a><a id="1978" href="Text.Format.Generic.html#1822" class="Function">size</a> <a id="1983" href="Text.Format.Generic.html#1956" class="Bound">fmt</a><a id="1986" class="Symbol">)</a> <a id="1988" href="Function.Nary.NonDependent.html#1531" class="Function">0ℓs</a>
  <a id="1994" href="Text.Format.Generic.html#1949" class="Function Operator">⟦</a> <a id="1996" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>          <a id="2008" href="Text.Format.Generic.html#1949" class="Function Operator">⟧</a> <a id="2010" class="Symbol">=</a> <a id="2012" class="Symbol">_</a>
  <a id="2016" href="Text.Format.Generic.html#1949" class="Function Operator">⟦</a> <a id="2018" href="Text.Format.Generic.html#1642" class="InductiveConstructor">Arg</a> <a id="2022" href="Text.Format.Generic.html#2022" class="Bound">a</a>  <a id="2025" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2027" href="Text.Format.Generic.html#2027" class="Bound">cs</a> <a id="2030" href="Text.Format.Generic.html#1949" class="Function Operator">⟧</a> <a id="2032" class="Symbol">=</a> <a id="2034" href="Text.Format.Generic.html#957" class="Field">ArgType</a> <a id="2042" href="Text.Format.Generic.html#2022" class="Bound">a</a> <a id="2044" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2046" href="Text.Format.Generic.html#1949" class="Function Operator">⟦</a> <a id="2048" href="Text.Format.Generic.html#2027" class="Bound">cs</a> <a id="2051" href="Text.Format.Generic.html#1949" class="Function Operator">⟧</a>
  <a id="2055" href="Text.Format.Generic.html#1949" class="Function Operator">⟦</a> <a id="2057" href="Text.Format.Generic.html#1669" class="InductiveConstructor">Raw</a> <a id="2061" class="Symbol">_</a>  <a id="2064" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2066" href="Text.Format.Generic.html#2066" class="Bound">cs</a> <a id="2069" href="Text.Format.Generic.html#1949" class="Function Operator">⟧</a> <a id="2071" class="Symbol">=</a>             <a id="2085" href="Text.Format.Generic.html#1949" class="Function Operator">⟦</a> <a id="2087" href="Text.Format.Generic.html#2066" class="Bound">cs</a> <a id="2090" href="Text.Format.Generic.html#1949" class="Function Operator">⟧</a>

  <a id="2095" class="Comment">------------------------------------------------------------------------</a>
  <a id="2170" class="Comment">-- Lexer: from Strings to Formats</a>

  <a id="2207" class="Comment">-- Lexing may fail. To have a useful error message, we defined the following</a>
  <a id="2286" class="Comment">-- enumerated type</a>

  <a id="2308" class="Keyword">data</a> <a id="Format.Error"></a><a id="2313" href="Text.Format.Generic.html#2313" class="Datatype">Error</a> <a id="2319" class="Symbol">:</a> <a id="2321" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2325" class="Keyword">where</a>
    <a id="Format.Error.UnexpectedEndOfString"></a><a id="2335" href="Text.Format.Generic.html#2335" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="2357" class="Symbol">:</a> <a id="2359" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2366" class="Symbol">→</a> <a id="2368" href="Text.Format.Generic.html#2313" class="Datatype">Error</a>
    <a id="2378" class="Comment">-- ^ expected a type declaration; found an empty string</a>
    <a id="Format.Error.InvalidType"></a><a id="2438" href="Text.Format.Generic.html#2438" class="InductiveConstructor">InvalidType</a> <a id="2450" class="Symbol">:</a> <a id="2452" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2459" class="Symbol">→</a> <a id="2461" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="2466" class="Symbol">→</a> <a id="2468" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2475" class="Symbol">→</a> <a id="2477" href="Text.Format.Generic.html#2313" class="Datatype">Error</a>
    <a id="2487" class="Comment">-- ^ invalid type declaration</a>
    <a id="2521" class="Comment">--   return a focus: prefix processed, character causing failure, rest</a>

  <a id="Format.lexer"></a><a id="2595" href="Text.Format.Generic.html#2595" class="Function">lexer</a> <a id="2601" class="Symbol">:</a> <a id="2603" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2610" class="Symbol">→</a> <a id="2612" href="Text.Format.Generic.html#2313" class="Datatype">Error</a> <a id="2618" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="2620" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2625" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>
  <a id="2633" href="Text.Format.Generic.html#2595" class="Function">lexer</a> <a id="2639" href="Text.Format.Generic.html#2639" class="Bound">input</a> <a id="2645" class="Symbol">=</a> <a id="2647" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="2652" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="2655" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="2658" class="Symbol">(</a><a id="2659" href="Data.String.Base.html#1541" class="Primitive">toList</a> <a id="2666" href="Text.Format.Generic.html#2639" class="Bound">input</a><a id="2671" class="Symbol">)</a> <a id="2673" class="Keyword">where</a>

    <a id="2684" class="Keyword">open</a> <a id="2689" href="Effect.Applicative.html#970" class="Module">RawApplicative</a> <a id="2704" class="Symbol">(</a><a id="2705" href="Data.Sum.Effectful.Left.html#954" class="Function">Sumₗ.applicative</a> <a id="2722" href="Text.Format.Generic.html#2313" class="Datatype">Error</a> <a id="2728" href="Level.html#512" class="Function">0ℓ</a><a id="2730" class="Symbol">)</a>

    <a id="2737" class="Comment">-- Type synonyms used locally to document the code</a>
    <a id="2792" href="Text.Format.Generic.html#2792" class="Function">RevWord</a> <a id="2800" class="Symbol">=</a> <a id="2802" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2807" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="2812" class="Comment">-- Mere characters accumulated so far</a>
    <a id="2854" href="Text.Format.Generic.html#2854" class="Function">Prefix</a>  <a id="2862" class="Symbol">=</a> <a id="2864" href="Text.Format.Generic.html#2792" class="Function">RevWord</a>   <a id="2874" class="Comment">-- Prefix of the input String already read</a>

    <a id="2922" href="Text.Format.Generic.html#2922" class="Function">toRevString</a> <a id="2934" class="Symbol">:</a> <a id="2936" href="Text.Format.Generic.html#2792" class="Function">RevWord</a> <a id="2944" class="Symbol">→</a> <a id="2946" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="2957" href="Text.Format.Generic.html#2922" class="Function">toRevString</a> <a id="2969" class="Symbol">=</a> <a id="2971" href="Data.String.Base.html#1574" class="Primitive">fromList</a> <a id="2980" href="Function.Base.html#3637" class="Function Operator">∘′</a> <a id="2983" href="Data.List.Base.html#6987" class="Function">reverse</a>

    <a id="2996" class="Comment">-- Push a Raw token if we have accumulated some mere characters</a>
    <a id="3064" href="Text.Format.Generic.html#3064" class="Function">push</a> <a id="3069" class="Symbol">:</a> <a id="3071" href="Text.Format.Generic.html#2792" class="Function">RevWord</a> <a id="3079" class="Symbol">→</a> <a id="3081" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3086" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a> <a id="3092" class="Symbol">→</a> <a id="3094" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3099" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>
    <a id="3109" href="Text.Format.Generic.html#3064" class="Function">push</a> <a id="3114" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3117" href="Text.Format.Generic.html#3117" class="Bound">ks</a> <a id="3120" class="Symbol">=</a> <a id="3122" href="Text.Format.Generic.html#3117" class="Bound">ks</a>
    <a id="3129" href="Text.Format.Generic.html#3064" class="CatchallClause Function">push</a><a id="3133" class="CatchallClause"> </a><a id="3134" href="Text.Format.Generic.html#3134" class="CatchallClause Bound">cs</a><a id="3136" class="CatchallClause"> </a><a id="3137" href="Text.Format.Generic.html#3137" class="CatchallClause Bound">ks</a> <a id="3140" class="Symbol">=</a> <a id="3142" href="Text.Format.Generic.html#1669" class="InductiveConstructor">Raw</a> <a id="3146" class="Symbol">(</a><a id="3147" href="Text.Format.Generic.html#2922" class="Function">toRevString</a> <a id="3159" href="Text.Format.Generic.html#3134" class="Bound">cs</a><a id="3161" class="Symbol">)</a> <a id="3163" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3165" href="Text.Format.Generic.html#3137" class="Bound">ks</a>

    <a id="3173" class="Comment">-- Main loop</a>
    <a id="3190" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3195" class="Symbol">:</a> <a id="3197" href="Text.Format.Generic.html#2792" class="Function">RevWord</a> <a id="3205" class="Symbol">→</a> <a id="3207" href="Text.Format.Generic.html#2854" class="Function">Prefix</a> <a id="3214" class="Symbol">→</a> <a id="3216" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3221" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3226" class="Symbol">→</a> <a id="3228" href="Text.Format.Generic.html#2313" class="Datatype">Error</a> <a id="3234" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="3236" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3241" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>
    <a id="3251" href="Text.Format.Generic.html#3251" class="Function">type</a> <a id="3256" class="Symbol">:</a>           <a id="3268" href="Text.Format.Generic.html#2854" class="Function">Prefix</a> <a id="3275" class="Symbol">→</a> <a id="3277" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3282" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3287" class="Symbol">→</a> <a id="3289" href="Text.Format.Generic.html#2313" class="Datatype">Error</a> <a id="3295" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="3297" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3302" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>

    <a id="3313" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3318" href="Text.Format.Generic.html#3318" class="Bound">acc</a> <a id="3322" href="Text.Format.Generic.html#3322" class="Bound">bef</a> <a id="3326" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>               <a id="3343" class="Symbol">=</a> <a id="3345" href="Effect.Applicative.html#1138" class="Function">pure</a> <a id="3350" class="Symbol">(</a><a id="3351" href="Text.Format.Generic.html#3064" class="Function">push</a> <a id="3356" href="Text.Format.Generic.html#3318" class="Bound">acc</a> <a id="3360" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3362" class="Symbol">)</a>
    <a id="3368" class="Comment">-- escaped &#39;%&#39; character: treat like a mere character</a>
    <a id="3426" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3431" href="Text.Format.Generic.html#3431" class="Bound">acc</a> <a id="3435" href="Text.Format.Generic.html#3435" class="Bound">bef</a> <a id="3439" class="Symbol">(</a><a id="3440" class="String">&#39;%&#39;</a> <a id="3444" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3446" class="String">&#39;%&#39;</a> <a id="3450" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3452" href="Text.Format.Generic.html#3452" class="Bound">cs</a><a id="3454" class="Symbol">)</a> <a id="3456" class="Symbol">=</a> <a id="3458" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3463" class="Symbol">(</a><a id="3464" class="String">&#39;%&#39;</a> <a id="3468" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3470" href="Text.Format.Generic.html#3431" class="Bound">acc</a><a id="3473" class="Symbol">)</a> <a id="3475" class="Symbol">(</a><a id="3476" class="String">&#39;%&#39;</a> <a id="3480" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3482" class="String">&#39;%&#39;</a> <a id="3486" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3488" href="Text.Format.Generic.html#3435" class="Bound">bef</a><a id="3491" class="Symbol">)</a> <a id="3493" href="Text.Format.Generic.html#3452" class="Bound">cs</a>
    <a id="3500" class="Comment">-- non escaped &#39;%&#39;: type declaration following</a>
    <a id="3551" href="Text.Format.Generic.html#3190" class="CatchallClause Function">loop</a><a id="3555" class="CatchallClause"> </a><a id="3556" href="Text.Format.Generic.html#3556" class="CatchallClause Bound">acc</a><a id="3559" class="CatchallClause"> </a><a id="3560" href="Text.Format.Generic.html#3560" class="CatchallClause Bound">bef</a><a id="3563" class="CatchallClause"> </a><a id="3564" class="CatchallClause Symbol">(</a><a id="3565" class="CatchallClause String">&#39;%&#39;</a><a id="3568" class="CatchallClause"> </a><a id="3569" href="Agda.Builtin.List.html#200" class="CatchallClause InductiveConstructor Operator">∷</a><a id="3570" class="CatchallClause"> </a><a id="3571" href="Text.Format.Generic.html#3571" class="CatchallClause Bound">cs</a><a id="3573" class="CatchallClause Symbol">)</a>       <a id="3581" class="Symbol">=</a> <a id="3583" href="Text.Format.Generic.html#3064" class="Function">push</a> <a id="3588" href="Text.Format.Generic.html#3556" class="Bound">acc</a> <a id="3592" href="Effect.Functor.html#678" class="Function Operator">&lt;$&gt;</a> <a id="3596" href="Text.Format.Generic.html#3251" class="Function">type</a> <a id="3601" class="Symbol">(</a><a id="3602" class="String">&#39;%&#39;</a> <a id="3606" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3608" href="Text.Format.Generic.html#3560" class="Bound">bef</a><a id="3611" class="Symbol">)</a> <a id="3613" href="Text.Format.Generic.html#3571" class="Bound">cs</a>
    <a id="3620" class="Comment">-- mere character: push onto the accumulator</a>
    <a id="3669" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3674" href="Text.Format.Generic.html#3674" class="Bound">acc</a> <a id="3678" href="Text.Format.Generic.html#3678" class="Bound">bef</a> <a id="3682" class="Symbol">(</a><a id="3683" href="Text.Format.Generic.html#3683" class="Bound">c</a> <a id="3685" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3687" href="Text.Format.Generic.html#3687" class="Bound">cs</a><a id="3689" class="Symbol">)</a>         <a id="3699" class="Symbol">=</a> <a id="3701" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3706" class="Symbol">(</a><a id="3707" href="Text.Format.Generic.html#3683" class="Bound">c</a> <a id="3709" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3711" href="Text.Format.Generic.html#3674" class="Bound">acc</a><a id="3714" class="Symbol">)</a> <a id="3716" class="Symbol">(</a><a id="3717" href="Text.Format.Generic.html#3683" class="Bound">c</a> <a id="3719" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3721" href="Text.Format.Generic.html#3678" class="Bound">bef</a><a id="3724" class="Symbol">)</a> <a id="3726" href="Text.Format.Generic.html#3687" class="Bound">cs</a>

    <a id="3734" href="Text.Format.Generic.html#3251" class="Function">type</a> <a id="3739" href="Text.Format.Generic.html#3739" class="Bound">bef</a> <a id="3743" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>       <a id="3752" class="Symbol">=</a> <a id="3754" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="3759" class="Symbol">(</a><a id="3760" href="Text.Format.Generic.html#2335" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="3782" href="Text.Format.Generic.html#2639" class="Bound">input</a><a id="3787" class="Symbol">)</a>
    <a id="3793" href="Text.Format.Generic.html#3251" class="Function">type</a> <a id="3798" href="Text.Format.Generic.html#3798" class="Bound">bef</a> <a id="3802" class="Symbol">(</a><a id="3803" href="Text.Format.Generic.html#3803" class="Bound">c</a> <a id="3805" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3807" href="Text.Format.Generic.html#3807" class="Bound">cs</a><a id="3809" class="Symbol">)</a> <a id="3811" class="Symbol">=</a> <a id="3813" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a> <a id="3817" href="Effect.Functor.html#678" class="Function Operator">&lt;$&gt;</a> <a id="3821" href="Text.Format.Generic.html#3865" class="Function">chunk</a> <a id="3827" href="Text.Format.Generic.html#3803" class="Bound">c</a> <a id="3829" href="Effect.Applicative.html#1515" class="Function Operator">⊛</a> <a id="3831" href="Text.Format.Generic.html#3190" class="Function">loop</a> <a id="3836" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3839" class="Symbol">(</a><a id="3840" href="Text.Format.Generic.html#3803" class="Bound">c</a> <a id="3842" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3844" href="Text.Format.Generic.html#3798" class="Bound">bef</a><a id="3847" class="Symbol">)</a> <a id="3849" href="Text.Format.Generic.html#3807" class="Bound">cs</a> <a id="3852" class="Keyword">where</a>

      <a id="3865" href="Text.Format.Generic.html#3865" class="Function">chunk</a> <a id="3871" class="Symbol">:</a> <a id="3873" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3878" class="Symbol">→</a> <a id="3880" href="Text.Format.Generic.html#2313" class="Datatype">Error</a> <a id="3886" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="3888" href="Text.Format.Generic.html#1620" class="Datatype">Chunk</a>
      <a id="3900" href="Text.Format.Generic.html#3865" class="Function">chunk</a> <a id="3906" href="Text.Format.Generic.html#3906" class="Bound">c</a> <a id="3908" class="Symbol">=</a>
        <a id="3918" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="3923" href="Text.Format.Generic.html#987" class="Field">lexArg</a> <a id="3930" href="Text.Format.Generic.html#3906" class="Bound">c</a> <a id="3932" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="3935" class="Symbol">λ</a> <a id="3937" class="Keyword">where</a>
          <a id="3953" class="Symbol">(</a><a id="3954" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3959" href="Text.Format.Generic.html#3959" class="Bound">ch</a><a id="3961" class="Symbol">)</a> <a id="3963" class="Symbol">→</a> <a id="3965" href="Effect.Applicative.html#1138" class="Function">pure</a> <a id="3970" class="Symbol">(</a><a id="3971" href="Text.Format.Generic.html#1642" class="InductiveConstructor">Arg</a> <a id="3975" href="Text.Format.Generic.html#3959" class="Bound">ch</a><a id="3977" class="Symbol">)</a>
          <a id="3989" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>   <a id="3999" class="Symbol">→</a>
            <a id="4013" href="Function.Strict.html#1663" class="Function">force′</a> <a id="4020" class="Symbol">(</a><a id="4021" href="Text.Format.Generic.html#2922" class="Function">toRevString</a> <a id="4033" href="Text.Format.Generic.html#3798" class="Bound">bef</a><a id="4036" class="Symbol">)</a> <a id="4038" class="Symbol">λ</a> <a id="4040" href="Text.Format.Generic.html#4040" class="Bound">prefix</a> <a id="4047" class="Symbol">→</a>
            <a id="4061" href="Function.Strict.html#1663" class="Function">force′</a> <a id="4068" class="Symbol">(</a><a id="4069" href="Data.String.Base.html#1574" class="Primitive">fromList</a> <a id="4078" href="Text.Format.Generic.html#3807" class="Bound">cs</a><a id="4080" class="Symbol">)</a>     <a id="4086" class="Symbol">λ</a> <a id="4088" href="Text.Format.Generic.html#4088" class="Bound">suffix</a> <a id="4095" class="Symbol">→</a>
            <a id="4109" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="4114" class="Symbol">(</a><a id="4115" href="Text.Format.Generic.html#2438" class="InductiveConstructor">InvalidType</a> <a id="4127" href="Text.Format.Generic.html#4040" class="Bound">prefix</a> <a id="4134" href="Text.Format.Generic.html#3906" class="Bound">c</a> <a id="4136" href="Text.Format.Generic.html#4088" class="Bound">suffix</a><a id="4142" class="Symbol">)</a>
</pre></body></html>