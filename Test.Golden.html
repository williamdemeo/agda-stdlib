<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">---</a>

<a id="2622" class="Comment">------------------------------------------------------------------------</a>
<a id="2695" class="Comment">-- Usage</a>
<a id="2704" class="Comment">--</a>
<a id="2707" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2764" class="Comment">--</a>
<a id="2767" class="Comment">--```sh</a>
<a id="2775" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2818" class="Comment">--   [--timing]</a>
<a id="2834" class="Comment">--   [--interactive]</a>
<a id="2855" class="Comment">--   [--only-file PATH]</a>
<a id="2879" class="Comment">--   [--failure-file PATH]</a>
<a id="2906" class="Comment">--   [--no-colour]</a>
<a id="2925" class="Comment">--   [--only [NAMES]]</a>
<a id="2947" class="Comment">--```</a>
<a id="2953" class="Comment">--</a>
<a id="2956" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3037" class="Symbol">{-#</a> <a id="3041" class="Keyword">OPTIONS</a> <a id="3049" class="Pragma">--without-K</a> <a id="3061" class="Pragma">--guardedness</a> <a id="3075" class="Symbol">#-}</a>

<a id="3080" class="Keyword">module</a> <a id="3087" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3099" class="Keyword">where</a>

<a id="3106" class="Keyword">open</a> <a id="3111" class="Keyword">import</a> <a id="3118" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3133" class="Keyword">using</a> <a id="3139" class="Symbol">(</a><a id="3140" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a><a id="3144" class="Symbol">;</a> <a id="3146" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a><a id="3150" class="Symbol">;</a> <a id="3152" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a><a id="3157" class="Symbol">;</a> <a id="3159" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="3172" class="Symbol">)</a>
<a id="3174" class="Keyword">import</a> <a id="3181" href="Data.Char.html" class="Module">Data.Char</a> <a id="3191" class="Symbol">as</a> <a id="3194" class="Module">Char</a>
<a id="3199" class="Keyword">open</a> <a id="3204" class="Keyword">import</a> <a id="3211" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3220" class="Keyword">using</a> <a id="3226" class="Symbol">(</a><a id="3227" href="Data.Fin.html#730" class="Function Operator">#_</a><a id="3229" class="Symbol">)</a>
<a id="3231" class="Keyword">import</a> <a id="3238" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3256" class="Symbol">as</a> <a id="3259" class="Module">ℤ</a>
<a id="3261" class="Keyword">open</a> <a id="3266" class="Keyword">import</a> <a id="3273" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3288" class="Symbol">as</a> <a id="3291" class="Module">List</a> <a id="3296" class="Keyword">using</a> <a id="3302" class="Symbol">(</a><a id="3303" href="Agda.Builtin.List.html#148" class="Datatype">List</a><a id="3307" class="Symbol">;</a> <a id="3309" href="Data.List.Base.html#7361" class="InductiveConstructor">[]</a><a id="3311" class="Symbol">;</a> <a id="3313" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a><a id="3316" class="Symbol">;</a> <a id="3318" href="Data.List.Base.html#1929" class="Function Operator">_++_</a><a id="3322" class="Symbol">;</a> <a id="3324" href="Data.List.Base.html#11403" class="Function">filter</a><a id="3330" class="Symbol">;</a> <a id="3332" href="Data.List.Base.html#3879" class="Function">partitionSums</a><a id="3345" class="Symbol">)</a>
<a id="3347" class="Keyword">open</a> <a id="3352" class="Keyword">import</a> <a id="3359" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3416" class="Keyword">using</a> <a id="3422" class="Symbol">(</a><a id="3423" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6650" class="Function">infix?</a><a id="3429" class="Symbol">)</a>
<a id="3431" class="Keyword">open</a> <a id="3436" class="Keyword">import</a> <a id="3443" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3472" class="Keyword">using</a> <a id="3478" class="Symbol">(</a><a id="3479" href="Data.List.Relation.Unary.Any.html#2651" class="Function">any?</a><a id="3483" class="Symbol">)</a>
<a id="3485" class="Keyword">open</a> <a id="3490" class="Keyword">import</a> <a id="3497" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3513" class="Keyword">using</a> <a id="3519" class="Symbol">(</a><a id="3520" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="3525" class="Symbol">;</a> <a id="3527" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a><a id="3531" class="Symbol">;</a> <a id="3533" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a><a id="3540" class="Symbol">;</a> <a id="3542" href="Data.Maybe.Base.html#1647" class="Function">fromMaybe</a><a id="3551" class="Symbol">)</a>
<a id="3553" class="Keyword">open</a> <a id="3558" class="Keyword">import</a> <a id="3565" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3579" class="Keyword">using</a> <a id="3585" class="Symbol">(</a><a id="3586" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="3587" class="Symbol">;</a> <a id="3589" href="Data.Nat.Base.html#1127" class="Primitive Operator">_≡ᵇ_</a><a id="3593" class="Symbol">;</a> <a id="3595" href="Data.Nat.Base.html#1301" class="Primitive Operator">_&lt;ᵇ_</a><a id="3599" class="Symbol">;</a> <a id="3601" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">_+_</a><a id="3604" class="Symbol">;</a> <a id="3606" href="Data.Nat.Base.html#3202" class="Primitive Operator">_∸_</a><a id="3609" class="Symbol">)</a>
<a id="3611" class="Keyword">import</a> <a id="3618" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3632" class="Symbol">as</a> <a id="3635" class="Module">ℕ</a>
<a id="3637" class="Keyword">open</a> <a id="3642" class="Keyword">import</a> <a id="3649" href="Data.Product.html" class="Module">Data.Product</a> <a id="3662" class="Keyword">using</a> <a id="3668" class="Symbol">(</a><a id="3669" href="Data.Product.Base.html#1109" class="Function Operator">_×_</a><a id="3672" class="Symbol">;</a> <a id="3674" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="3677" class="Symbol">)</a>
<a id="3679" class="Keyword">open</a> <a id="3684" class="Keyword">import</a> <a id="3691" href="Data.String.html" class="Module">Data.String</a> <a id="3703" class="Symbol">as</a> <a id="3706" class="Module">String</a> <a id="3713" class="Keyword">using</a> <a id="3719" class="Symbol">(</a><a id="3720" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="3726" class="Symbol">;</a> <a id="3728" href="Data.String.Base.html#5098" class="Function">lines</a><a id="3733" class="Symbol">;</a> <a id="3735" href="Data.String.Base.html#2815" class="Function">unlines</a><a id="3742" class="Symbol">;</a> <a id="3744" href="Data.String.Base.html#2757" class="Function">unwords</a><a id="3751" class="Symbol">;</a> <a id="3753" href="Data.String.Base.html#2602" class="Function">concat</a><a id="3759" class="Symbol">;</a> <a id="3761" href="Data.String.Properties.html#2285" class="Function Operator">_≟_</a><a id="3764" class="Symbol">)</a>
<a id="3766" class="Keyword">open</a> <a id="3771" class="Keyword">import</a> <a id="3778" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3792" class="Keyword">using</a> <a id="3798" class="Symbol">(</a><a id="3799" href="Data.Sum.Base.html#616" class="Datatype Operator">_⊎_</a><a id="3802" class="Symbol">;</a> <a id="3804" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a><a id="3808" class="Symbol">;</a> <a id="3810" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a><a id="3814" class="Symbol">)</a>
<a id="3816" class="Keyword">open</a> <a id="3821" class="Keyword">import</a> <a id="3828" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3843" class="Keyword">using</a> <a id="3849" class="Symbol">(</a><a id="3850" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="3851" class="Symbol">)</a>

<a id="3854" class="Keyword">open</a> <a id="3859" class="Keyword">import</a> <a id="3866" href="Function.Base.html" class="Module">Function.Base</a> <a id="3880" class="Keyword">using</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Function.Base.html#695" class="Function">id</a><a id="3889" class="Symbol">;</a> <a id="3891" href="Function.Base.html#1994" class="Function Operator">_$_</a><a id="3894" class="Symbol">;</a> <a id="3896" href="Function.Base.html#4053" class="Function Operator">case_of_</a><a id="3904" class="Symbol">)</a>

<a id="3907" class="Keyword">open</a> <a id="3912" class="Keyword">import</a> <a id="3919" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="3946" class="Keyword">using</a> <a id="3952" class="Symbol">(</a><a id="3953" href="Relation.Nullary.Decidable.Core.html#1546" class="Field">does</a><a id="3957" class="Symbol">)</a>

<a id="3960" class="Keyword">open</a> <a id="3965" class="Keyword">import</a> <a id="3972" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="3996" class="Keyword">using</a> <a id="4002" class="Symbol">(</a><a id="4003" href="Agda.Builtin.Coinduction.html#218" class="CoinductiveConstructor Operator">♯_</a><a id="4005" class="Symbol">)</a>
<a id="4007" class="Keyword">open</a> <a id="4012" class="Keyword">import</a> <a id="4019" href="IO.html" class="Module">IO</a>

<a id="4023" class="Keyword">open</a> <a id="4028" class="Keyword">import</a> <a id="4035" href="System.Clock.html" class="Module">System.Clock</a> <a id="4048" class="Symbol">as</a> <a id="4051" class="Module">Clock</a> <a id="4057" class="Keyword">using</a> <a id="4063" class="Symbol">(</a><a id="4064" href="System.Clock.html#2755" class="Function">time′</a><a id="4069" class="Symbol">;</a> <a id="4071" href="System.Clock.html#1910" class="Record">Time</a><a id="4075" class="Symbol">;</a> <a id="4077" href="System.Clock.html#1956" class="Field">seconds</a><a id="4084" class="Symbol">)</a>
<a id="4086" class="Keyword">open</a> <a id="4091" class="Keyword">import</a> <a id="4098" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4118" class="Keyword">open</a> <a id="4123" class="Keyword">import</a> <a id="4130" href="System.Directory.html" class="Module">System.Directory</a> <a id="4147" class="Keyword">using</a> <a id="4153" class="Symbol">(</a><a id="4154" href="System.Directory.html#3041" class="Function">doesFileExist</a><a id="4167" class="Symbol">;</a> <a id="4169" href="System.Directory.html#3093" class="Function">doesDirectoryExist</a><a id="4187" class="Symbol">)</a>
<a id="4189" class="Keyword">open</a> <a id="4194" class="Keyword">import</a> <a id="4201" href="System.Environment.html" class="Module">System.Environment</a> <a id="4220" class="Keyword">using</a> <a id="4226" class="Symbol">(</a><a id="4227" href="System.Environment.html#646" class="Function">getArgs</a><a id="4234" class="Symbol">;</a> <a id="4236" href="System.Environment.html#763" class="Function">lookupEnv</a><a id="4245" class="Symbol">)</a>
<a id="4247" class="Keyword">open</a> <a id="4252" class="Keyword">import</a> <a id="4259" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4271" class="Keyword">open</a> <a id="4276" class="Keyword">import</a> <a id="4283" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4305" class="Keyword">using</a> <a id="4311" class="Symbol">(</a><a id="4312" href="System.FilePath.Posix.Primitive.html#2547" class="Postulate">mkFilePath</a><a id="4322" class="Symbol">)</a>
<a id="4324" class="Keyword">open</a> <a id="4329" class="Keyword">import</a> <a id="4336" href="System.Process.html" class="Module">System.Process</a> <a id="4351" class="Keyword">using</a> <a id="4357" class="Symbol">(</a><a id="4358" href="System.Process.html#640" class="Function">callCommand</a><a id="4369" class="Symbol">;</a> <a id="4371" href="System.Process.html#720" class="Function">system</a><a id="4377" class="Symbol">)</a>

<a id="4380" class="Keyword">record</a> <a id="Options"></a><a id="4387" href="Test.Golden.html#4387" class="Record">Options</a> <a id="4395" class="Symbol">:</a> <a id="4397" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4401" class="Keyword">where</a>
  <a id="4409" class="Keyword">field</a>
    <a id="4419" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4467" href="Test.Golden.html#4467" class="Field">exeUnderTest</a> <a id="4480" class="Symbol">:</a> <a id="4482" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="4493" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4540" href="Test.Golden.html#4540" class="Field">onlyNames</a> <a id="4550" class="Symbol">:</a> <a id="4552" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="4557" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="4568" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4619" href="Test.Golden.html#4619" class="Field">interactive</a> <a id="4631" class="Symbol">:</a> <a id="4633" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="4642" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4687" href="Test.Golden.html#4687" class="Field">timing</a> <a id="4694" class="Symbol">:</a> <a id="4696" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="4705" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4765" href="Test.Golden.html#4765" class="Field">failureFile</a> <a id="4777" class="Symbol">:</a> <a id="4779" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="4785" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="4796" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4857" href="Test.Golden.html#4857" class="Field">colour</a> <a id="4864" class="Symbol">:</a> <a id="4866" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
<a id="4871" class="Keyword">open</a> <a id="4876" href="Test.Golden.html#4387" class="Module">Options</a>

<a id="initOptions"></a><a id="4885" href="Test.Golden.html#4885" class="Function">initOptions</a> <a id="4897" class="Symbol">:</a> <a id="4899" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="4906" class="Symbol">→</a> <a id="4908" href="Test.Golden.html#4387" class="Record">Options</a>
<a id="4916" href="Test.Golden.html#4885" class="Function">initOptions</a> <a id="4928" href="Test.Golden.html#4928" class="Bound">exe</a> <a id="4932" class="Symbol">=</a> <a id="4934" class="Keyword">record</a>
  <a id="4943" class="Symbol">{</a> <a id="4945" href="Test.Golden.html#4467" class="Field">exeUnderTest</a> <a id="4958" class="Symbol">=</a> <a id="4960" href="Test.Golden.html#4928" class="Bound">exe</a>
  <a id="4966" class="Symbol">;</a> <a id="4968" href="Test.Golden.html#4540" class="Field">onlyNames</a>    <a id="4981" class="Symbol">=</a> <a id="4983" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
  <a id="4988" class="Symbol">;</a> <a id="4990" href="Test.Golden.html#4619" class="Field">interactive</a>  <a id="5003" class="Symbol">=</a> <a id="5005" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
  <a id="5013" class="Symbol">;</a> <a id="5015" href="Test.Golden.html#4687" class="Field">timing</a>       <a id="5028" class="Symbol">=</a> <a id="5030" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
  <a id="5038" class="Symbol">;</a> <a id="5040" href="Test.Golden.html#4765" class="Field">failureFile</a>  <a id="5053" class="Symbol">=</a> <a id="5055" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
  <a id="5065" class="Symbol">;</a> <a id="5067" href="Test.Golden.html#4857" class="Field">colour</a>       <a id="5080" class="Symbol">=</a> <a id="5082" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
  <a id="5089" class="Symbol">}</a>

<a id="usage"></a><a id="5092" href="Test.Golden.html#5092" class="Function">usage</a> <a id="5098" class="Symbol">:</a> <a id="5100" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="5107" href="Test.Golden.html#5092" class="Function">usage</a> <a id="5113" class="Symbol">=</a> <a id="5115" href="Data.String.Base.html#2757" class="Function">unwords</a>
  <a id="5125" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="5127" class="String">&quot;Usage:&quot;</a>
  <a id="5138" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5140" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5160" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5162" class="String">&quot;[--timing]&quot;</a>
  <a id="5177" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5179" class="String">&quot;[--interactive]&quot;</a>
  <a id="5199" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5201" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5227" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5229" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5252" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5254" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5272" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5274" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5295" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5297" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

<a id="5301" class="Keyword">data</a> <a id="Error"></a><a id="5306" href="Test.Golden.html#5306" class="Datatype">Error</a> <a id="5312" class="Symbol">:</a> <a id="5314" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5318" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5326" href="Test.Golden.html#5326" class="InductiveConstructor">MissingExecutable</a> <a id="5344" class="Symbol">:</a> <a id="5346" href="Test.Golden.html#5306" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5354" href="Test.Golden.html#5354" class="InductiveConstructor">InvalidArgument</a> <a id="5370" class="Symbol">:</a> <a id="5372" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5379" class="Symbol">→</a> <a id="5381" href="Test.Golden.html#5306" class="Datatype">Error</a>

<a id="show"></a><a id="5388" href="Test.Golden.html#5388" class="Function">show</a> <a id="5393" class="Symbol">:</a> <a id="5395" href="Test.Golden.html#5306" class="Datatype">Error</a> <a id="5401" class="Symbol">→</a> <a id="5403" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="5410" href="Test.Golden.html#5388" class="Function">show</a> <a id="5415" href="Test.Golden.html#5326" class="InductiveConstructor">MissingExecutable</a> <a id="5433" class="Symbol">=</a> <a id="5435" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5474" href="Test.Golden.html#5388" class="Function">show</a> <a id="5479" class="Symbol">(</a><a id="5480" href="Test.Golden.html#5354" class="InductiveConstructor">InvalidArgument</a> <a id="5496" href="Test.Golden.html#5496" class="Bound">arg</a><a id="5499" class="Symbol">)</a> <a id="5501" class="Symbol">=</a> <a id="5503" class="String">&quot;Invalid argument: &quot;</a> <a id="5524" href="Data.String.Base.html#2414" class="Function Operator">String.++</a> <a id="5534" href="Test.Golden.html#5496" class="Bound">arg</a>

<a id="5539" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5575" href="Test.Golden.html#5575" class="Function">options</a> <a id="5583" class="Symbol">:</a> <a id="5585" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5590" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5597" class="Symbol">→</a> <a id="5599" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="5602" class="Symbol">(</a><a id="5603" href="Test.Golden.html#5306" class="Datatype">Error</a> <a id="5609" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="5611" href="Test.Golden.html#4387" class="Record">Options</a><a id="5618" class="Symbol">)</a>
<a id="5620" href="Test.Golden.html#5575" class="Function">options</a><a id="5627" class="Symbol">(</a><a id="5628" href="Test.Golden.html#5628" class="Bound">exe</a> <a id="5632" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5634" href="Test.Golden.html#5634" class="Bound">rest</a><a id="5638" class="Symbol">)</a> <a id="5640" class="Symbol">=</a> <a id="5642" href="Test.Golden.html#6443" class="Function">mkOptions</a> <a id="5652" href="Test.Golden.html#5628" class="Bound">exe</a> <a id="5656" href="Test.Golden.html#5634" class="Bound">rest</a> <a id="5661" class="Keyword">where</a>

  <a id="5670" href="Test.Golden.html#5670" class="Function">go</a> <a id="5673" class="Symbol">:</a> <a id="5675" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5680" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5687" class="Symbol">→</a> <a id="5689" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="5695" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5702" class="Symbol">→</a> <a id="5704" href="Test.Golden.html#4387" class="Record">Options</a> <a id="5712" class="Symbol">→</a> <a id="5714" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5721" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="5723" class="Symbol">(</a><a id="5724" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="5730" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5737" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5739" href="Test.Golden.html#4387" class="Record">Options</a><a id="5746" class="Symbol">)</a>
  <a id="5750" href="Test.Golden.html#5670" class="Function">go</a> <a id="5753" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>                             <a id="5784" href="Test.Golden.html#5784" class="Bound">mfp</a> <a id="5788" href="Test.Golden.html#5788" class="Bound">opts</a> <a id="5793" class="Symbol">=</a> <a id="5795" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="5800" class="Symbol">(</a><a id="5801" href="Test.Golden.html#5784" class="Bound">mfp</a> <a id="5805" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5807" href="Test.Golden.html#5788" class="Bound">opts</a><a id="5811" class="Symbol">)</a>
  <a id="5815" href="Test.Golden.html#5670" class="Function">go</a> <a id="5818" class="Symbol">(</a><a id="5819" class="String">&quot;--timing&quot;</a>            <a id="5841" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5843" href="Test.Golden.html#5843" class="Bound">args</a><a id="5847" class="Symbol">)</a> <a id="5849" href="Test.Golden.html#5849" class="Bound">mfp</a> <a id="5853" href="Test.Golden.html#5853" class="Bound">opts</a> <a id="5858" class="Symbol">=</a>
    <a id="5864" href="Test.Golden.html#5670" class="Function">go</a> <a id="5867" href="Test.Golden.html#5843" class="Bound">args</a> <a id="5872" href="Test.Golden.html#5849" class="Bound">mfp</a> <a id="5876" class="Symbol">(</a><a id="5877" class="Keyword">record</a> <a id="5884" href="Test.Golden.html#5853" class="Bound">opts</a> <a id="5889" class="Symbol">{</a> <a id="5891" href="Test.Golden.html#4687" class="Field">timing</a> <a id="5898" class="Symbol">=</a> <a id="5900" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="5905" class="Symbol">})</a>
  <a id="5910" href="Test.Golden.html#5670" class="Function">go</a> <a id="5913" class="Symbol">(</a><a id="5914" class="String">&quot;--interactive&quot;</a>       <a id="5936" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5938" href="Test.Golden.html#5938" class="Bound">args</a><a id="5942" class="Symbol">)</a> <a id="5944" href="Test.Golden.html#5944" class="Bound">mfp</a> <a id="5948" href="Test.Golden.html#5948" class="Bound">opts</a> <a id="5953" class="Symbol">=</a>
    <a id="5959" href="Test.Golden.html#5670" class="Function">go</a> <a id="5962" href="Test.Golden.html#5938" class="Bound">args</a> <a id="5967" href="Test.Golden.html#5944" class="Bound">mfp</a> <a id="5971" class="Symbol">(</a><a id="5972" class="Keyword">record</a> <a id="5979" href="Test.Golden.html#5948" class="Bound">opts</a> <a id="5984" class="Symbol">{</a> <a id="5986" href="Test.Golden.html#4619" class="Field">interactive</a> <a id="5998" class="Symbol">=</a> <a id="6000" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="6005" class="Symbol">})</a>
  <a id="6010" href="Test.Golden.html#5670" class="Function">go</a> <a id="6013" class="Symbol">(</a><a id="6014" class="String">&quot;--failure-file&quot;</a> <a id="6031" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6033" href="Test.Golden.html#6033" class="Bound">fp</a> <a id="6036" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6038" href="Test.Golden.html#6038" class="Bound">args</a><a id="6042" class="Symbol">)</a> <a id="6044" href="Test.Golden.html#6044" class="Bound">mfp</a> <a id="6048" href="Test.Golden.html#6048" class="Bound">opts</a> <a id="6053" class="Symbol">=</a>
    <a id="6059" href="Test.Golden.html#5670" class="Function">go</a> <a id="6062" href="Test.Golden.html#6038" class="Bound">args</a> <a id="6067" href="Test.Golden.html#6044" class="Bound">mfp</a> <a id="6071" class="Symbol">(</a><a id="6072" class="Keyword">record</a> <a id="6079" href="Test.Golden.html#6048" class="Bound">opts</a> <a id="6084" class="Symbol">{</a> <a id="6086" href="Test.Golden.html#4765" class="Field">failureFile</a> <a id="6098" class="Symbol">=</a> <a id="6100" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6105" href="Test.Golden.html#6033" class="Bound">fp</a> <a id="6108" class="Symbol">})</a>
  <a id="6113" href="Test.Golden.html#5670" class="Function">go</a> <a id="6116" class="Symbol">(</a><a id="6117" class="String">&quot;--only&quot;</a>              <a id="6139" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6141" href="Test.Golden.html#6141" class="Bound">args</a><a id="6145" class="Symbol">)</a> <a id="6147" href="Test.Golden.html#6147" class="Bound">mfp</a> <a id="6151" href="Test.Golden.html#6151" class="Bound">opts</a> <a id="6156" class="Symbol">=</a>
    <a id="6162" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="6167" class="Symbol">(</a><a id="6168" href="Test.Golden.html#6147" class="Bound">mfp</a> <a id="6172" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6174" class="Symbol">(</a><a id="6175" class="Keyword">record</a> <a id="6182" href="Test.Golden.html#6151" class="Bound">opts</a> <a id="6187" class="Symbol">{</a> <a id="6189" href="Test.Golden.html#4540" class="Field">onlyNames</a> <a id="6199" class="Symbol">=</a> <a id="6201" href="Test.Golden.html#6141" class="Bound">args</a> <a id="6206" class="Symbol">}))</a>
  <a id="6212" href="Test.Golden.html#5670" class="Function">go</a> <a id="6215" class="Symbol">(</a><a id="6216" class="String">&quot;--only-file&quot;</a> <a id="6230" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6232" href="Test.Golden.html#6232" class="Bound">fp</a>    <a id="6238" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6240" href="Test.Golden.html#6240" class="Bound">args</a><a id="6244" class="Symbol">)</a> <a id="6246" href="Test.Golden.html#6246" class="Bound">mfp</a> <a id="6250" href="Test.Golden.html#6250" class="Bound">opts</a> <a id="6255" class="Symbol">=</a>
    <a id="6261" href="Test.Golden.html#5670" class="Function">go</a> <a id="6264" href="Test.Golden.html#6240" class="Bound">args</a> <a id="6269" class="Symbol">(</a><a id="6270" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6275" href="Test.Golden.html#6232" class="Bound">fp</a><a id="6277" class="Symbol">)</a> <a id="6279" class="Symbol">(</a><a id="6280" class="Keyword">record</a> <a id="6287" href="Test.Golden.html#6250" class="Bound">opts</a> <a id="6292" class="Symbol">{</a> <a id="6294" href="Test.Golden.html#4540" class="Field">onlyNames</a> <a id="6304" class="Symbol">=</a> <a id="6306" href="Test.Golden.html#6240" class="Bound">args</a> <a id="6311" class="Symbol">})</a>
  <a id="6316" href="Test.Golden.html#5670" class="Function">go</a> <a id="6319" class="Symbol">(</a><a id="6320" class="String">&quot;--no-colour&quot;</a>         <a id="6342" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6344" href="Test.Golden.html#6344" class="Bound">args</a><a id="6348" class="Symbol">)</a> <a id="6350" href="Test.Golden.html#6350" class="Bound">mfp</a> <a id="6354" href="Test.Golden.html#6354" class="Bound">opts</a> <a id="6359" class="Symbol">=</a>
    <a id="6365" href="Test.Golden.html#5670" class="Function">go</a> <a id="6368" href="Test.Golden.html#6344" class="Bound">args</a> <a id="6373" href="Test.Golden.html#6350" class="Bound">mfp</a> <a id="6377" class="Symbol">(</a><a id="6378" class="Keyword">record</a> <a id="6385" href="Test.Golden.html#6354" class="Bound">opts</a> <a id="6390" class="Symbol">{</a> <a id="6392" href="Test.Golden.html#4857" class="Field">colour</a> <a id="6399" class="Symbol">=</a> <a id="6401" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="6407" class="Symbol">})</a>
  <a id="6412" href="Test.Golden.html#5670" class="CatchallClause Function">go</a><a id="6414" class="CatchallClause"> </a><a id="6415" class="CatchallClause Symbol">(</a><a id="6416" href="Test.Golden.html#6416" class="CatchallClause Bound">arg</a><a id="6419" class="CatchallClause"> </a><a id="6420" href="Agda.Builtin.List.html#200" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6421" class="CatchallClause"> </a><a id="6422" class="CatchallClause Symbol">_)</a><a id="6424" class="CatchallClause"> </a><a id="6425" class="CatchallClause Symbol">_</a><a id="6426" class="CatchallClause"> </a><a id="6427" class="CatchallClause Symbol">_</a> <a id="6429" class="Symbol">=</a> <a id="6431" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="6436" href="Test.Golden.html#6416" class="Bound">arg</a>

  <a id="6443" href="Test.Golden.html#6443" class="Function">mkOptions</a> <a id="6453" class="Symbol">:</a> <a id="6455" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="6462" class="Symbol">→</a> <a id="6464" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="6469" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="6476" class="Symbol">→</a> <a id="6478" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="6481" class="Symbol">(</a><a id="6482" href="Test.Golden.html#5306" class="Datatype">Error</a> <a id="6488" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="6490" href="Test.Golden.html#4387" class="Record">Options</a><a id="6497" class="Symbol">)</a>
  <a id="6501" href="Test.Golden.html#6443" class="Function">mkOptions</a> <a id="6511" href="Test.Golden.html#6511" class="Bound">exe</a> <a id="6515" href="Test.Golden.html#6515" class="Bound">rest</a> <a id="6520" class="Symbol">=</a> <a id="6522" class="Keyword">do</a>
    <a id="6529" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="6534" class="Symbol">(</a><a id="6535" href="Test.Golden.html#6535" class="Bound">mfp</a> <a id="6539" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6541" href="Test.Golden.html#6541" class="Bound">opts</a><a id="6545" class="Symbol">)</a> <a id="6547" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="6549" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="6554" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6556" href="Test.Golden.html#5670" class="Function">go</a> <a id="6559" href="Test.Golden.html#6515" class="Bound">rest</a> <a id="6564" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="6572" class="Symbol">(</a><a id="6573" href="Test.Golden.html#4885" class="Function">initOptions</a> <a id="6585" href="Test.Golden.html#6511" class="Bound">exe</a><a id="6588" class="Symbol">)</a>
      <a id="6596" class="Keyword">where</a> <a id="6602" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="6607" href="Test.Golden.html#6607" class="Bound">arg</a> <a id="6611" class="Symbol">→</a> <a id="6613" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="6618" class="Symbol">(</a><a id="6619" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="6624" class="Symbol">(</a><a id="6625" href="Test.Golden.html#5354" class="InductiveConstructor">InvalidArgument</a> <a id="6641" href="Test.Golden.html#6607" class="Bound">arg</a><a id="6644" class="Symbol">))</a>
    <a id="6651" href="Test.Golden.html#6651" class="Bound">term</a> <a id="6656" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="6658" href="Data.Maybe.Base.html#1647" class="Function">fromMaybe</a> <a id="6668" class="String">&quot;&quot;</a> <a id="6671" href="IO.Base.html#1964" class="Function Operator">&lt;$&gt;</a> <a id="6675" href="System.Environment.html#763" class="Function">lookupEnv</a> <a id="6685" class="String">&quot;TERM&quot;</a>
    <a id="6696" class="Keyword">let</a> <a id="6700" href="Test.Golden.html#6700" class="Bound">opts</a> <a id="6705" class="Symbol">=</a> <a id="6707" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="6710" href="Relation.Nullary.Decidable.Core.html#1546" class="Field">does</a> <a id="6715" class="Symbol">(</a><a id="6716" href="Test.Golden.html#6651" class="Bound">term</a> <a id="6721" href="Data.String.Properties.html#2285" class="Function Operator">≟</a> <a id="6723" class="String">&quot;DUMB&quot;</a><a id="6729" class="Symbol">)</a>
               <a id="6746" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="6751" class="Keyword">record</a> <a id="6758" href="Test.Golden.html#6541" class="Bound">opts</a> <a id="6763" class="Symbol">{</a> <a id="6765" href="Test.Golden.html#4857" class="Field">colour</a> <a id="6772" class="Symbol">=</a> <a id="6774" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="6780" class="Symbol">}</a>
               <a id="6797" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="6802" href="Test.Golden.html#6541" class="Bound">opts</a>
    <a id="6811" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6816" href="Test.Golden.html#6816" class="Bound">fp</a> <a id="6819" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="6821" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="6826" href="Test.Golden.html#6535" class="Bound">mfp</a>
      <a id="6836" class="Keyword">where</a> <a id="6842" class="CatchallClause Symbol">_</a> <a id="6844" class="Symbol">→</a> <a id="6846" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="6851" class="Symbol">(</a><a id="6852" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="6857" href="Test.Golden.html#6700" class="Bound">opts</a><a id="6861" class="Symbol">)</a>
    <a id="6867" href="Test.Golden.html#6867" class="Bound">only</a> <a id="6872" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="6874" href="IO.html#2864" class="Function">readFiniteFile</a> <a id="6889" href="Test.Golden.html#6816" class="Bound">fp</a>
    <a id="6896" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="6901" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6903" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="6908" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6910" class="Keyword">record</a> <a id="6917" href="Test.Golden.html#6700" class="Bound">opts</a> <a id="6922" class="Symbol">{</a> <a id="6924" href="Test.Golden.html#4540" class="Field">onlyNames</a> <a id="6934" class="Symbol">=</a> <a id="6936" href="Data.String.Base.html#5098" class="Function">lines</a> <a id="6942" href="Test.Golden.html#6867" class="Bound">only</a> <a id="6947" href="Data.List.Base.html#1929" class="Function Operator">++</a> <a id="6950" href="Test.Golden.html#4540" class="Field">onlyNames</a> <a id="6960" href="Test.Golden.html#6700" class="Bound">opts</a> <a id="6965" class="Symbol">}</a>

<a id="6968" href="Test.Golden.html#5575" class="Function">options</a> <a id="6976" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="6979" class="Symbol">=</a> <a id="6981" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="6986" class="Symbol">(</a><a id="6987" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="6992" href="Test.Golden.html#5326" class="InductiveConstructor">MissingExecutable</a><a id="7009" class="Symbol">)</a>


<a id="7013" class="Comment">-- The result of a test run</a>
<a id="7041" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7101" href="Test.Golden.html#7101" class="Function">Result</a> <a id="7108" class="Symbol">:</a> <a id="7110" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="7114" href="Test.Golden.html#7101" class="Function">Result</a> <a id="7121" class="Symbol">=</a> <a id="7123" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="7130" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="7132" href="Agda.Builtin.String.html#336" class="Postulate">String</a>

<a id="7140" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7200" href="Test.Golden.html#7200" class="Function">runTest</a> <a id="7208" class="Symbol">:</a> <a id="7210" href="Test.Golden.html#4387" class="Record">Options</a> <a id="7218" class="Symbol">→</a> <a id="7220" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="7227" class="Symbol">→</a> <a id="7229" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="7232" href="Test.Golden.html#7101" class="Function">Result</a>
<a id="7239" href="Test.Golden.html#7200" class="Function">runTest</a> <a id="7247" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="7252" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="7261" class="Symbol">=</a> <a id="7263" class="Keyword">do</a>

  <a id="7269" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="7274" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="7276" href="System.Directory.html#3093" class="Function">doesDirectoryExist</a> <a id="7295" class="Symbol">(</a><a id="7296" href="System.FilePath.Posix.Primitive.html#2547" class="Postulate">mkFilePath</a> <a id="7307" href="Test.Golden.html#7252" class="Bound">testPath</a><a id="7315" class="Symbol">)</a>
    <a id="7321" class="Keyword">where</a> <a id="7327" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="7333" class="Symbol">→</a> <a id="7335" href="Test.Golden.html#8880" class="Function">fail</a> <a id="7340" href="Test.Golden.html#8501" class="Function">directoryNotFound</a>

  <a id="7361" href="Test.Golden.html#7361" class="Bound">time</a> <a id="7366" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="7368" href="System.Clock.html#2755" class="Function">time′</a> <a id="7374" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7376" href="System.Process.html#640" class="Function">callCommand</a> <a id="7388" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7390" href="Data.String.Base.html#2757" class="Function">unwords</a>
           <a id="7409" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7411" class="String">&quot;cd&quot;</a> <a id="7416" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7418" href="Test.Golden.html#7252" class="Bound">testPath</a>
           <a id="7438" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7440" class="String">&quot;&amp;&amp;&quot;</a> <a id="7445" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7447" class="String">&quot;sh ./run&quot;</a> <a id="7458" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7460" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="7465" class="Symbol">.</a><a id="7466" href="Test.Golden.html#4467" class="Field">exeUnderTest</a>
           <a id="7490" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7492" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7528" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7530" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="7536" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="7541" href="Test.Golden.html#7541" class="Bound">out</a> <a id="7545" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="7547" href="Test.Golden.html#8981" class="Function">readLocalFile</a> <a id="7561" class="String">&quot;output&quot;</a>
    <a id="7574" class="Keyword">where</a> <a id="7580" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="7588" class="Symbol">→</a> <a id="7590" href="Test.Golden.html#8880" class="Function">fail</a> <a id="7595" class="Symbol">(</a><a id="7596" href="Test.Golden.html#8680" class="Function">fileNotFound</a> <a id="7609" class="String">&quot;output&quot;</a><a id="7617" class="Symbol">)</a>
  <a id="7621" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="7626" href="Test.Golden.html#7626" class="Bound">exp</a> <a id="7630" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="7632" href="Test.Golden.html#8981" class="Function">readLocalFile</a> <a id="7646" class="String">&quot;expected&quot;</a>
    <a id="7661" class="Keyword">where</a> <a id="7667" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="7675" class="Symbol">→</a> <a id="7677" class="Keyword">do</a> <a id="7680" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="7683" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="7688" class="Symbol">.</a><a id="7689" href="Test.Golden.html#4619" class="Field">interactive</a>
                         <a id="7726" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="7731" href="Test.Golden.html#9748" class="Function">mayOverwrite</a> <a id="7744" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="7752" href="Test.Golden.html#7541" class="Bound">out</a>
                         <a id="7781" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="7786" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="7795" class="Symbol">(</a><a id="7796" href="Test.Golden.html#8680" class="Function">fileNotFound</a> <a id="7809" class="String">&quot;expected&quot;</a><a id="7819" class="Symbol">)</a>
                       <a id="7844" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="7849" class="Symbol">(</a><a id="7850" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="7855" href="Test.Golden.html#7252" class="Bound">testPath</a><a id="7863" class="Symbol">)</a>

  <a id="7868" class="Keyword">let</a> <a id="7872" href="Test.Golden.html#7872" class="Bound">result</a> <a id="7879" class="Symbol">=</a> <a id="7881" href="Relation.Nullary.Decidable.Core.html#1546" class="Field">does</a> <a id="7886" class="Symbol">(</a><a id="7887" href="Test.Golden.html#7541" class="Bound">out</a> <a id="7891" href="Data.String.Properties.html#2285" class="Function Operator">String.≟</a> <a id="7900" href="Test.Golden.html#7626" class="Bound">exp</a><a id="7903" class="Symbol">)</a>

  <a id="7908" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="7911" href="Test.Golden.html#7872" class="Bound">result</a>
    <a id="7922" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="7927" href="Test.Golden.html#10564" class="Function">printTiming</a> <a id="7939" class="Symbol">(</a><a id="7940" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="7945" class="Symbol">.</a><a id="7946" href="Test.Golden.html#4687" class="Field">timing</a><a id="7952" class="Symbol">)</a> <a id="7954" href="Test.Golden.html#7361" class="Bound">time</a>
           <a id="7970" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7972" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="7975" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="7980" class="Symbol">.</a><a id="7981" href="Test.Golden.html#4857" class="Field">colour</a>
               <a id="8003" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8008" href="System.Console.ANSI.html#2064" class="Function">withCommand</a> <a id="8020" class="Symbol">(</a><a id="8021" href="System.Console.ANSI.html#965" class="InductiveConstructor">setColour</a> <a id="8031" href="System.Console.ANSI.html#534" class="InductiveConstructor">foreground</a> <a id="8042" href="System.Console.ANSI.html#677" class="InductiveConstructor">classic</a> <a id="8050" href="System.Console.ANSI.html#601" class="InductiveConstructor">green</a><a id="8055" class="Symbol">)</a>
               <a id="8072" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8077" href="Function.Base.html#695" class="Function">id</a>
           <a id="8091" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8093" class="String">&quot;success&quot;</a>
    <a id="8107" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8112" class="Keyword">do</a> <a id="8115" href="Test.Golden.html#10564" class="Function">printTiming</a> <a id="8127" class="Symbol">(</a><a id="8128" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="8133" class="Symbol">.</a><a id="8134" href="Test.Golden.html#4687" class="Field">timing</a><a id="8140" class="Symbol">)</a> <a id="8142" href="Test.Golden.html#7361" class="Bound">time</a>
             <a id="8160" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8162" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="8165" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="8170" class="Symbol">.</a><a id="8171" href="Test.Golden.html#4857" class="Field">colour</a>
               <a id="8193" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8198" href="System.Console.ANSI.html#2064" class="Function">withCommand</a> <a id="8210" class="Symbol">(</a><a id="8211" href="System.Console.ANSI.html#965" class="InductiveConstructor">setColour</a> <a id="8221" href="System.Console.ANSI.html#534" class="InductiveConstructor">foreground</a> <a id="8232" href="System.Console.ANSI.html#685" class="InductiveConstructor">bright</a> <a id="8239" href="System.Console.ANSI.html#597" class="InductiveConstructor">red</a><a id="8242" class="Symbol">)</a>
               <a id="8259" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8264" href="Function.Base.html#695" class="Function">id</a>
             <a id="8280" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8282" class="String">&quot;FAILURE&quot;</a>
            <a id="8304" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="8307" href="Test.Golden.html#7247" class="Bound">opts</a> <a id="8312" class="Symbol">.</a><a id="8313" href="Test.Golden.html#4619" class="Field">interactive</a>
              <a id="8339" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8344" href="Test.Golden.html#9748" class="Function">mayOverwrite</a> <a id="8357" class="Symbol">(</a><a id="8358" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="8363" href="Test.Golden.html#7626" class="Bound">exp</a><a id="8366" class="Symbol">)</a> <a id="8368" href="Test.Golden.html#7541" class="Bound">out</a>
              <a id="8386" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8391" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="8400" class="Symbol">(</a><a id="8401" href="Data.String.Base.html#2815" class="Function">unlines</a> <a id="8409" class="Symbol">(</a><a id="8410" href="Test.Golden.html#9514" class="Function">expVsOut</a> <a id="8419" href="Test.Golden.html#7626" class="Bound">exp</a> <a id="8423" href="Test.Golden.html#7541" class="Bound">out</a><a id="8426" class="Symbol">))</a>

  <a id="8432" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="8437" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8439" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="8442" href="Test.Golden.html#7872" class="Bound">result</a> <a id="8449" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8454" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="8459" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="8468" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8473" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="8478" href="Test.Golden.html#7252" class="Bound">testPath</a>

  <a id="8490" class="Keyword">where</a>

    <a id="8501" href="Test.Golden.html#8501" class="Function">directoryNotFound</a> <a id="8519" class="Symbol">:</a> <a id="8521" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="8532" href="Test.Golden.html#8501" class="Function">directoryNotFound</a> <a id="8550" class="Symbol">=</a> <a id="8552" href="Data.String.Base.html#2757" class="Function">unwords</a>
                      <a id="8582" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8584" class="String">&quot;Directory&quot;</a>
                      <a id="8618" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8620" href="Test.Golden.html#7252" class="Bound">testPath</a>
                      <a id="8651" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8653" class="String">&quot;does not exist&quot;</a> <a id="8670" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8672" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

    <a id="8680" href="Test.Golden.html#8680" class="Function">fileNotFound</a> <a id="8693" class="Symbol">:</a> <a id="8695" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="8702" class="Symbol">→</a> <a id="8704" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="8715" href="Test.Golden.html#8680" class="Function">fileNotFound</a> <a id="8728" href="Test.Golden.html#8728" class="Bound">name</a> <a id="8733" class="Symbol">=</a> <a id="8735" href="Data.String.Base.html#2757" class="Function">unwords</a>
                      <a id="8765" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8767" class="String">&quot;File&quot;</a>
                      <a id="8796" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8798" class="Symbol">(</a><a id="8799" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="8808" href="Data.String.Base.html#2414" class="Function Operator">String.++</a> <a id="8818" class="String">&quot;/output&quot;</a><a id="8827" class="Symbol">)</a>
                      <a id="8851" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8853" class="String">&quot;does not exist&quot;</a> <a id="8870" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8872" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

    <a id="8880" href="Test.Golden.html#8880" class="Function">fail</a> <a id="8885" class="Symbol">:</a> <a id="8887" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="8894" class="Symbol">→</a> <a id="8896" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="8899" href="Test.Golden.html#7101" class="Function">Result</a>
    <a id="8910" href="Test.Golden.html#8880" class="Function">fail</a> <a id="8915" href="Test.Golden.html#8915" class="Bound">msg</a> <a id="8919" class="Symbol">=</a> <a id="8921" class="Keyword">do</a> <a id="8924" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="8933" href="Test.Golden.html#8915" class="Bound">msg</a>
                  <a id="8955" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="8960" class="Symbol">(</a><a id="8961" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="8966" href="Test.Golden.html#7252" class="Bound">testPath</a><a id="8974" class="Symbol">)</a>

    <a id="8981" href="Test.Golden.html#8981" class="Function">readLocalFile</a> <a id="8995" class="Symbol">:</a> <a id="8997" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9004" class="Symbol">→</a> <a id="9006" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="9009" class="Symbol">(</a><a id="9010" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="9016" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="9022" class="Symbol">)</a>
    <a id="9028" href="Test.Golden.html#8981" class="Function">readLocalFile</a> <a id="9042" href="Test.Golden.html#9042" class="Bound">name</a> <a id="9047" class="Symbol">=</a> <a id="9049" class="Keyword">do</a>
      <a id="9058" class="Keyword">let</a> <a id="9062" href="Test.Golden.html#9062" class="Bound">fp</a> <a id="9065" class="Symbol">=</a> <a id="9067" href="Data.String.Base.html#2602" class="Function">concat</a> <a id="9074" class="Symbol">(</a><a id="9075" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="9084" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9086" class="String">&quot;/&quot;</a> <a id="9090" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9092" href="Test.Golden.html#9042" class="Bound">name</a> <a id="9097" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9099" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="9101" class="Symbol">)</a>
      <a id="9109" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="9114" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="9116" href="System.Directory.html#3041" class="Function">doesFileExist</a> <a id="9130" class="Symbol">(</a><a id="9131" href="System.FilePath.Posix.Primitive.html#2547" class="Postulate">mkFilePath</a> <a id="9142" href="Test.Golden.html#9062" class="Bound">fp</a><a id="9144" class="Symbol">)</a>
        <a id="9154" class="Keyword">where</a> <a id="9160" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="9166" class="Symbol">→</a> <a id="9168" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="9173" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
      <a id="9187" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9192" href="IO.Base.html#1964" class="Function Operator">&lt;$&gt;</a> <a id="9196" href="IO.html#2864" class="Function">readFiniteFile</a> <a id="9211" href="Test.Golden.html#9062" class="Bound">fp</a>

    <a id="9219" href="Test.Golden.html#9219" class="Function">getAnswer</a> <a id="9229" class="Symbol">:</a> <a id="9231" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="9234" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="9243" href="Test.Golden.html#9219" class="Function">getAnswer</a> <a id="9253" class="Symbol">=</a> <a id="9255" href="IO.Base.html#3665" class="Function">untilJust</a> <a id="9265" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9267" class="Keyword">do</a>
      <a id="9276" href="Test.Golden.html#9276" class="Bound">str</a> <a id="9280" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="9282" href="IO.Finite.html#1036" class="Function">getLine</a>
      <a id="9296" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="9301" href="Test.Golden.html#9276" class="Bound">str</a> <a id="9305" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="9308" class="Symbol">λ</a> <a id="9310" class="Keyword">where</a>
        <a id="9324" class="String">&quot;y&quot;</a> <a id="9328" class="Symbol">→</a> <a id="9330" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="9335" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9337" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9342" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
        <a id="9355" class="String">&quot;n&quot;</a> <a id="9359" class="Symbol">→</a> <a id="9361" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="9366" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9368" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9373" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
        <a id="9387" class="String">&quot;&quot;</a>  <a id="9391" class="Symbol">→</a> <a id="9393" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="9398" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9400" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9405" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="9411" class="Comment">-- default answer is no</a>
        <a id="9443" class="Symbol">_</a>   <a id="9447" class="Symbol">→</a> <a id="9449" class="Keyword">do</a> <a id="9452" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="9461" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9496" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="9501" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

    <a id="9514" href="Test.Golden.html#9514" class="Function">expVsOut</a> <a id="9523" class="Symbol">:</a> <a id="9525" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9532" class="Symbol">→</a> <a id="9534" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9541" class="Symbol">→</a> <a id="9543" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="9548" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="9559" href="Test.Golden.html#9514" class="Function">expVsOut</a> <a id="9568" href="Test.Golden.html#9568" class="Bound">exp</a> <a id="9572" href="Test.Golden.html#9572" class="Bound">out</a> <a id="9576" class="Symbol">=</a> <a id="9578" class="String">&quot;Expected:&quot;</a> <a id="9590" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9592" href="Test.Golden.html#9568" class="Bound">exp</a> <a id="9596" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9598" class="String">&quot;Given:&quot;</a> <a id="9607" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9609" href="Test.Golden.html#9572" class="Bound">out</a> <a id="9613" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9615" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

    <a id="9623" href="Test.Golden.html#9623" class="Function">hasFailed</a> <a id="9633" class="Symbol">:</a> <a id="9635" href="System.Exit.Primitive.html#393" class="Datatype">ExitCode</a> <a id="9644" class="Symbol">→</a> <a id="9646" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="9655" href="Test.Golden.html#9623" class="Function">hasFailed</a> <a id="9665" href="System.Exit.Primitive.html#416" class="InductiveConstructor">ExitSuccess</a>        <a id="9684" class="Symbol">=</a> <a id="9686" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
    <a id="9696" href="Test.Golden.html#9623" class="Function">hasFailed</a> <a id="9706" class="Symbol">(</a><a id="9707" href="System.Exit.Primitive.html#441" class="InductiveConstructor">ExitFailure</a> <a id="9719" href="Test.Golden.html#9719" class="Bound">code</a><a id="9723" class="Symbol">)</a> <a id="9725" class="Symbol">=</a> <a id="9727" href="Test.Golden.html#9719" class="Bound">code</a> <a id="9732" href="Data.Integer.Base.html#2601" class="Function Operator">ℤ.≤ᵇ</a> <a id="9737" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">ℤ.+</a> <a id="9741" class="Number">0</a>

    <a id="9748" href="Test.Golden.html#9748" class="Function">mayOverwrite</a> <a id="9761" class="Symbol">:</a> <a id="9763" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="9769" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9776" class="Symbol">→</a> <a id="9778" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9785" class="Symbol">→</a> <a id="9787" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="9790" class="Symbol">_</a>
    <a id="9796" href="Test.Golden.html#9748" class="Function">mayOverwrite</a> <a id="9809" href="Test.Golden.html#9809" class="Bound">mexp</a> <a id="9814" href="Test.Golden.html#9814" class="Bound">out</a> <a id="9818" class="Symbol">=</a> <a id="9820" class="Keyword">do</a>
      <a id="9829" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="9834" href="Test.Golden.html#9809" class="Bound">mexp</a> <a id="9839" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="9842" class="Symbol">λ</a> <a id="9844" class="Keyword">where</a>
        <a id="9858" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="9866" class="Symbol">→</a> <a id="9868" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="9877" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9879" href="Data.String.Base.html#2815" class="Function">unlines</a>
          <a id="9897" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9899" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="9966" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9968" href="Test.Golden.html#9814" class="Bound">out</a>
          <a id="9982" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9984" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10027" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10029" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
        <a id="10040" class="Symbol">(</a><a id="10041" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="10046" href="Test.Golden.html#10046" class="Bound">exp</a><a id="10049" class="Symbol">)</a> <a id="10051" class="Symbol">→</a> <a id="10053" class="Keyword">do</a>
          <a id="10066" href="Test.Golden.html#10066" class="Bound">code</a> <a id="10071" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="10073" href="System.Process.html#720" class="Function">system</a> <a id="10080" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10082" href="Data.String.Base.html#2602" class="Function">concat</a>
            <a id="10101" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10103" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10168" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10170" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="10179" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10181" class="String">&quot;/expected &quot;</a>
            <a id="10206" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10208" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="10217" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10219" class="String">&quot;/output&quot;</a>
            <a id="10241" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10243" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
          <a id="10256" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="10265" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10267" href="Data.String.Base.html#2815" class="Function">unlines</a>
            <a id="10287" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10289" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10343" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10345" class="Symbol">(</a><a id="10346" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="10349" href="Test.Golden.html#9623" class="Function">hasFailed</a> <a id="10359" href="Test.Golden.html#10066" class="Bound">code</a> <a id="10364" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="10369" href="Test.Golden.html#9514" class="Function">expVsOut</a> <a id="10378" href="Test.Golden.html#10046" class="Bound">exp</a> <a id="10382" href="Test.Golden.html#9814" class="Bound">out</a> <a id="10386" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="10391" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="10393" class="Symbol">)</a>
            <a id="10407" href="Data.List.Base.html#1929" class="Function Operator">++</a> <a id="10410" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10471" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10473" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

      <a id="10483" href="Test.Golden.html#10483" class="Bound">b</a> <a id="10485" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="10487" href="Test.Golden.html#9219" class="Function">getAnswer</a>
      <a id="10503" href="IO.Base.html#3325" class="Function">when</a> <a id="10508" href="Test.Golden.html#10483" class="Bound">b</a> <a id="10510" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10512" href="IO.Finite.html#1267" class="Function">writeFile</a> <a id="10522" class="Symbol">(</a><a id="10523" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="10532" href="Data.String.Base.html#2414" class="Function Operator">String.++</a> <a id="10542" class="String">&quot;/expected&quot;</a><a id="10553" class="Symbol">)</a> <a id="10555" href="Test.Golden.html#9814" class="Bound">out</a>

    <a id="10564" href="Test.Golden.html#10564" class="Function">printTiming</a> <a id="10576" class="Symbol">:</a> <a id="10578" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="10583" class="Symbol">→</a> <a id="10585" href="System.Clock.html#1910" class="Record">Time</a> <a id="10590" class="Symbol">→</a> <a id="10592" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="10599" class="Symbol">→</a> <a id="10601" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="10604" class="Symbol">_</a>
    <a id="10610" href="Test.Golden.html#10564" class="Function">printTiming</a> <a id="10622" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="10628" class="Symbol">_</a>    <a id="10633" href="Test.Golden.html#10633" class="Bound">msg</a> <a id="10637" class="Symbol">=</a> <a id="10639" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="10648" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10650" href="Data.String.Base.html#2602" class="Function">concat</a> <a id="10657" class="Symbol">(</a><a id="10658" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="10667" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10669" class="String">&quot;: &quot;</a> <a id="10674" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10676" href="Test.Golden.html#10633" class="Bound">msg</a> <a id="10680" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10682" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="10684" class="Symbol">)</a>
    <a id="10690" href="Test.Golden.html#10564" class="Function">printTiming</a> <a id="10702" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>  <a id="10708" href="Test.Golden.html#10708" class="Bound">time</a> <a id="10713" href="Test.Golden.html#10713" class="Bound">msg</a> <a id="10717" class="Symbol">=</a>
      <a id="10725" class="Keyword">let</a> <a id="10729" href="Test.Golden.html#10729" class="Bound">time</a>  <a id="10735" class="Symbol">=</a> <a id="10737" href="Data.Nat.Show.html#1924" class="Function">ℕ.show</a> <a id="10744" class="Symbol">(</a><a id="10745" href="Test.Golden.html#10708" class="Bound">time</a> <a id="10750" class="Symbol">.</a><a id="10751" href="System.Clock.html#1956" class="Field">seconds</a><a id="10758" class="Symbol">)</a> <a id="10760" href="Data.String.Base.html#2414" class="Function Operator">String.++</a> <a id="10770" class="String">&quot;s&quot;</a>
          <a id="10784" href="Test.Golden.html#10784" class="Bound">spent</a> <a id="10790" class="Symbol">=</a> <a id="10792" class="Number">9</a> <a id="10794" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="10796" href="Data.List.Base.html#4978" class="Function">List.sum</a> <a id="10805" class="Symbol">(</a><a id="10806" href="Data.List.Base.html#1606" class="Function">List.map</a> <a id="10815" href="Data.String.Base.html#2478" class="Function">String.length</a> <a id="10829" class="Symbol">(</a><a id="10830" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="10839" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10841" href="Test.Golden.html#10729" class="Bound">time</a> <a id="10846" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10848" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="10850" class="Symbol">))</a>
               <a id="10868" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="10944" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11027" href="Test.Golden.html#11027" class="Bound">pad</a>   <a id="11033" class="Symbol">=</a> <a id="11035" href="Data.String.Base.html#2529" class="Function">String.replicate</a> <a id="11052" class="Symbol">(</a><a id="11053" class="Number">72</a> <a id="11056" href="Data.Nat.Base.html#3202" class="Primitive Operator">∸</a> <a id="11058" href="Test.Golden.html#10784" class="Bound">spent</a><a id="11063" class="Symbol">)</a> <a id="11065" class="String">&#39; &#39;</a>
      <a id="11075" class="Keyword">in</a> <a id="11078" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="11087" class="Symbol">(</a><a id="11088" href="Data.String.Base.html#2602" class="Function">concat</a> <a id="11095" class="Symbol">(</a><a id="11096" href="Test.Golden.html#7252" class="Bound">testPath</a> <a id="11105" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11107" class="String">&quot;: &quot;</a> <a id="11112" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11114" href="Test.Golden.html#10713" class="Bound">msg</a> <a id="11118" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11120" href="Test.Golden.html#11027" class="Bound">pad</a> <a id="11124" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11126" href="Test.Golden.html#10729" class="Bound">time</a> <a id="11131" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11133" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="11135" class="Symbol">))</a>

<a id="11139" class="Comment">-- A test pool is characterised by</a>
<a id="11174" class="Comment">--  + a name</a>
<a id="11187" class="Comment">--  + and a list of directory paths</a>
<a id="11223" class="Keyword">record</a> <a id="TestPool"></a><a id="11230" href="Test.Golden.html#11230" class="Record">TestPool</a> <a id="11239" class="Symbol">:</a> <a id="11241" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="11245" class="Keyword">where</a>
  <a id="11253" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11265" href="Test.Golden.html#11265" class="InductiveConstructor">mkTestPool</a>
  <a id="11278" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11288" href="Test.Golden.html#11288" class="Field">poolName</a> <a id="11297" class="Symbol">:</a> <a id="11299" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11310" href="Test.Golden.html#11310" class="Field">testCases</a> <a id="11320" class="Symbol">:</a> <a id="11322" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11327" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="11334" class="Keyword">open</a> <a id="11339" href="Test.Golden.html#11230" class="Module">TestPool</a>

<a id="11349" class="Keyword">module</a> <a id="Summary"></a><a id="11356" href="Test.Golden.html#11356" class="Module">Summary</a> <a id="11364" class="Keyword">where</a>

  <a id="11373" class="Comment">-- The summary of a test pool run</a>
  <a id="11409" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11416" href="Test.Golden.html#11416" class="Record">Summary</a> <a id="11424" class="Symbol">:</a> <a id="11426" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="11430" class="Keyword">where</a>
    <a id="11440" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11452" href="Test.Golden.html#11452" class="InductiveConstructor">mkSummary</a>
    <a id="11466" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11478" href="Test.Golden.html#11478" class="Field">success</a> <a id="11486" class="Symbol">:</a> <a id="11488" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11493" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11506" href="Test.Golden.html#11506" class="Field">failure</a> <a id="11514" class="Symbol">:</a> <a id="11516" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11521" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="11530" class="Keyword">open</a> <a id="11535" href="Test.Golden.html#11416" class="Module">Summary</a> <a id="11543" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11553" href="Test.Golden.html#11553" class="Function">init</a> <a id="11558" class="Symbol">:</a> <a id="11560" href="Test.Golden.html#11416" class="Record">Summary</a>
  <a id="11570" href="Test.Golden.html#11553" class="Function">init</a> <a id="11575" class="Symbol">=</a> <a id="11577" href="Test.Golden.html#11452" class="InductiveConstructor">mkSummary</a> <a id="11587" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="11590" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11596" href="Test.Golden.html#11596" class="Function">merge</a> <a id="11602" class="Symbol">:</a> <a id="11604" href="Test.Golden.html#11416" class="Record">Summary</a> <a id="11612" class="Symbol">→</a> <a id="11614" href="Test.Golden.html#11416" class="Record">Summary</a> <a id="11622" class="Symbol">→</a> <a id="11624" href="Test.Golden.html#11416" class="Record">Summary</a>
  <a id="11634" href="Test.Golden.html#11596" class="Function">merge</a> <a id="11640" class="Symbol">(</a><a id="11641" href="Test.Golden.html#11452" class="InductiveConstructor">mkSummary</a> <a id="11651" href="Test.Golden.html#11651" class="Bound">ws1</a> <a id="11655" href="Test.Golden.html#11655" class="Bound">ls1</a><a id="11658" class="Symbol">)</a> <a id="11660" class="Symbol">(</a><a id="11661" href="Test.Golden.html#11452" class="InductiveConstructor">mkSummary</a> <a id="11671" href="Test.Golden.html#11671" class="Bound">ws2</a> <a id="11675" href="Test.Golden.html#11675" class="Bound">ls2</a><a id="11678" class="Symbol">)</a> <a id="11680" class="Symbol">=</a>
   <a id="11685" href="Test.Golden.html#11452" class="InductiveConstructor">mkSummary</a> <a id="11695" class="Symbol">(</a><a id="11696" href="Test.Golden.html#11671" class="Bound">ws2</a> <a id="11700" href="Data.List.Base.html#1929" class="Function Operator">++</a> <a id="11703" href="Test.Golden.html#11651" class="Bound">ws1</a><a id="11706" class="Symbol">)</a> <a id="11708" class="Symbol">(</a><a id="11709" href="Test.Golden.html#11675" class="Bound">ls2</a> <a id="11713" href="Data.List.Base.html#1929" class="Function Operator">++</a> <a id="11716" href="Test.Golden.html#11655" class="Bound">ls1</a><a id="11719" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11724" href="Test.Golden.html#11724" class="Function">update</a> <a id="11731" class="Symbol">:</a> <a id="11733" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11738" href="Test.Golden.html#7101" class="Function">Result</a> <a id="11745" class="Symbol">→</a> <a id="11747" href="Test.Golden.html#11416" class="Record">Summary</a> <a id="11755" class="Symbol">→</a> <a id="11757" href="Test.Golden.html#11416" class="Record">Summary</a>
  <a id="11767" href="Test.Golden.html#11724" class="Function">update</a> <a id="11774" href="Test.Golden.html#11774" class="Bound">res</a> <a id="11778" href="Test.Golden.html#11778" class="Bound">sum</a> <a id="11782" class="Symbol">=</a>
    <a id="11788" class="Keyword">let</a> <a id="11792" class="Symbol">(</a><a id="11793" href="Test.Golden.html#11793" class="Bound">ls2</a> <a id="11797" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="11799" href="Test.Golden.html#11799" class="Bound">ws2</a><a id="11802" class="Symbol">)</a> <a id="11804" class="Symbol">=</a> <a id="11806" href="Data.List.Base.html#3879" class="Function">partitionSums</a> <a id="11820" href="Test.Golden.html#11774" class="Bound">res</a> <a id="11824" class="Keyword">in</a>
    <a id="11831" href="Test.Golden.html#11596" class="Function">merge</a> <a id="11837" href="Test.Golden.html#11778" class="Bound">sum</a> <a id="11841" class="Symbol">(</a><a id="11842" href="Test.Golden.html#11452" class="InductiveConstructor">mkSummary</a> <a id="11852" href="Test.Golden.html#11799" class="Bound">ws2</a> <a id="11856" href="Test.Golden.html#11793" class="Bound">ls2</a><a id="11859" class="Symbol">)</a>

<a id="11862" class="Keyword">open</a> <a id="11867" href="Test.Golden.html#11356" class="Module">Summary</a> <a id="11875" class="Keyword">using</a> <a id="11881" class="Symbol">(</a><a id="11882" href="Test.Golden.html#11416" class="Record">Summary</a><a id="11889" class="Symbol">)</a> <a id="11891" class="Keyword">hiding</a> <a id="11898" class="Symbol">(</a><a id="11899" class="Keyword">module</a> <a id="11906" href="Test.Golden.html#11416" class="Module">Summary</a><a id="11913" class="Symbol">)</a>

<a id="11916" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="11964" href="Test.Golden.html#11964" class="Function">filterTests</a> <a id="11976" class="Symbol">:</a> <a id="11978" href="Test.Golden.html#4387" class="Record">Options</a> <a id="11986" class="Symbol">→</a> <a id="11988" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11993" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="12000" class="Symbol">→</a> <a id="12002" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="12007" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="12014" href="Test.Golden.html#11964" class="Function">filterTests</a> <a id="12026" href="Test.Golden.html#12026" class="Bound">opts</a> <a id="12031" class="Symbol">=</a> <a id="12033" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="12038" href="Test.Golden.html#4540" class="Field">onlyNames</a> <a id="12048" href="Test.Golden.html#12026" class="Bound">opts</a> <a id="12053" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="12056" class="Symbol">λ</a> <a id="12058" class="Keyword">where</a>
  <a id="12066" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="12069" class="Symbol">→</a> <a id="12071" href="Function.Base.html#695" class="Function">id</a>
  <a id="12076" href="Test.Golden.html#12076" class="CatchallClause Bound">xs</a> <a id="12079" class="Symbol">→</a> <a id="12081" class="Keyword">let</a> <a id="12085" href="Test.Golden.html#12085" class="Bound">names</a> <a id="12091" class="Symbol">=</a> <a id="12093" href="Data.List.Base.html#1606" class="Function">List.map</a> <a id="12102" href="Data.String.Base.html#1541" class="Primitive">String.toList</a> <a id="12116" href="Test.Golden.html#12076" class="Bound">xs</a> <a id="12119" class="Keyword">in</a>
       <a id="12129" href="Data.List.Base.html#11403" class="Function">filter</a> <a id="12136" class="Symbol">(λ</a> <a id="12139" href="Test.Golden.html#12139" class="Bound">n</a> <a id="12141" class="Symbol">→</a> <a id="12143" href="Data.List.Relation.Unary.Any.html#2651" class="Function">any?</a> <a id="12148" class="Symbol">(λ</a> <a id="12151" href="Test.Golden.html#12151" class="Bound">m</a> <a id="12153" class="Symbol">→</a> <a id="12155" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6650" class="Function">infix?</a> <a id="12162" href="Data.Char.Properties.html#1490" class="Function Operator">Char._≟_</a> <a id="12171" href="Test.Golden.html#12151" class="Bound">m</a> <a id="12173" class="Symbol">(</a><a id="12174" href="Data.String.Base.html#1541" class="Primitive">String.toList</a> <a id="12188" href="Test.Golden.html#12139" class="Bound">n</a><a id="12189" class="Symbol">))</a> <a id="12192" href="Test.Golden.html#12085" class="Bound">names</a><a id="12197" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12200" href="Test.Golden.html#12200" class="Function">poolRunner</a> <a id="12211" class="Symbol">:</a> <a id="12213" href="Test.Golden.html#4387" class="Record">Options</a> <a id="12221" class="Symbol">→</a> <a id="12223" href="Test.Golden.html#11230" class="Record">TestPool</a> <a id="12232" class="Symbol">→</a> <a id="12234" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="12237" href="Test.Golden.html#11416" class="Record">Summary</a>
<a id="12245" href="Test.Golden.html#12200" class="Function">poolRunner</a> <a id="12256" href="Test.Golden.html#12256" class="Bound">opts</a> <a id="12261" href="Test.Golden.html#12261" class="Bound">pool</a> <a id="12266" class="Symbol">=</a> <a id="12268" class="Keyword">do</a>
  <a id="12273" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12334" class="Keyword">let</a> <a id="12338" href="Test.Golden.html#12338" class="Bound">tests</a> <a id="12344" class="Symbol">=</a> <a id="12346" href="Test.Golden.html#11964" class="Function">filterTests</a> <a id="12358" href="Test.Golden.html#12256" class="Bound">opts</a> <a id="12363" class="Symbol">(</a><a id="12364" href="Test.Golden.html#12261" class="Bound">pool</a> <a id="12369" class="Symbol">.</a><a id="12370" href="Test.Golden.html#11310" class="Field">testCases</a><a id="12379" class="Symbol">)</a>
  <a id="12383" class="Symbol">(_</a> <a id="12386" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12388" class="Symbol">_)</a> <a id="12391" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="12393" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="12398" href="Test.Golden.html#12338" class="Bound">tests</a>
    <a id="12408" class="Keyword">where</a> <a id="12414" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="12417" class="Symbol">→</a> <a id="12419" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="12424" href="Test.Golden.html#11553" class="Function">Summary.init</a>

  <a id="12440" class="Comment">-- announce the test pool and run them</a>
  <a id="12481" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="12490" href="Test.Golden.html#12595" class="Function">banner</a>
  <a id="12499" href="Test.Golden.html#12725" class="Function">loop</a> <a id="12504" href="Test.Golden.html#11553" class="Function">Summary.init</a> <a id="12517" href="Test.Golden.html#12338" class="Bound">tests</a>

  <a id="12526" class="Keyword">where</a>

  <a id="12535" href="Test.Golden.html#12535" class="Function">separator</a> <a id="12545" class="Symbol">:</a> <a id="12547" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="12556" href="Test.Golden.html#12535" class="Function">separator</a> <a id="12566" class="Symbol">=</a> <a id="12568" href="Data.String.Base.html#2529" class="Function">String.replicate</a> <a id="12585" class="Number">72</a> <a id="12588" class="String">&#39;-&#39;</a>

  <a id="12595" href="Test.Golden.html#12595" class="Function">banner</a> <a id="12602" class="Symbol">:</a> <a id="12604" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="12613" href="Test.Golden.html#12595" class="Function">banner</a> <a id="12620" class="Symbol">=</a> <a id="12622" href="Data.String.Base.html#2815" class="Function">unlines</a>
         <a id="12639" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="12641" class="String">&quot;&quot;</a> <a id="12644" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12646" href="Test.Golden.html#12535" class="Function">separator</a>
         <a id="12665" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12667" href="Test.Golden.html#12261" class="Bound">pool</a> <a id="12672" class="Symbol">.</a><a id="12673" href="Test.Golden.html#11288" class="Field">poolName</a>
         <a id="12691" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12693" href="Test.Golden.html#12535" class="Function">separator</a> <a id="12703" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12705" class="String">&quot;&quot;</a>
         <a id="12717" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12719" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="12725" href="Test.Golden.html#12725" class="Function">loop</a> <a id="12730" class="Symbol">:</a> <a id="12732" href="Test.Golden.html#11416" class="Record">Summary</a> <a id="12740" class="Symbol">→</a> <a id="12742" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="12747" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="12754" class="Symbol">→</a> <a id="12756" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="12759" href="Test.Golden.html#11416" class="Record">Summary</a>
  <a id="12769" href="Test.Golden.html#12725" class="Function">loop</a> <a id="12774" href="Test.Golden.html#12774" class="Bound">acc</a> <a id="12778" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="12781" class="Symbol">=</a> <a id="12783" href="IO.Base.html#1240" class="InductiveConstructor">pure</a> <a id="12788" href="Test.Golden.html#12774" class="Bound">acc</a>
  <a id="12794" href="Test.Golden.html#12725" class="Function">loop</a> <a id="12799" href="Test.Golden.html#12799" class="Bound">acc</a> <a id="12803" class="Symbol">(</a><a id="12804" href="Test.Golden.html#12804" class="Bound">test</a> <a id="12809" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12811" href="Test.Golden.html#12811" class="Bound">tests</a><a id="12816" class="Symbol">)</a> <a id="12818" class="Symbol">=</a> <a id="12820" class="Keyword">do</a>
    <a id="12827" href="Test.Golden.html#12827" class="Bound">res</a> <a id="12831" href="IO.Base.html#2075" class="Function Operator">&lt;-</a> <a id="12834" href="Test.Golden.html#7200" class="Function">runTest</a> <a id="12842" href="Test.Golden.html#12256" class="Bound">opts</a> <a id="12847" href="Test.Golden.html#12804" class="Bound">test</a>
    <a id="12856" href="Test.Golden.html#12725" class="Function">loop</a> <a id="12861" class="Symbol">(</a><a id="12862" href="Test.Golden.html#11724" class="Function">Summary.update</a> <a id="12877" class="Symbol">(</a><a id="12878" href="Test.Golden.html#12827" class="Bound">res</a> <a id="12882" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12884" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="12886" class="Symbol">)</a> <a id="12888" href="Test.Golden.html#12799" class="Bound">acc</a><a id="12891" class="Symbol">)</a> <a id="12893" href="Test.Golden.html#12811" class="Bound">tests</a>

<a id="runner"></a><a id="12900" href="Test.Golden.html#12900" class="Function">runner</a> <a id="12907" class="Symbol">:</a> <a id="12909" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="12914" href="Test.Golden.html#11230" class="Record">TestPool</a> <a id="12923" class="Symbol">→</a> <a id="12925" href="IO.Base.html#1171" class="Datatype">IO</a> <a id="12928" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="12930" href="Test.Golden.html#12900" class="Function">runner</a> <a id="12937" href="Test.Golden.html#12937" class="Bound">tests</a> <a id="12943" class="Symbol">=</a> <a id="12945" class="Keyword">do</a>
  <a id="12950" class="Comment">-- figure out the options</a>
  <a id="12978" href="Test.Golden.html#12978" class="Bound">args</a> <a id="12983" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="12985" href="System.Environment.html#646" class="Function">getArgs</a>
  <a id="12995" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="13000" href="Test.Golden.html#13000" class="Bound">opts</a> <a id="13005" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="13007" href="Test.Golden.html#5575" class="Function">options</a> <a id="13015" href="Test.Golden.html#12978" class="Bound">args</a>
    <a id="13024" class="Keyword">where</a> <a id="13030" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="13035" href="Test.Golden.html#13035" class="Bound">err</a> <a id="13039" class="Symbol">→</a> <a id="13041" href="System.Exit.html#1357" class="Function">die</a> <a id="13045" class="Symbol">(</a><a id="13046" href="Data.String.Base.html#2815" class="Function">unlines</a> <a id="13054" class="Symbol">(</a><a id="13055" href="Test.Golden.html#5388" class="Function">show</a> <a id="13060" href="Test.Golden.html#13035" class="Bound">err</a> <a id="13064" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13066" href="Test.Golden.html#5092" class="Function">usage</a> <a id="13072" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13074" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="13076" class="Symbol">))</a>

  <a id="13082" class="Comment">-- run the tests</a>
  <a id="13101" href="Test.Golden.html#13101" class="Bound">ress</a> <a id="13106" href="IO.Base.html#2075" class="Function Operator">←</a> <a id="13108" href="IO.html#2036" class="Function">List.mapM</a> <a id="13118" class="Symbol">(</a><a id="13119" href="Test.Golden.html#12200" class="Function">poolRunner</a> <a id="13130" href="Test.Golden.html#13000" class="Bound">opts</a><a id="13134" class="Symbol">)</a> <a id="13136" href="Test.Golden.html#12937" class="Bound">tests</a>
  <a id="13144" class="Keyword">let</a> <a id="13148" class="Keyword">open</a> <a id="13153" href="Test.Golden.html#11356" class="Module">Summary</a>
  <a id="13163" class="Keyword">let</a> <a id="13167" href="Test.Golden.html#13167" class="Bound">res</a> <a id="13171" class="Symbol">=</a> <a id="13173" href="Data.List.Base.html#4412" class="Function">List.foldl</a> <a id="13184" href="Test.Golden.html#11596" class="Function">merge</a> <a id="13190" href="Test.Golden.html#11553" class="Function">init</a> <a id="13195" href="Test.Golden.html#13101" class="Bound">ress</a>

  <a id="13203" class="Comment">-- report the result</a>
  <a id="13226" class="Keyword">let</a> <a id="13230" href="Test.Golden.html#13230" class="Bound">nsucc</a> <a id="13236" class="Symbol">=</a> <a id="13238" href="Data.List.Base.html#5058" class="Function">List.length</a> <a id="13250" class="Symbol">(</a><a id="13251" href="Test.Golden.html#13167" class="Bound">res</a> <a id="13255" class="Symbol">.</a><a id="13256" href="Test.Golden.html#11478" class="Field">success</a><a id="13263" class="Symbol">)</a>
  <a id="13267" class="Keyword">let</a> <a id="13271" href="Test.Golden.html#13271" class="Bound">nfail</a> <a id="13277" class="Symbol">=</a> <a id="13279" href="Data.List.Base.html#5058" class="Function">List.length</a> <a id="13291" class="Symbol">(</a><a id="13292" href="Test.Golden.html#13167" class="Bound">res</a> <a id="13296" class="Symbol">.</a><a id="13297" href="Test.Golden.html#11506" class="Field">failure</a><a id="13304" class="Symbol">)</a>
  <a id="13308" class="Keyword">let</a> <a id="13312" href="Test.Golden.html#13312" class="Bound">ntotal</a> <a id="13319" class="Symbol">=</a> <a id="13321" href="Test.Golden.html#13230" class="Bound">nsucc</a> <a id="13327" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="13329" href="Test.Golden.html#13271" class="Bound">nfail</a>
  <a id="13337" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="13346" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13348" href="Data.String.Base.html#2602" class="Function">concat</a> <a id="13355" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13357" href="Data.Nat.Show.html#1924" class="Function">ℕ.show</a> <a id="13364" href="Test.Golden.html#13230" class="Bound">nsucc</a> <a id="13370" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13372" class="String">&quot;/&quot;</a> <a id="13376" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13378" href="Data.Nat.Show.html#1924" class="Function">ℕ.show</a> <a id="13385" href="Test.Golden.html#13312" class="Bound">ntotal</a> <a id="13392" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13394" class="String">&quot; tests successful&quot;</a> <a id="13414" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13416" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="13422" class="Comment">-- deal with failures</a>
  <a id="13446" class="Keyword">let</a> <a id="13450" href="Test.Golden.html#13450" class="Bound">list</a> <a id="13455" class="Symbol">=</a> <a id="13457" href="Data.String.Base.html#2815" class="Function">unlines</a> <a id="13465" class="Symbol">(</a><a id="13466" href="Test.Golden.html#13167" class="Bound">res</a> <a id="13470" class="Symbol">.</a><a id="13471" href="Test.Golden.html#11506" class="Field">failure</a><a id="13478" class="Symbol">)</a>
  <a id="13482" href="IO.Base.html#3325" class="Function">when</a> <a id="13487" class="Symbol">(</a><a id="13488" class="Number">0</a> <a id="13490" href="Data.Nat.Base.html#1301" class="Primitive Operator">&lt;ᵇ</a> <a id="13493" href="Test.Golden.html#13271" class="Bound">nfail</a><a id="13498" class="Symbol">)</a> <a id="13500" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13502" class="Keyword">do</a>
    <a id="13509" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="13518" class="String">&quot;Failing tests:&quot;</a>
    <a id="13539" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="13548" href="Test.Golden.html#13450" class="Bound">list</a>
  <a id="13555" href="IO.Base.html#3448" class="Function">whenJust</a> <a id="13564" class="Symbol">(</a><a id="13565" href="Test.Golden.html#13000" class="Bound">opts</a> <a id="13570" class="Symbol">.</a><a id="13571" href="Test.Golden.html#4765" class="Field">failureFile</a><a id="13582" class="Symbol">)</a> <a id="13584" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13586" class="Symbol">λ</a> <a id="13588" href="Test.Golden.html#13588" class="Bound">fp</a> <a id="13591" class="Symbol">→</a> <a id="13593" href="IO.Finite.html#1267" class="Function">writeFile</a> <a id="13603" href="Test.Golden.html#13588" class="Bound">fp</a> <a id="13606" href="Test.Golden.html#13450" class="Bound">list</a>

  <a id="13614" class="Comment">-- exit</a>
  <a id="13624" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="13627" class="Number">0</a> <a id="13629" href="Data.Nat.Base.html#1127" class="Primitive Operator">≡ᵇ</a> <a id="13632" href="Test.Golden.html#13271" class="Bound">nfail</a>
   <a id="13641" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="13646" href="System.Exit.html#1302" class="Function">exitSuccess</a>
   <a id="13661" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="13666" href="System.Exit.html#1239" class="Function">exitFailure</a>
</pre></body></html>