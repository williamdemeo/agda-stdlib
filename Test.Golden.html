<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">---</a>

<a id="2622" class="Comment">------------------------------------------------------------------------</a>
<a id="2695" class="Comment">-- Usage</a>
<a id="2704" class="Comment">--</a>
<a id="2707" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2764" class="Comment">--</a>
<a id="2767" class="Comment">--```sh</a>
<a id="2775" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2818" class="Comment">--   [--timing]</a>
<a id="2834" class="Comment">--   [--interactive]</a>
<a id="2855" class="Comment">--   [--only-file PATH]</a>
<a id="2879" class="Comment">--   [--failure-file PATH]</a>
<a id="2906" class="Comment">--   [--no-colour]</a>
<a id="2925" class="Comment">--   [--only [NAMES]]</a>
<a id="2947" class="Comment">--```</a>
<a id="2953" class="Comment">--</a>
<a id="2956" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3037" class="Symbol">{-#</a> <a id="3041" class="Keyword">OPTIONS</a> <a id="3049" class="Pragma">--without-K</a> <a id="3061" class="Pragma">--guardedness</a> <a id="3075" class="Symbol">#-}</a>

<a id="3080" class="Keyword">module</a> <a id="3087" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3099" class="Keyword">where</a>

<a id="3106" class="Keyword">open</a> <a id="3111" class="Keyword">import</a> <a id="3118" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3133" class="Keyword">using</a> <a id="3139" class="Symbol">(</a><a id="3140" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a><a id="3144" class="Symbol">;</a> <a id="3146" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a><a id="3150" class="Symbol">;</a> <a id="3152" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a><a id="3157" class="Symbol">;</a> <a id="3159" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="3172" class="Symbol">)</a>
<a id="3174" class="Keyword">import</a> <a id="3181" href="Data.Char.html" class="Module">Data.Char</a> <a id="3191" class="Symbol">as</a> <a id="3194" class="Module">Char</a>
<a id="3199" class="Keyword">open</a> <a id="3204" class="Keyword">import</a> <a id="3211" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3220" class="Keyword">using</a> <a id="3226" class="Symbol">(</a><a id="3227" href="Data.Fin.html#730" class="Function Operator">#_</a><a id="3229" class="Symbol">)</a>
<a id="3231" class="Keyword">import</a> <a id="3238" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3256" class="Symbol">as</a> <a id="3259" class="Module">ℤ</a>
<a id="3261" class="Keyword">open</a> <a id="3266" class="Keyword">import</a> <a id="3273" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3288" class="Symbol">as</a> <a id="3291" class="Module">List</a> <a id="3296" class="Keyword">using</a> <a id="3302" class="Symbol">(</a><a id="3303" href="Agda.Builtin.List.html#148" class="Datatype">List</a><a id="3307" class="Symbol">;</a> <a id="3309" href="Data.List.Base.html#10383" class="InductiveConstructor">[]</a><a id="3311" class="Symbol">;</a> <a id="3313" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a><a id="3316" class="Symbol">;</a> <a id="3318" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="3322" class="Symbol">;</a> <a id="3324" href="Data.List.Base.html#8092" class="Function">filter</a><a id="3330" class="Symbol">;</a> <a id="3332" href="Data.List.Base.html#3760" class="Function">partitionSums</a><a id="3345" class="Symbol">)</a>
<a id="3347" class="Keyword">open</a> <a id="3352" class="Keyword">import</a> <a id="3359" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3416" class="Keyword">using</a> <a id="3422" class="Symbol">(</a><a id="3423" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6728" class="Function">infix?</a><a id="3429" class="Symbol">)</a>
<a id="3431" class="Keyword">open</a> <a id="3436" class="Keyword">import</a> <a id="3443" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3472" class="Keyword">using</a> <a id="3478" class="Symbol">(</a><a id="3479" href="Data.List.Relation.Unary.Any.html#2668" class="Function">any?</a><a id="3483" class="Symbol">)</a>
<a id="3485" class="Keyword">open</a> <a id="3490" class="Keyword">import</a> <a id="3497" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3513" class="Keyword">using</a> <a id="3519" class="Symbol">(</a><a id="3520" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="3525" class="Symbol">;</a> <a id="3527" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a><a id="3531" class="Symbol">;</a> <a id="3533" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a><a id="3540" class="Symbol">;</a> <a id="3542" href="Data.Maybe.Base.html#1632" class="Function">fromMaybe</a><a id="3551" class="Symbol">)</a>
<a id="3553" class="Keyword">open</a> <a id="3558" class="Keyword">import</a> <a id="3565" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3579" class="Keyword">using</a> <a id="3585" class="Symbol">(</a><a id="3586" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="3587" class="Symbol">;</a> <a id="3589" href="Data.Nat.Base.html#1127" class="Primitive Operator">_≡ᵇ_</a><a id="3593" class="Symbol">;</a> <a id="3595" href="Data.Nat.Base.html#1301" class="Primitive Operator">_&lt;ᵇ_</a><a id="3599" class="Symbol">;</a> <a id="3601" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">_+_</a><a id="3604" class="Symbol">;</a> <a id="3606" href="Data.Nat.Base.html#2874" class="Primitive Operator">_∸_</a><a id="3609" class="Symbol">)</a>
<a id="3611" class="Keyword">import</a> <a id="3618" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3632" class="Symbol">as</a> <a id="3635" class="Module">ℕ</a>
<a id="3637" class="Keyword">open</a> <a id="3642" class="Keyword">import</a> <a id="3649" href="Data.Product.html" class="Module">Data.Product</a> <a id="3662" class="Keyword">using</a> <a id="3668" class="Symbol">(</a><a id="3669" href="Data.Product.html#1167" class="Function Operator">_×_</a><a id="3672" class="Symbol">;</a> <a id="3674" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="3677" class="Symbol">)</a>
<a id="3679" class="Keyword">open</a> <a id="3684" class="Keyword">import</a> <a id="3691" href="Data.String.html" class="Module">Data.String</a> <a id="3703" class="Symbol">as</a> <a id="3706" class="Module">String</a> <a id="3713" class="Keyword">using</a> <a id="3719" class="Symbol">(</a><a id="3720" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="3726" class="Symbol">;</a> <a id="3728" href="Data.String.html#2366" class="Function">lines</a><a id="3733" class="Symbol">;</a> <a id="3735" href="Data.String.Base.html#2767" class="Function">unlines</a><a id="3742" class="Symbol">;</a> <a id="3744" href="Data.String.Base.html#2709" class="Function">unwords</a><a id="3751" class="Symbol">;</a> <a id="3753" href="Data.String.Base.html#2554" class="Function">concat</a><a id="3759" class="Symbol">;</a> <a id="3761" href="Data.String.Properties.html#2275" class="Function Operator">_≟_</a><a id="3764" class="Symbol">)</a>
<a id="3766" class="Keyword">open</a> <a id="3771" class="Keyword">import</a> <a id="3778" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3792" class="Keyword">using</a> <a id="3798" class="Symbol">(</a><a id="3799" href="Data.Sum.Base.html#734" class="Datatype Operator">_⊎_</a><a id="3802" class="Symbol">;</a> <a id="3804" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a><a id="3808" class="Symbol">;</a> <a id="3810" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a><a id="3814" class="Symbol">)</a>
<a id="3816" class="Keyword">open</a> <a id="3821" class="Keyword">import</a> <a id="3828" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3843" class="Keyword">using</a> <a id="3849" class="Symbol">(</a><a id="3850" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="3851" class="Symbol">)</a>

<a id="3854" class="Keyword">open</a> <a id="3859" class="Keyword">import</a> <a id="3866" href="Function.Base.html" class="Module">Function.Base</a> <a id="3880" class="Keyword">using</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Function.Base.html#695" class="Function">id</a><a id="3889" class="Symbol">;</a> <a id="3891" href="Function.Base.html#1994" class="Function Operator">_$_</a><a id="3894" class="Symbol">;</a> <a id="3896" href="Function.Base.html#3973" class="Function Operator">case_of_</a><a id="3904" class="Symbol">)</a>

<a id="3907" class="Keyword">open</a> <a id="3912" class="Keyword">import</a> <a id="3919" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="3936" class="Keyword">using</a> <a id="3942" class="Symbol">(</a><a id="3943" href="Relation.Nullary.html#1581" class="Field">does</a><a id="3947" class="Symbol">)</a>

<a id="3950" class="Keyword">open</a> <a id="3955" class="Keyword">import</a> <a id="3962" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="3986" class="Keyword">using</a> <a id="3992" class="Symbol">(</a><a id="3993" href="Agda.Builtin.Coinduction.html#218" class="CoinductiveConstructor Operator">♯_</a><a id="3995" class="Symbol">)</a>
<a id="3997" class="Keyword">open</a> <a id="4002" class="Keyword">import</a> <a id="4009" href="IO.html" class="Module">IO</a>

<a id="4013" class="Keyword">open</a> <a id="4018" class="Keyword">import</a> <a id="4025" href="System.Clock.html" class="Module">System.Clock</a> <a id="4038" class="Symbol">as</a> <a id="4041" class="Module">Clock</a> <a id="4047" class="Keyword">using</a> <a id="4053" class="Symbol">(</a><a id="4054" href="System.Clock.html#2756" class="Function">time′</a><a id="4059" class="Symbol">;</a> <a id="4061" href="System.Clock.html#1907" class="Record">Time</a><a id="4065" class="Symbol">;</a> <a id="4067" href="System.Clock.html#1953" class="Field">seconds</a><a id="4074" class="Symbol">)</a>
<a id="4076" class="Keyword">open</a> <a id="4081" class="Keyword">import</a> <a id="4088" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4108" class="Keyword">open</a> <a id="4113" class="Keyword">import</a> <a id="4120" href="System.Directory.html" class="Module">System.Directory</a> <a id="4137" class="Keyword">using</a> <a id="4143" class="Symbol">(</a><a id="4144" href="System.Directory.html#3041" class="Function">doesFileExist</a><a id="4157" class="Symbol">;</a> <a id="4159" href="System.Directory.html#3093" class="Function">doesDirectoryExist</a><a id="4177" class="Symbol">)</a>
<a id="4179" class="Keyword">open</a> <a id="4184" class="Keyword">import</a> <a id="4191" href="System.Environment.html" class="Module">System.Environment</a> <a id="4210" class="Keyword">using</a> <a id="4216" class="Symbol">(</a><a id="4217" href="System.Environment.html#646" class="Function">getArgs</a><a id="4224" class="Symbol">;</a> <a id="4226" href="System.Environment.html#763" class="Function">lookupEnv</a><a id="4235" class="Symbol">)</a>
<a id="4237" class="Keyword">open</a> <a id="4242" class="Keyword">import</a> <a id="4249" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4261" class="Keyword">open</a> <a id="4266" class="Keyword">import</a> <a id="4273" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4295" class="Keyword">using</a> <a id="4301" class="Symbol">(</a><a id="4302" href="System.FilePath.Posix.Primitive.html#2547" class="Postulate">mkFilePath</a><a id="4312" class="Symbol">)</a>
<a id="4314" class="Keyword">open</a> <a id="4319" class="Keyword">import</a> <a id="4326" href="System.Process.html" class="Module">System.Process</a> <a id="4341" class="Keyword">using</a> <a id="4347" class="Symbol">(</a><a id="4348" href="System.Process.html#640" class="Function">callCommand</a><a id="4359" class="Symbol">;</a> <a id="4361" href="System.Process.html#720" class="Function">system</a><a id="4367" class="Symbol">)</a>

<a id="4370" class="Keyword">record</a> <a id="Options"></a><a id="4377" href="Test.Golden.html#4377" class="Record">Options</a> <a id="4385" class="Symbol">:</a> <a id="4387" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4391" class="Keyword">where</a>
  <a id="4399" class="Keyword">field</a>
    <a id="4409" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4457" href="Test.Golden.html#4457" class="Field">exeUnderTest</a> <a id="4470" class="Symbol">:</a> <a id="4472" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="4483" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4530" href="Test.Golden.html#4530" class="Field">onlyNames</a> <a id="4540" class="Symbol">:</a> <a id="4542" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="4547" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="4558" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4609" href="Test.Golden.html#4609" class="Field">interactive</a> <a id="4621" class="Symbol">:</a> <a id="4623" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="4632" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4677" href="Test.Golden.html#4677" class="Field">timing</a> <a id="4684" class="Symbol">:</a> <a id="4686" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="4695" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4755" href="Test.Golden.html#4755" class="Field">failureFile</a> <a id="4767" class="Symbol">:</a> <a id="4769" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="4775" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="4786" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4847" href="Test.Golden.html#4847" class="Field">colour</a> <a id="4854" class="Symbol">:</a> <a id="4856" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
<a id="4861" class="Keyword">open</a> <a id="4866" href="Test.Golden.html#4377" class="Module">Options</a>

<a id="initOptions"></a><a id="4875" href="Test.Golden.html#4875" class="Function">initOptions</a> <a id="4887" class="Symbol">:</a> <a id="4889" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="4896" class="Symbol">→</a> <a id="4898" href="Test.Golden.html#4377" class="Record">Options</a>
<a id="4906" href="Test.Golden.html#4875" class="Function">initOptions</a> <a id="4918" href="Test.Golden.html#4918" class="Bound">exe</a> <a id="4922" class="Symbol">=</a> <a id="4924" class="Keyword">record</a>
  <a id="4933" class="Symbol">{</a> <a id="4935" href="Test.Golden.html#4457" class="Field">exeUnderTest</a> <a id="4948" class="Symbol">=</a> <a id="4950" href="Test.Golden.html#4918" class="Bound">exe</a>
  <a id="4956" class="Symbol">;</a> <a id="4958" href="Test.Golden.html#4530" class="Field">onlyNames</a>    <a id="4971" class="Symbol">=</a> <a id="4973" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
  <a id="4978" class="Symbol">;</a> <a id="4980" href="Test.Golden.html#4609" class="Field">interactive</a>  <a id="4993" class="Symbol">=</a> <a id="4995" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
  <a id="5003" class="Symbol">;</a> <a id="5005" href="Test.Golden.html#4677" class="Field">timing</a>       <a id="5018" class="Symbol">=</a> <a id="5020" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
  <a id="5028" class="Symbol">;</a> <a id="5030" href="Test.Golden.html#4755" class="Field">failureFile</a>  <a id="5043" class="Symbol">=</a> <a id="5045" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
  <a id="5055" class="Symbol">;</a> <a id="5057" href="Test.Golden.html#4847" class="Field">colour</a>       <a id="5070" class="Symbol">=</a> <a id="5072" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
  <a id="5079" class="Symbol">}</a>

<a id="usage"></a><a id="5082" href="Test.Golden.html#5082" class="Function">usage</a> <a id="5088" class="Symbol">:</a> <a id="5090" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="5097" href="Test.Golden.html#5082" class="Function">usage</a> <a id="5103" class="Symbol">=</a> <a id="5105" href="Data.String.Base.html#2709" class="Function">unwords</a>
  <a id="5115" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="5117" class="String">&quot;Usage:&quot;</a>
  <a id="5128" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5130" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5150" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5152" class="String">&quot;[--timing]&quot;</a>
  <a id="5167" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5169" class="String">&quot;[--interactive]&quot;</a>
  <a id="5189" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5191" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5217" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5219" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5242" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5244" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5262" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5264" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5285" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5287" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

<a id="5291" class="Keyword">data</a> <a id="Error"></a><a id="5296" href="Test.Golden.html#5296" class="Datatype">Error</a> <a id="5302" class="Symbol">:</a> <a id="5304" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5308" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5316" href="Test.Golden.html#5316" class="InductiveConstructor">MissingExecutable</a> <a id="5334" class="Symbol">:</a> <a id="5336" href="Test.Golden.html#5296" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5344" href="Test.Golden.html#5344" class="InductiveConstructor">InvalidArgument</a> <a id="5360" class="Symbol">:</a> <a id="5362" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5369" class="Symbol">→</a> <a id="5371" href="Test.Golden.html#5296" class="Datatype">Error</a>

<a id="show"></a><a id="5378" href="Test.Golden.html#5378" class="Function">show</a> <a id="5383" class="Symbol">:</a> <a id="5385" href="Test.Golden.html#5296" class="Datatype">Error</a> <a id="5391" class="Symbol">→</a> <a id="5393" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="5400" href="Test.Golden.html#5378" class="Function">show</a> <a id="5405" href="Test.Golden.html#5316" class="InductiveConstructor">MissingExecutable</a> <a id="5423" class="Symbol">=</a> <a id="5425" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5464" href="Test.Golden.html#5378" class="Function">show</a> <a id="5469" class="Symbol">(</a><a id="5470" href="Test.Golden.html#5344" class="InductiveConstructor">InvalidArgument</a> <a id="5486" href="Test.Golden.html#5486" class="Bound">arg</a><a id="5489" class="Symbol">)</a> <a id="5491" class="Symbol">=</a> <a id="5493" class="String">&quot;Invalid argument: &quot;</a> <a id="5514" href="Data.String.Base.html#2366" class="Function Operator">String.++</a> <a id="5524" href="Test.Golden.html#5486" class="Bound">arg</a>

<a id="5529" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5565" href="Test.Golden.html#5565" class="Function">options</a> <a id="5573" class="Symbol">:</a> <a id="5575" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5580" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5587" class="Symbol">→</a> <a id="5589" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="5592" class="Symbol">(</a><a id="5593" href="Test.Golden.html#5296" class="Datatype">Error</a> <a id="5599" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="5601" href="Test.Golden.html#4377" class="Record">Options</a><a id="5608" class="Symbol">)</a>
<a id="5610" href="Test.Golden.html#5565" class="Function">options</a><a id="5617" class="Symbol">(</a><a id="5618" href="Test.Golden.html#5618" class="Bound">exe</a> <a id="5622" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5624" href="Test.Golden.html#5624" class="Bound">rest</a><a id="5628" class="Symbol">)</a> <a id="5630" class="Symbol">=</a> <a id="5632" href="Test.Golden.html#6433" class="Function">mkOptions</a> <a id="5642" href="Test.Golden.html#5618" class="Bound">exe</a> <a id="5646" href="Test.Golden.html#5624" class="Bound">rest</a> <a id="5651" class="Keyword">where</a>

  <a id="5660" href="Test.Golden.html#5660" class="Function">go</a> <a id="5663" class="Symbol">:</a> <a id="5665" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5670" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5677" class="Symbol">→</a> <a id="5679" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="5685" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5692" class="Symbol">→</a> <a id="5694" href="Test.Golden.html#4377" class="Record">Options</a> <a id="5702" class="Symbol">→</a> <a id="5704" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5711" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="5713" class="Symbol">(</a><a id="5714" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="5720" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="5727" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="5729" href="Test.Golden.html#4377" class="Record">Options</a><a id="5736" class="Symbol">)</a>
  <a id="5740" href="Test.Golden.html#5660" class="Function">go</a> <a id="5743" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>                             <a id="5774" href="Test.Golden.html#5774" class="Bound">mfp</a> <a id="5778" href="Test.Golden.html#5778" class="Bound">opts</a> <a id="5783" class="Symbol">=</a> <a id="5785" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="5790" class="Symbol">(</a><a id="5791" href="Test.Golden.html#5774" class="Bound">mfp</a> <a id="5795" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5797" href="Test.Golden.html#5778" class="Bound">opts</a><a id="5801" class="Symbol">)</a>
  <a id="5805" href="Test.Golden.html#5660" class="Function">go</a> <a id="5808" class="Symbol">(</a><a id="5809" class="String">&quot;--timing&quot;</a>            <a id="5831" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5833" href="Test.Golden.html#5833" class="Bound">args</a><a id="5837" class="Symbol">)</a> <a id="5839" href="Test.Golden.html#5839" class="Bound">mfp</a> <a id="5843" href="Test.Golden.html#5843" class="Bound">opts</a> <a id="5848" class="Symbol">=</a>
    <a id="5854" href="Test.Golden.html#5660" class="Function">go</a> <a id="5857" href="Test.Golden.html#5833" class="Bound">args</a> <a id="5862" href="Test.Golden.html#5839" class="Bound">mfp</a> <a id="5866" class="Symbol">(</a><a id="5867" class="Keyword">record</a> <a id="5874" href="Test.Golden.html#5843" class="Bound">opts</a> <a id="5879" class="Symbol">{</a> <a id="5881" href="Test.Golden.html#4677" class="Field">timing</a> <a id="5888" class="Symbol">=</a> <a id="5890" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="5895" class="Symbol">})</a>
  <a id="5900" href="Test.Golden.html#5660" class="Function">go</a> <a id="5903" class="Symbol">(</a><a id="5904" class="String">&quot;--interactive&quot;</a>       <a id="5926" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5928" href="Test.Golden.html#5928" class="Bound">args</a><a id="5932" class="Symbol">)</a> <a id="5934" href="Test.Golden.html#5934" class="Bound">mfp</a> <a id="5938" href="Test.Golden.html#5938" class="Bound">opts</a> <a id="5943" class="Symbol">=</a>
    <a id="5949" href="Test.Golden.html#5660" class="Function">go</a> <a id="5952" href="Test.Golden.html#5928" class="Bound">args</a> <a id="5957" href="Test.Golden.html#5934" class="Bound">mfp</a> <a id="5961" class="Symbol">(</a><a id="5962" class="Keyword">record</a> <a id="5969" href="Test.Golden.html#5938" class="Bound">opts</a> <a id="5974" class="Symbol">{</a> <a id="5976" href="Test.Golden.html#4609" class="Field">interactive</a> <a id="5988" class="Symbol">=</a> <a id="5990" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="5995" class="Symbol">})</a>
  <a id="6000" href="Test.Golden.html#5660" class="Function">go</a> <a id="6003" class="Symbol">(</a><a id="6004" class="String">&quot;--failure-file&quot;</a> <a id="6021" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6023" href="Test.Golden.html#6023" class="Bound">fp</a> <a id="6026" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6028" href="Test.Golden.html#6028" class="Bound">args</a><a id="6032" class="Symbol">)</a> <a id="6034" href="Test.Golden.html#6034" class="Bound">mfp</a> <a id="6038" href="Test.Golden.html#6038" class="Bound">opts</a> <a id="6043" class="Symbol">=</a>
    <a id="6049" href="Test.Golden.html#5660" class="Function">go</a> <a id="6052" href="Test.Golden.html#6028" class="Bound">args</a> <a id="6057" href="Test.Golden.html#6034" class="Bound">mfp</a> <a id="6061" class="Symbol">(</a><a id="6062" class="Keyword">record</a> <a id="6069" href="Test.Golden.html#6038" class="Bound">opts</a> <a id="6074" class="Symbol">{</a> <a id="6076" href="Test.Golden.html#4755" class="Field">failureFile</a> <a id="6088" class="Symbol">=</a> <a id="6090" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6095" href="Test.Golden.html#6023" class="Bound">fp</a> <a id="6098" class="Symbol">})</a>
  <a id="6103" href="Test.Golden.html#5660" class="Function">go</a> <a id="6106" class="Symbol">(</a><a id="6107" class="String">&quot;--only&quot;</a>              <a id="6129" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6131" href="Test.Golden.html#6131" class="Bound">args</a><a id="6135" class="Symbol">)</a> <a id="6137" href="Test.Golden.html#6137" class="Bound">mfp</a> <a id="6141" href="Test.Golden.html#6141" class="Bound">opts</a> <a id="6146" class="Symbol">=</a>
    <a id="6152" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="6157" class="Symbol">(</a><a id="6158" href="Test.Golden.html#6137" class="Bound">mfp</a> <a id="6162" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6164" class="Symbol">(</a><a id="6165" class="Keyword">record</a> <a id="6172" href="Test.Golden.html#6141" class="Bound">opts</a> <a id="6177" class="Symbol">{</a> <a id="6179" href="Test.Golden.html#4530" class="Field">onlyNames</a> <a id="6189" class="Symbol">=</a> <a id="6191" href="Test.Golden.html#6131" class="Bound">args</a> <a id="6196" class="Symbol">}))</a>
  <a id="6202" href="Test.Golden.html#5660" class="Function">go</a> <a id="6205" class="Symbol">(</a><a id="6206" class="String">&quot;--only-file&quot;</a> <a id="6220" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6222" href="Test.Golden.html#6222" class="Bound">fp</a>    <a id="6228" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6230" href="Test.Golden.html#6230" class="Bound">args</a><a id="6234" class="Symbol">)</a> <a id="6236" href="Test.Golden.html#6236" class="Bound">mfp</a> <a id="6240" href="Test.Golden.html#6240" class="Bound">opts</a> <a id="6245" class="Symbol">=</a>
    <a id="6251" href="Test.Golden.html#5660" class="Function">go</a> <a id="6254" href="Test.Golden.html#6230" class="Bound">args</a> <a id="6259" class="Symbol">(</a><a id="6260" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6265" href="Test.Golden.html#6222" class="Bound">fp</a><a id="6267" class="Symbol">)</a> <a id="6269" class="Symbol">(</a><a id="6270" class="Keyword">record</a> <a id="6277" href="Test.Golden.html#6240" class="Bound">opts</a> <a id="6282" class="Symbol">{</a> <a id="6284" href="Test.Golden.html#4530" class="Field">onlyNames</a> <a id="6294" class="Symbol">=</a> <a id="6296" href="Test.Golden.html#6230" class="Bound">args</a> <a id="6301" class="Symbol">})</a>
  <a id="6306" href="Test.Golden.html#5660" class="Function">go</a> <a id="6309" class="Symbol">(</a><a id="6310" class="String">&quot;--no-colour&quot;</a>         <a id="6332" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6334" href="Test.Golden.html#6334" class="Bound">args</a><a id="6338" class="Symbol">)</a> <a id="6340" href="Test.Golden.html#6340" class="Bound">mfp</a> <a id="6344" href="Test.Golden.html#6344" class="Bound">opts</a> <a id="6349" class="Symbol">=</a>
    <a id="6355" href="Test.Golden.html#5660" class="Function">go</a> <a id="6358" href="Test.Golden.html#6334" class="Bound">args</a> <a id="6363" href="Test.Golden.html#6340" class="Bound">mfp</a> <a id="6367" class="Symbol">(</a><a id="6368" class="Keyword">record</a> <a id="6375" href="Test.Golden.html#6344" class="Bound">opts</a> <a id="6380" class="Symbol">{</a> <a id="6382" href="Test.Golden.html#4847" class="Field">colour</a> <a id="6389" class="Symbol">=</a> <a id="6391" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="6397" class="Symbol">})</a>
  <a id="6402" href="Test.Golden.html#5660" class="CatchallClause Function">go</a><a id="6404" class="CatchallClause"> </a><a id="6405" class="CatchallClause Symbol">(</a><a id="6406" href="Test.Golden.html#6406" class="CatchallClause Bound">arg</a><a id="6409" class="CatchallClause"> </a><a id="6410" href="Agda.Builtin.List.html#200" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6411" class="CatchallClause"> </a><a id="6412" class="CatchallClause Symbol">_)</a><a id="6414" class="CatchallClause"> </a><a id="6415" class="CatchallClause Symbol">_</a><a id="6416" class="CatchallClause"> </a><a id="6417" class="CatchallClause Symbol">_</a> <a id="6419" class="Symbol">=</a> <a id="6421" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="6426" href="Test.Golden.html#6406" class="Bound">arg</a>

  <a id="6433" href="Test.Golden.html#6433" class="Function">mkOptions</a> <a id="6443" class="Symbol">:</a> <a id="6445" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="6452" class="Symbol">→</a> <a id="6454" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="6459" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="6466" class="Symbol">→</a> <a id="6468" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="6471" class="Symbol">(</a><a id="6472" href="Test.Golden.html#5296" class="Datatype">Error</a> <a id="6478" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="6480" href="Test.Golden.html#4377" class="Record">Options</a><a id="6487" class="Symbol">)</a>
  <a id="6491" href="Test.Golden.html#6433" class="Function">mkOptions</a> <a id="6501" href="Test.Golden.html#6501" class="Bound">exe</a> <a id="6505" href="Test.Golden.html#6505" class="Bound">rest</a> <a id="6510" class="Symbol">=</a> <a id="6512" class="Keyword">do</a>
    <a id="6519" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="6524" class="Symbol">(</a><a id="6525" href="Test.Golden.html#6525" class="Bound">mfp</a> <a id="6529" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6531" href="Test.Golden.html#6531" class="Bound">opts</a><a id="6535" class="Symbol">)</a> <a id="6537" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="6539" href="IO.Base.html#1349" class="Function">pure</a> <a id="6544" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6546" href="Test.Golden.html#5660" class="Function">go</a> <a id="6549" href="Test.Golden.html#6505" class="Bound">rest</a> <a id="6554" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="6562" class="Symbol">(</a><a id="6563" href="Test.Golden.html#4875" class="Function">initOptions</a> <a id="6575" href="Test.Golden.html#6501" class="Bound">exe</a><a id="6578" class="Symbol">)</a>
      <a id="6586" class="Keyword">where</a> <a id="6592" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="6597" href="Test.Golden.html#6597" class="Bound">arg</a> <a id="6601" class="Symbol">→</a> <a id="6603" href="IO.Base.html#1349" class="Function">pure</a> <a id="6608" class="Symbol">(</a><a id="6609" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="6614" class="Symbol">(</a><a id="6615" href="Test.Golden.html#5344" class="InductiveConstructor">InvalidArgument</a> <a id="6631" href="Test.Golden.html#6597" class="Bound">arg</a><a id="6634" class="Symbol">))</a>
    <a id="6641" href="Test.Golden.html#6641" class="Bound">term</a> <a id="6646" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="6648" href="Data.Maybe.Base.html#1632" class="Function">fromMaybe</a> <a id="6658" class="String">&quot;&quot;</a> <a id="6661" href="IO.Base.html#1957" class="Function Operator">&lt;$&gt;</a> <a id="6665" href="System.Environment.html#763" class="Function">lookupEnv</a> <a id="6675" class="String">&quot;TERM&quot;</a>
    <a id="6686" class="Keyword">let</a> <a id="6690" href="Test.Golden.html#6690" class="Bound">opts</a> <a id="6695" class="Symbol">=</a> <a id="6697" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="6700" href="Relation.Nullary.html#1581" class="Field">does</a> <a id="6705" class="Symbol">(</a><a id="6706" href="Test.Golden.html#6641" class="Bound">term</a> <a id="6711" href="Data.String.Properties.html#2275" class="Function Operator">≟</a> <a id="6713" class="String">&quot;DUMB&quot;</a><a id="6719" class="Symbol">)</a>
               <a id="6736" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="6741" class="Keyword">record</a> <a id="6748" href="Test.Golden.html#6531" class="Bound">opts</a> <a id="6753" class="Symbol">{</a> <a id="6755" href="Test.Golden.html#4847" class="Field">colour</a> <a id="6762" class="Symbol">=</a> <a id="6764" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="6770" class="Symbol">}</a>
               <a id="6787" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="6792" href="Test.Golden.html#6531" class="Bound">opts</a>
    <a id="6801" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6806" href="Test.Golden.html#6806" class="Bound">fp</a> <a id="6809" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="6811" href="IO.Base.html#1349" class="Function">pure</a> <a id="6816" href="Test.Golden.html#6525" class="Bound">mfp</a>
      <a id="6826" class="Keyword">where</a> <a id="6832" class="CatchallClause Symbol">_</a> <a id="6834" class="Symbol">→</a> <a id="6836" href="IO.Base.html#1349" class="Function">pure</a> <a id="6841" class="Symbol">(</a><a id="6842" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="6847" href="Test.Golden.html#6690" class="Bound">opts</a><a id="6851" class="Symbol">)</a>
    <a id="6857" href="Test.Golden.html#6857" class="Bound">only</a> <a id="6862" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="6864" href="IO.html#2872" class="Function">readFiniteFile</a> <a id="6879" href="Test.Golden.html#6806" class="Bound">fp</a>
    <a id="6886" href="IO.Base.html#1349" class="Function">pure</a> <a id="6891" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6893" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="6898" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="6900" class="Keyword">record</a> <a id="6907" href="Test.Golden.html#6690" class="Bound">opts</a> <a id="6912" class="Symbol">{</a> <a id="6914" href="Test.Golden.html#4530" class="Field">onlyNames</a> <a id="6924" class="Symbol">=</a> <a id="6926" href="Data.String.html#2366" class="Function">lines</a> <a id="6932" href="Test.Golden.html#6857" class="Bound">only</a> <a id="6937" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="6940" href="Test.Golden.html#4530" class="Field">onlyNames</a> <a id="6950" href="Test.Golden.html#6690" class="Bound">opts</a> <a id="6955" class="Symbol">}</a>

<a id="6958" href="Test.Golden.html#5565" class="Function">options</a> <a id="6966" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="6969" class="Symbol">=</a> <a id="6971" href="IO.Base.html#1349" class="Function">pure</a> <a id="6976" class="Symbol">(</a><a id="6977" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="6982" href="Test.Golden.html#5316" class="InductiveConstructor">MissingExecutable</a><a id="6999" class="Symbol">)</a>


<a id="7003" class="Comment">-- The result of a test run</a>
<a id="7031" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7091" href="Test.Golden.html#7091" class="Function">Result</a> <a id="7098" class="Symbol">:</a> <a id="7100" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="7104" href="Test.Golden.html#7091" class="Function">Result</a> <a id="7111" class="Symbol">=</a> <a id="7113" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="7120" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="7122" href="Agda.Builtin.String.html#336" class="Postulate">String</a>

<a id="7130" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7190" href="Test.Golden.html#7190" class="Function">runTest</a> <a id="7198" class="Symbol">:</a> <a id="7200" href="Test.Golden.html#4377" class="Record">Options</a> <a id="7208" class="Symbol">→</a> <a id="7210" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="7217" class="Symbol">→</a> <a id="7219" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="7222" href="Test.Golden.html#7091" class="Function">Result</a>
<a id="7229" href="Test.Golden.html#7190" class="Function">runTest</a> <a id="7237" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="7242" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="7251" class="Symbol">=</a> <a id="7253" class="Keyword">do</a>

  <a id="7259" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="7264" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="7266" href="System.Directory.html#3093" class="Function">doesDirectoryExist</a> <a id="7285" class="Symbol">(</a><a id="7286" href="System.FilePath.Posix.Primitive.html#2547" class="Postulate">mkFilePath</a> <a id="7297" href="Test.Golden.html#7242" class="Bound">testPath</a><a id="7305" class="Symbol">)</a>
    <a id="7311" class="Keyword">where</a> <a id="7317" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="7323" class="Symbol">→</a> <a id="7325" href="Test.Golden.html#8870" class="Function">fail</a> <a id="7330" href="Test.Golden.html#8491" class="Function">directoryNotFound</a>

  <a id="7351" href="Test.Golden.html#7351" class="Bound">time</a> <a id="7356" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="7358" href="System.Clock.html#2756" class="Function">time′</a> <a id="7364" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7366" href="System.Process.html#640" class="Function">callCommand</a> <a id="7378" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7380" href="Data.String.Base.html#2709" class="Function">unwords</a>
           <a id="7399" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7401" class="String">&quot;cd&quot;</a> <a id="7406" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7408" href="Test.Golden.html#7242" class="Bound">testPath</a>
           <a id="7428" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7430" class="String">&quot;&amp;&amp;&quot;</a> <a id="7435" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7437" class="String">&quot;sh ./run&quot;</a> <a id="7448" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7450" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="7455" class="Symbol">.</a><a id="7456" href="Test.Golden.html#4457" class="Field">exeUnderTest</a>
           <a id="7480" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7482" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7518" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7520" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="7526" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="7531" href="Test.Golden.html#7531" class="Bound">out</a> <a id="7535" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="7537" href="Test.Golden.html#8971" class="Function">readLocalFile</a> <a id="7551" class="String">&quot;output&quot;</a>
    <a id="7564" class="Keyword">where</a> <a id="7570" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="7578" class="Symbol">→</a> <a id="7580" href="Test.Golden.html#8870" class="Function">fail</a> <a id="7585" class="Symbol">(</a><a id="7586" href="Test.Golden.html#8670" class="Function">fileNotFound</a> <a id="7599" class="String">&quot;output&quot;</a><a id="7607" class="Symbol">)</a>
  <a id="7611" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="7616" href="Test.Golden.html#7616" class="Bound">exp</a> <a id="7620" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="7622" href="Test.Golden.html#8971" class="Function">readLocalFile</a> <a id="7636" class="String">&quot;expected&quot;</a>
    <a id="7651" class="Keyword">where</a> <a id="7657" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="7665" class="Symbol">→</a> <a id="7667" class="Keyword">do</a> <a id="7670" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="7673" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="7678" class="Symbol">.</a><a id="7679" href="Test.Golden.html#4609" class="Field">interactive</a>
                         <a id="7716" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="7721" href="Test.Golden.html#9738" class="Function">mayOverwrite</a> <a id="7734" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="7742" href="Test.Golden.html#7531" class="Bound">out</a>
                         <a id="7771" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="7776" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="7785" class="Symbol">(</a><a id="7786" href="Test.Golden.html#8670" class="Function">fileNotFound</a> <a id="7799" class="String">&quot;expected&quot;</a><a id="7809" class="Symbol">)</a>
                       <a id="7834" href="IO.Base.html#1349" class="Function">pure</a> <a id="7839" class="Symbol">(</a><a id="7840" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="7845" href="Test.Golden.html#7242" class="Bound">testPath</a><a id="7853" class="Symbol">)</a>

  <a id="7858" class="Keyword">let</a> <a id="7862" href="Test.Golden.html#7862" class="Bound">result</a> <a id="7869" class="Symbol">=</a> <a id="7871" href="Relation.Nullary.html#1581" class="Field">does</a> <a id="7876" class="Symbol">(</a><a id="7877" href="Test.Golden.html#7531" class="Bound">out</a> <a id="7881" href="Data.String.Properties.html#2275" class="Function Operator">String.≟</a> <a id="7890" href="Test.Golden.html#7616" class="Bound">exp</a><a id="7893" class="Symbol">)</a>

  <a id="7898" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="7901" href="Test.Golden.html#7862" class="Bound">result</a>
    <a id="7912" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="7917" href="Test.Golden.html#10554" class="Function">printTiming</a> <a id="7929" class="Symbol">(</a><a id="7930" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="7935" class="Symbol">.</a><a id="7936" href="Test.Golden.html#4677" class="Field">timing</a><a id="7942" class="Symbol">)</a> <a id="7944" href="Test.Golden.html#7351" class="Bound">time</a>
           <a id="7960" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7962" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="7965" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="7970" class="Symbol">.</a><a id="7971" href="Test.Golden.html#4847" class="Field">colour</a>
               <a id="7993" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="7998" href="System.Console.ANSI.html#2064" class="Function">withCommand</a> <a id="8010" class="Symbol">(</a><a id="8011" href="System.Console.ANSI.html#965" class="InductiveConstructor">setColour</a> <a id="8021" href="System.Console.ANSI.html#534" class="InductiveConstructor">foreground</a> <a id="8032" href="System.Console.ANSI.html#677" class="InductiveConstructor">classic</a> <a id="8040" href="System.Console.ANSI.html#601" class="InductiveConstructor">green</a><a id="8045" class="Symbol">)</a>
               <a id="8062" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8067" href="Function.Base.html#695" class="Function">id</a>
           <a id="8081" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8083" class="String">&quot;success&quot;</a>
    <a id="8097" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8102" class="Keyword">do</a> <a id="8105" href="Test.Golden.html#10554" class="Function">printTiming</a> <a id="8117" class="Symbol">(</a><a id="8118" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="8123" class="Symbol">.</a><a id="8124" href="Test.Golden.html#4677" class="Field">timing</a><a id="8130" class="Symbol">)</a> <a id="8132" href="Test.Golden.html#7351" class="Bound">time</a>
             <a id="8150" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8152" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="8155" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="8160" class="Symbol">.</a><a id="8161" href="Test.Golden.html#4847" class="Field">colour</a>
               <a id="8183" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8188" href="System.Console.ANSI.html#2064" class="Function">withCommand</a> <a id="8200" class="Symbol">(</a><a id="8201" href="System.Console.ANSI.html#965" class="InductiveConstructor">setColour</a> <a id="8211" href="System.Console.ANSI.html#534" class="InductiveConstructor">foreground</a> <a id="8222" href="System.Console.ANSI.html#685" class="InductiveConstructor">bright</a> <a id="8229" href="System.Console.ANSI.html#597" class="InductiveConstructor">red</a><a id="8232" class="Symbol">)</a>
               <a id="8249" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8254" href="Function.Base.html#695" class="Function">id</a>
             <a id="8270" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8272" class="String">&quot;FAILURE&quot;</a>
            <a id="8294" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="8297" href="Test.Golden.html#7237" class="Bound">opts</a> <a id="8302" class="Symbol">.</a><a id="8303" href="Test.Golden.html#4609" class="Field">interactive</a>
              <a id="8329" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8334" href="Test.Golden.html#9738" class="Function">mayOverwrite</a> <a id="8347" class="Symbol">(</a><a id="8348" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="8353" href="Test.Golden.html#7616" class="Bound">exp</a><a id="8356" class="Symbol">)</a> <a id="8358" href="Test.Golden.html#7531" class="Bound">out</a>
              <a id="8376" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8381" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="8390" class="Symbol">(</a><a id="8391" href="Data.String.Base.html#2767" class="Function">unlines</a> <a id="8399" class="Symbol">(</a><a id="8400" href="Test.Golden.html#9504" class="Function">expVsOut</a> <a id="8409" href="Test.Golden.html#7616" class="Bound">exp</a> <a id="8413" href="Test.Golden.html#7531" class="Bound">out</a><a id="8416" class="Symbol">))</a>

  <a id="8422" href="IO.Base.html#1349" class="Function">pure</a> <a id="8427" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8429" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="8432" href="Test.Golden.html#7862" class="Bound">result</a> <a id="8439" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="8444" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="8449" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="8458" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="8463" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="8468" href="Test.Golden.html#7242" class="Bound">testPath</a>

  <a id="8480" class="Keyword">where</a>

    <a id="8491" href="Test.Golden.html#8491" class="Function">directoryNotFound</a> <a id="8509" class="Symbol">:</a> <a id="8511" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="8522" href="Test.Golden.html#8491" class="Function">directoryNotFound</a> <a id="8540" class="Symbol">=</a> <a id="8542" href="Data.String.Base.html#2709" class="Function">unwords</a>
                      <a id="8572" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8574" class="String">&quot;Directory&quot;</a>
                      <a id="8608" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8610" href="Test.Golden.html#7242" class="Bound">testPath</a>
                      <a id="8641" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8643" class="String">&quot;does not exist&quot;</a> <a id="8660" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8662" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

    <a id="8670" href="Test.Golden.html#8670" class="Function">fileNotFound</a> <a id="8683" class="Symbol">:</a> <a id="8685" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="8692" class="Symbol">→</a> <a id="8694" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="8705" href="Test.Golden.html#8670" class="Function">fileNotFound</a> <a id="8718" href="Test.Golden.html#8718" class="Bound">name</a> <a id="8723" class="Symbol">=</a> <a id="8725" href="Data.String.Base.html#2709" class="Function">unwords</a>
                      <a id="8755" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8757" class="String">&quot;File&quot;</a>
                      <a id="8786" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8788" class="Symbol">(</a><a id="8789" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="8798" href="Data.String.Base.html#2366" class="Function Operator">String.++</a> <a id="8808" class="String">&quot;/output&quot;</a><a id="8817" class="Symbol">)</a>
                      <a id="8841" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8843" class="String">&quot;does not exist&quot;</a> <a id="8860" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="8862" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

    <a id="8870" href="Test.Golden.html#8870" class="Function">fail</a> <a id="8875" class="Symbol">:</a> <a id="8877" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="8884" class="Symbol">→</a> <a id="8886" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="8889" href="Test.Golden.html#7091" class="Function">Result</a>
    <a id="8900" href="Test.Golden.html#8870" class="Function">fail</a> <a id="8905" href="Test.Golden.html#8905" class="Bound">msg</a> <a id="8909" class="Symbol">=</a> <a id="8911" class="Keyword">do</a> <a id="8914" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="8923" href="Test.Golden.html#8905" class="Bound">msg</a>
                  <a id="8945" href="IO.Base.html#1349" class="Function">pure</a> <a id="8950" class="Symbol">(</a><a id="8951" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="8956" href="Test.Golden.html#7242" class="Bound">testPath</a><a id="8964" class="Symbol">)</a>

    <a id="8971" href="Test.Golden.html#8971" class="Function">readLocalFile</a> <a id="8985" class="Symbol">:</a> <a id="8987" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="8994" class="Symbol">→</a> <a id="8996" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="8999" class="Symbol">(</a><a id="9000" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="9006" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="9012" class="Symbol">)</a>
    <a id="9018" href="Test.Golden.html#8971" class="Function">readLocalFile</a> <a id="9032" href="Test.Golden.html#9032" class="Bound">name</a> <a id="9037" class="Symbol">=</a> <a id="9039" class="Keyword">do</a>
      <a id="9048" class="Keyword">let</a> <a id="9052" href="Test.Golden.html#9052" class="Bound">fp</a> <a id="9055" class="Symbol">=</a> <a id="9057" href="Data.String.Base.html#2554" class="Function">concat</a> <a id="9064" class="Symbol">(</a><a id="9065" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="9074" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9076" class="String">&quot;/&quot;</a> <a id="9080" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9082" href="Test.Golden.html#9032" class="Bound">name</a> <a id="9087" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9089" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="9091" class="Symbol">)</a>
      <a id="9099" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="9104" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="9106" href="System.Directory.html#3041" class="Function">doesFileExist</a> <a id="9120" class="Symbol">(</a><a id="9121" href="System.FilePath.Posix.Primitive.html#2547" class="Postulate">mkFilePath</a> <a id="9132" href="Test.Golden.html#9052" class="Bound">fp</a><a id="9134" class="Symbol">)</a>
        <a id="9144" class="Keyword">where</a> <a id="9150" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="9156" class="Symbol">→</a> <a id="9158" href="IO.Base.html#1349" class="Function">pure</a> <a id="9163" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
      <a id="9177" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9182" href="IO.Base.html#1957" class="Function Operator">&lt;$&gt;</a> <a id="9186" href="IO.html#2872" class="Function">readFiniteFile</a> <a id="9201" href="Test.Golden.html#9052" class="Bound">fp</a>

    <a id="9209" href="Test.Golden.html#9209" class="Function">getAnswer</a> <a id="9219" class="Symbol">:</a> <a id="9221" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="9224" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="9233" href="Test.Golden.html#9209" class="Function">getAnswer</a> <a id="9243" class="Symbol">=</a> <a id="9245" href="IO.Base.html#3664" class="Function">untilJust</a> <a id="9255" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9257" class="Keyword">do</a>
      <a id="9266" href="Test.Golden.html#9266" class="Bound">str</a> <a id="9270" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="9272" href="IO.Finite.html#1036" class="Function">getLine</a>
      <a id="9286" href="Function.Base.html#3973" class="Function Operator">case</a> <a id="9291" href="Test.Golden.html#9266" class="Bound">str</a> <a id="9295" href="Function.Base.html#3973" class="Function Operator">of</a> <a id="9298" class="Symbol">λ</a> <a id="9300" class="Keyword">where</a>
        <a id="9314" class="String">&quot;y&quot;</a> <a id="9318" class="Symbol">→</a> <a id="9320" href="IO.Base.html#1349" class="Function">pure</a> <a id="9325" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9327" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9332" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
        <a id="9345" class="String">&quot;n&quot;</a> <a id="9349" class="Symbol">→</a> <a id="9351" href="IO.Base.html#1349" class="Function">pure</a> <a id="9356" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9358" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9363" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
        <a id="9377" class="String">&quot;&quot;</a>  <a id="9381" class="Symbol">→</a> <a id="9383" href="IO.Base.html#1349" class="Function">pure</a> <a id="9388" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9390" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="9395" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="9401" class="Comment">-- default answer is no</a>
        <a id="9433" class="Symbol">_</a>   <a id="9437" class="Symbol">→</a> <a id="9439" class="Keyword">do</a> <a id="9442" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="9451" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9486" href="IO.Base.html#1349" class="Function">pure</a> <a id="9491" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

    <a id="9504" href="Test.Golden.html#9504" class="Function">expVsOut</a> <a id="9513" class="Symbol">:</a> <a id="9515" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9522" class="Symbol">→</a> <a id="9524" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9531" class="Symbol">→</a> <a id="9533" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="9538" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="9549" href="Test.Golden.html#9504" class="Function">expVsOut</a> <a id="9558" href="Test.Golden.html#9558" class="Bound">exp</a> <a id="9562" href="Test.Golden.html#9562" class="Bound">out</a> <a id="9566" class="Symbol">=</a> <a id="9568" class="String">&quot;Expected:&quot;</a> <a id="9580" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9582" href="Test.Golden.html#9558" class="Bound">exp</a> <a id="9586" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9588" class="String">&quot;Given:&quot;</a> <a id="9597" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9599" href="Test.Golden.html#9562" class="Bound">out</a> <a id="9603" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9605" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

    <a id="9613" href="Test.Golden.html#9613" class="Function">hasFailed</a> <a id="9623" class="Symbol">:</a> <a id="9625" href="System.Exit.Primitive.html#393" class="Datatype">ExitCode</a> <a id="9634" class="Symbol">→</a> <a id="9636" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
    <a id="9645" href="Test.Golden.html#9613" class="Function">hasFailed</a> <a id="9655" href="System.Exit.Primitive.html#416" class="InductiveConstructor">ExitSuccess</a>        <a id="9674" class="Symbol">=</a> <a id="9676" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
    <a id="9686" href="Test.Golden.html#9613" class="Function">hasFailed</a> <a id="9696" class="Symbol">(</a><a id="9697" href="System.Exit.Primitive.html#441" class="InductiveConstructor">ExitFailure</a> <a id="9709" href="Test.Golden.html#9709" class="Bound">code</a><a id="9713" class="Symbol">)</a> <a id="9715" class="Symbol">=</a> <a id="9717" href="Test.Golden.html#9709" class="Bound">code</a> <a id="9722" href="Data.Integer.Base.html#2661" class="Function Operator">ℤ.≤ᵇ</a> <a id="9727" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">ℤ.+</a> <a id="9731" class="Number">0</a>

    <a id="9738" href="Test.Golden.html#9738" class="Function">mayOverwrite</a> <a id="9751" class="Symbol">:</a> <a id="9753" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="9759" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9766" class="Symbol">→</a> <a id="9768" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="9775" class="Symbol">→</a> <a id="9777" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="9780" class="Symbol">_</a>
    <a id="9786" href="Test.Golden.html#9738" class="Function">mayOverwrite</a> <a id="9799" href="Test.Golden.html#9799" class="Bound">mexp</a> <a id="9804" href="Test.Golden.html#9804" class="Bound">out</a> <a id="9808" class="Symbol">=</a> <a id="9810" class="Keyword">do</a>
      <a id="9819" href="Function.Base.html#3973" class="Function Operator">case</a> <a id="9824" href="Test.Golden.html#9799" class="Bound">mexp</a> <a id="9829" href="Function.Base.html#3973" class="Function Operator">of</a> <a id="9832" class="Symbol">λ</a> <a id="9834" class="Keyword">where</a>
        <a id="9848" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="9856" class="Symbol">→</a> <a id="9858" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="9867" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9869" href="Data.String.Base.html#2767" class="Function">unlines</a>
          <a id="9887" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="9889" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="9956" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9958" href="Test.Golden.html#9804" class="Bound">out</a>
          <a id="9972" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="9974" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10017" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10019" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
        <a id="10030" class="Symbol">(</a><a id="10031" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="10036" href="Test.Golden.html#10036" class="Bound">exp</a><a id="10039" class="Symbol">)</a> <a id="10041" class="Symbol">→</a> <a id="10043" class="Keyword">do</a>
          <a id="10056" href="Test.Golden.html#10056" class="Bound">code</a> <a id="10061" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="10063" href="System.Process.html#720" class="Function">system</a> <a id="10070" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10072" href="Data.String.Base.html#2554" class="Function">concat</a>
            <a id="10091" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10093" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10158" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10160" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="10169" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10171" class="String">&quot;/expected &quot;</a>
            <a id="10196" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10198" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="10207" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10209" class="String">&quot;/output&quot;</a>
            <a id="10231" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10233" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
          <a id="10246" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="10255" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10257" href="Data.String.Base.html#2767" class="Function">unlines</a>
            <a id="10277" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10279" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10333" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10335" class="Symbol">(</a><a id="10336" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="10339" href="Test.Golden.html#9613" class="Function">hasFailed</a> <a id="10349" href="Test.Golden.html#10056" class="Bound">code</a> <a id="10354" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="10359" href="Test.Golden.html#9504" class="Function">expVsOut</a> <a id="10368" href="Test.Golden.html#10036" class="Bound">exp</a> <a id="10372" href="Test.Golden.html#9804" class="Bound">out</a> <a id="10376" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="10381" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="10383" class="Symbol">)</a>
            <a id="10397" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="10400" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10461" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10463" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

      <a id="10473" href="Test.Golden.html#10473" class="Bound">b</a> <a id="10475" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="10477" href="Test.Golden.html#9209" class="Function">getAnswer</a>
      <a id="10493" href="IO.Base.html#3324" class="Function">when</a> <a id="10498" href="Test.Golden.html#10473" class="Bound">b</a> <a id="10500" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10502" href="IO.Finite.html#1267" class="Function">writeFile</a> <a id="10512" class="Symbol">(</a><a id="10513" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="10522" href="Data.String.Base.html#2366" class="Function Operator">String.++</a> <a id="10532" class="String">&quot;/expected&quot;</a><a id="10543" class="Symbol">)</a> <a id="10545" href="Test.Golden.html#9804" class="Bound">out</a>

    <a id="10554" href="Test.Golden.html#10554" class="Function">printTiming</a> <a id="10566" class="Symbol">:</a> <a id="10568" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="10573" class="Symbol">→</a> <a id="10575" href="System.Clock.html#1907" class="Record">Time</a> <a id="10580" class="Symbol">→</a> <a id="10582" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="10589" class="Symbol">→</a> <a id="10591" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="10594" class="Symbol">_</a>
    <a id="10600" href="Test.Golden.html#10554" class="Function">printTiming</a> <a id="10612" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="10618" class="Symbol">_</a>    <a id="10623" href="Test.Golden.html#10623" class="Bound">msg</a> <a id="10627" class="Symbol">=</a> <a id="10629" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="10638" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10640" href="Data.String.Base.html#2554" class="Function">concat</a> <a id="10647" class="Symbol">(</a><a id="10648" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="10657" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10659" class="String">&quot;: &quot;</a> <a id="10664" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10666" href="Test.Golden.html#10623" class="Bound">msg</a> <a id="10670" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10672" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="10674" class="Symbol">)</a>
    <a id="10680" href="Test.Golden.html#10554" class="Function">printTiming</a> <a id="10692" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>  <a id="10698" href="Test.Golden.html#10698" class="Bound">time</a> <a id="10703" href="Test.Golden.html#10703" class="Bound">msg</a> <a id="10707" class="Symbol">=</a>
      <a id="10715" class="Keyword">let</a> <a id="10719" href="Test.Golden.html#10719" class="Bound">time</a>  <a id="10725" class="Symbol">=</a> <a id="10727" href="Data.Nat.Show.html#1928" class="Function">ℕ.show</a> <a id="10734" class="Symbol">(</a><a id="10735" href="Test.Golden.html#10698" class="Bound">time</a> <a id="10740" class="Symbol">.</a><a id="10741" href="System.Clock.html#1953" class="Field">seconds</a><a id="10748" class="Symbol">)</a> <a id="10750" href="Data.String.Base.html#2366" class="Function Operator">String.++</a> <a id="10760" class="String">&quot;s&quot;</a>
          <a id="10774" href="Test.Golden.html#10774" class="Bound">spent</a> <a id="10780" class="Symbol">=</a> <a id="10782" class="Number">9</a> <a id="10784" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="10786" href="Data.List.Base.html#4784" class="Function">List.sum</a> <a id="10795" class="Symbol">(</a><a id="10796" href="Data.List.Base.html#1544" class="Function">List.map</a> <a id="10805" href="Data.String.Base.html#2430" class="Function">String.length</a> <a id="10819" class="Symbol">(</a><a id="10820" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="10829" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10831" href="Test.Golden.html#10719" class="Bound">time</a> <a id="10836" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="10838" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="10840" class="Symbol">))</a>
               <a id="10858" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="10934" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11017" href="Test.Golden.html#11017" class="Bound">pad</a>   <a id="11023" class="Symbol">=</a> <a id="11025" href="Data.String.Base.html#2481" class="Function">String.replicate</a> <a id="11042" class="Symbol">(</a><a id="11043" class="Number">72</a> <a id="11046" href="Data.Nat.Base.html#2874" class="Primitive Operator">∸</a> <a id="11048" href="Test.Golden.html#10774" class="Bound">spent</a><a id="11053" class="Symbol">)</a> <a id="11055" class="String">&#39; &#39;</a>
      <a id="11065" class="Keyword">in</a> <a id="11068" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="11077" class="Symbol">(</a><a id="11078" href="Data.String.Base.html#2554" class="Function">concat</a> <a id="11085" class="Symbol">(</a><a id="11086" href="Test.Golden.html#7242" class="Bound">testPath</a> <a id="11095" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11097" class="String">&quot;: &quot;</a> <a id="11102" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11104" href="Test.Golden.html#10703" class="Bound">msg</a> <a id="11108" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11110" href="Test.Golden.html#11017" class="Bound">pad</a> <a id="11114" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11116" href="Test.Golden.html#10719" class="Bound">time</a> <a id="11121" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="11123" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="11125" class="Symbol">))</a>

<a id="11129" class="Comment">-- A test pool is characterised by</a>
<a id="11164" class="Comment">--  + a name</a>
<a id="11177" class="Comment">--  + and a list of directory paths</a>
<a id="11213" class="Keyword">record</a> <a id="TestPool"></a><a id="11220" href="Test.Golden.html#11220" class="Record">TestPool</a> <a id="11229" class="Symbol">:</a> <a id="11231" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="11235" class="Keyword">where</a>
  <a id="11243" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11255" href="Test.Golden.html#11255" class="InductiveConstructor">mkTestPool</a>
  <a id="11268" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11278" href="Test.Golden.html#11278" class="Field">poolName</a> <a id="11287" class="Symbol">:</a> <a id="11289" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11300" href="Test.Golden.html#11300" class="Field">testCases</a> <a id="11310" class="Symbol">:</a> <a id="11312" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11317" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="11324" class="Keyword">open</a> <a id="11329" href="Test.Golden.html#11220" class="Module">TestPool</a>

<a id="11339" class="Keyword">module</a> <a id="Summary"></a><a id="11346" href="Test.Golden.html#11346" class="Module">Summary</a> <a id="11354" class="Keyword">where</a>

  <a id="11363" class="Comment">-- The summary of a test pool run</a>
  <a id="11399" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11406" href="Test.Golden.html#11406" class="Record">Summary</a> <a id="11414" class="Symbol">:</a> <a id="11416" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="11420" class="Keyword">where</a>
    <a id="11430" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11442" href="Test.Golden.html#11442" class="InductiveConstructor">mkSummary</a>
    <a id="11456" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11468" href="Test.Golden.html#11468" class="Field">success</a> <a id="11476" class="Symbol">:</a> <a id="11478" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11483" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11496" href="Test.Golden.html#11496" class="Field">failure</a> <a id="11504" class="Symbol">:</a> <a id="11506" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11511" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="11520" class="Keyword">open</a> <a id="11525" href="Test.Golden.html#11406" class="Module">Summary</a> <a id="11533" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11543" href="Test.Golden.html#11543" class="Function">init</a> <a id="11548" class="Symbol">:</a> <a id="11550" href="Test.Golden.html#11406" class="Record">Summary</a>
  <a id="11560" href="Test.Golden.html#11543" class="Function">init</a> <a id="11565" class="Symbol">=</a> <a id="11567" href="Test.Golden.html#11442" class="InductiveConstructor">mkSummary</a> <a id="11577" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="11580" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11586" href="Test.Golden.html#11586" class="Function">merge</a> <a id="11592" class="Symbol">:</a> <a id="11594" href="Test.Golden.html#11406" class="Record">Summary</a> <a id="11602" class="Symbol">→</a> <a id="11604" href="Test.Golden.html#11406" class="Record">Summary</a> <a id="11612" class="Symbol">→</a> <a id="11614" href="Test.Golden.html#11406" class="Record">Summary</a>
  <a id="11624" href="Test.Golden.html#11586" class="Function">merge</a> <a id="11630" class="Symbol">(</a><a id="11631" href="Test.Golden.html#11442" class="InductiveConstructor">mkSummary</a> <a id="11641" href="Test.Golden.html#11641" class="Bound">ws1</a> <a id="11645" href="Test.Golden.html#11645" class="Bound">ls1</a><a id="11648" class="Symbol">)</a> <a id="11650" class="Symbol">(</a><a id="11651" href="Test.Golden.html#11442" class="InductiveConstructor">mkSummary</a> <a id="11661" href="Test.Golden.html#11661" class="Bound">ws2</a> <a id="11665" href="Test.Golden.html#11665" class="Bound">ls2</a><a id="11668" class="Symbol">)</a> <a id="11670" class="Symbol">=</a>
   <a id="11675" href="Test.Golden.html#11442" class="InductiveConstructor">mkSummary</a> <a id="11685" class="Symbol">(</a><a id="11686" href="Test.Golden.html#11661" class="Bound">ws2</a> <a id="11690" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="11693" href="Test.Golden.html#11641" class="Bound">ws1</a><a id="11696" class="Symbol">)</a> <a id="11698" class="Symbol">(</a><a id="11699" href="Test.Golden.html#11665" class="Bound">ls2</a> <a id="11703" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="11706" href="Test.Golden.html#11645" class="Bound">ls1</a><a id="11709" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11714" href="Test.Golden.html#11714" class="Function">update</a> <a id="11721" class="Symbol">:</a> <a id="11723" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11728" href="Test.Golden.html#7091" class="Function">Result</a> <a id="11735" class="Symbol">→</a> <a id="11737" href="Test.Golden.html#11406" class="Record">Summary</a> <a id="11745" class="Symbol">→</a> <a id="11747" href="Test.Golden.html#11406" class="Record">Summary</a>
  <a id="11757" href="Test.Golden.html#11714" class="Function">update</a> <a id="11764" href="Test.Golden.html#11764" class="Bound">res</a> <a id="11768" href="Test.Golden.html#11768" class="Bound">sum</a> <a id="11772" class="Symbol">=</a>
    <a id="11778" class="Keyword">let</a> <a id="11782" class="Symbol">(</a><a id="11783" href="Test.Golden.html#11783" class="Bound">ls2</a> <a id="11787" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="11789" href="Test.Golden.html#11789" class="Bound">ws2</a><a id="11792" class="Symbol">)</a> <a id="11794" class="Symbol">=</a> <a id="11796" href="Data.List.Base.html#3760" class="Function">partitionSums</a> <a id="11810" href="Test.Golden.html#11764" class="Bound">res</a> <a id="11814" class="Keyword">in</a>
    <a id="11821" href="Test.Golden.html#11586" class="Function">merge</a> <a id="11827" href="Test.Golden.html#11768" class="Bound">sum</a> <a id="11831" class="Symbol">(</a><a id="11832" href="Test.Golden.html#11442" class="InductiveConstructor">mkSummary</a> <a id="11842" href="Test.Golden.html#11789" class="Bound">ws2</a> <a id="11846" href="Test.Golden.html#11783" class="Bound">ls2</a><a id="11849" class="Symbol">)</a>

<a id="11852" class="Keyword">open</a> <a id="11857" href="Test.Golden.html#11346" class="Module">Summary</a> <a id="11865" class="Keyword">using</a> <a id="11871" class="Symbol">(</a><a id="11872" href="Test.Golden.html#11406" class="Record">Summary</a><a id="11879" class="Symbol">)</a> <a id="11881" class="Keyword">hiding</a> <a id="11888" class="Symbol">(</a><a id="11889" class="Keyword">module</a> <a id="11896" href="Test.Golden.html#11406" class="Module">Summary</a><a id="11903" class="Symbol">)</a>

<a id="11906" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="11954" href="Test.Golden.html#11954" class="Function">filterTests</a> <a id="11966" class="Symbol">:</a> <a id="11968" href="Test.Golden.html#4377" class="Record">Options</a> <a id="11976" class="Symbol">→</a> <a id="11978" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11983" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="11990" class="Symbol">→</a> <a id="11992" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="11997" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="12004" href="Test.Golden.html#11954" class="Function">filterTests</a> <a id="12016" href="Test.Golden.html#12016" class="Bound">opts</a> <a id="12021" class="Symbol">=</a> <a id="12023" href="Function.Base.html#3973" class="Function Operator">case</a> <a id="12028" href="Test.Golden.html#4530" class="Field">onlyNames</a> <a id="12038" href="Test.Golden.html#12016" class="Bound">opts</a> <a id="12043" href="Function.Base.html#3973" class="Function Operator">of</a> <a id="12046" class="Symbol">λ</a> <a id="12048" class="Keyword">where</a>
  <a id="12056" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="12059" class="Symbol">→</a> <a id="12061" href="Function.Base.html#695" class="Function">id</a>
  <a id="12066" href="Test.Golden.html#12066" class="CatchallClause Bound">xs</a> <a id="12069" class="Symbol">→</a> <a id="12071" class="Keyword">let</a> <a id="12075" href="Test.Golden.html#12075" class="Bound">names</a> <a id="12081" class="Symbol">=</a> <a id="12083" href="Data.List.Base.html#1544" class="Function">List.map</a> <a id="12092" href="Data.String.Base.html#1493" class="Primitive">String.toList</a> <a id="12106" href="Test.Golden.html#12066" class="Bound">xs</a> <a id="12109" class="Keyword">in</a>
       <a id="12119" href="Data.List.Base.html#8092" class="Function">filter</a> <a id="12126" class="Symbol">(λ</a> <a id="12129" href="Test.Golden.html#12129" class="Bound">n</a> <a id="12131" class="Symbol">→</a> <a id="12133" href="Data.List.Relation.Unary.Any.html#2668" class="Function">any?</a> <a id="12138" class="Symbol">(λ</a> <a id="12141" href="Test.Golden.html#12141" class="Bound">m</a> <a id="12143" class="Symbol">→</a> <a id="12145" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6728" class="Function">infix?</a> <a id="12152" href="Data.Char.Properties.html#1522" class="Function Operator">Char._≟_</a> <a id="12161" href="Test.Golden.html#12141" class="Bound">m</a> <a id="12163" class="Symbol">(</a><a id="12164" href="Data.String.Base.html#1493" class="Primitive">String.toList</a> <a id="12178" href="Test.Golden.html#12129" class="Bound">n</a><a id="12179" class="Symbol">))</a> <a id="12182" href="Test.Golden.html#12075" class="Bound">names</a><a id="12187" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12190" href="Test.Golden.html#12190" class="Function">poolRunner</a> <a id="12201" class="Symbol">:</a> <a id="12203" href="Test.Golden.html#4377" class="Record">Options</a> <a id="12211" class="Symbol">→</a> <a id="12213" href="Test.Golden.html#11220" class="Record">TestPool</a> <a id="12222" class="Symbol">→</a> <a id="12224" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="12227" href="Test.Golden.html#11406" class="Record">Summary</a>
<a id="12235" href="Test.Golden.html#12190" class="Function">poolRunner</a> <a id="12246" href="Test.Golden.html#12246" class="Bound">opts</a> <a id="12251" href="Test.Golden.html#12251" class="Bound">pool</a> <a id="12256" class="Symbol">=</a> <a id="12258" class="Keyword">do</a>
  <a id="12263" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12324" class="Keyword">let</a> <a id="12328" href="Test.Golden.html#12328" class="Bound">tests</a> <a id="12334" class="Symbol">=</a> <a id="12336" href="Test.Golden.html#11954" class="Function">filterTests</a> <a id="12348" href="Test.Golden.html#12246" class="Bound">opts</a> <a id="12353" class="Symbol">(</a><a id="12354" href="Test.Golden.html#12251" class="Bound">pool</a> <a id="12359" class="Symbol">.</a><a id="12360" href="Test.Golden.html#11300" class="Field">testCases</a><a id="12369" class="Symbol">)</a>
  <a id="12373" class="Symbol">(_</a> <a id="12376" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12378" class="Symbol">_)</a> <a id="12381" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="12383" href="IO.Base.html#1349" class="Function">pure</a> <a id="12388" href="Test.Golden.html#12328" class="Bound">tests</a>
    <a id="12398" class="Keyword">where</a> <a id="12404" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="12407" class="Symbol">→</a> <a id="12409" href="IO.Base.html#1349" class="Function">pure</a> <a id="12414" href="Test.Golden.html#11543" class="Function">Summary.init</a>

  <a id="12430" class="Comment">-- announce the test pool and run them</a>
  <a id="12471" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="12480" href="Test.Golden.html#12585" class="Function">banner</a>
  <a id="12489" href="Test.Golden.html#12715" class="Function">loop</a> <a id="12494" href="Test.Golden.html#11543" class="Function">Summary.init</a> <a id="12507" href="Test.Golden.html#12328" class="Bound">tests</a>

  <a id="12516" class="Keyword">where</a>

  <a id="12525" href="Test.Golden.html#12525" class="Function">separator</a> <a id="12535" class="Symbol">:</a> <a id="12537" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="12546" href="Test.Golden.html#12525" class="Function">separator</a> <a id="12556" class="Symbol">=</a> <a id="12558" href="Data.String.Base.html#2481" class="Function">String.replicate</a> <a id="12575" class="Number">72</a> <a id="12578" class="String">&#39;-&#39;</a>

  <a id="12585" href="Test.Golden.html#12585" class="Function">banner</a> <a id="12592" class="Symbol">:</a> <a id="12594" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="12603" href="Test.Golden.html#12585" class="Function">banner</a> <a id="12610" class="Symbol">=</a> <a id="12612" href="Data.String.Base.html#2767" class="Function">unlines</a>
         <a id="12629" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="12631" class="String">&quot;&quot;</a> <a id="12634" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12636" href="Test.Golden.html#12525" class="Function">separator</a>
         <a id="12655" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12657" href="Test.Golden.html#12251" class="Bound">pool</a> <a id="12662" class="Symbol">.</a><a id="12663" href="Test.Golden.html#11278" class="Field">poolName</a>
         <a id="12681" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12683" href="Test.Golden.html#12525" class="Function">separator</a> <a id="12693" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12695" class="String">&quot;&quot;</a>
         <a id="12707" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12709" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="12715" href="Test.Golden.html#12715" class="Function">loop</a> <a id="12720" class="Symbol">:</a> <a id="12722" href="Test.Golden.html#11406" class="Record">Summary</a> <a id="12730" class="Symbol">→</a> <a id="12732" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="12737" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="12744" class="Symbol">→</a> <a id="12746" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="12749" href="Test.Golden.html#11406" class="Record">Summary</a>
  <a id="12759" href="Test.Golden.html#12715" class="Function">loop</a> <a id="12764" href="Test.Golden.html#12764" class="Bound">acc</a> <a id="12768" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="12771" class="Symbol">=</a> <a id="12773" href="IO.Base.html#1349" class="Function">pure</a> <a id="12778" href="Test.Golden.html#12764" class="Bound">acc</a>
  <a id="12784" href="Test.Golden.html#12715" class="Function">loop</a> <a id="12789" href="Test.Golden.html#12789" class="Bound">acc</a> <a id="12793" class="Symbol">(</a><a id="12794" href="Test.Golden.html#12794" class="Bound">test</a> <a id="12799" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12801" href="Test.Golden.html#12801" class="Bound">tests</a><a id="12806" class="Symbol">)</a> <a id="12808" class="Symbol">=</a> <a id="12810" class="Keyword">do</a>
    <a id="12817" href="Test.Golden.html#12817" class="Bound">res</a> <a id="12821" href="IO.Base.html#2068" class="Function Operator">&lt;-</a> <a id="12824" href="Test.Golden.html#7190" class="Function">runTest</a> <a id="12832" href="Test.Golden.html#12246" class="Bound">opts</a> <a id="12837" href="Test.Golden.html#12794" class="Bound">test</a>
    <a id="12846" href="Test.Golden.html#12715" class="Function">loop</a> <a id="12851" class="Symbol">(</a><a id="12852" href="Test.Golden.html#11714" class="Function">Summary.update</a> <a id="12867" class="Symbol">(</a><a id="12868" href="Test.Golden.html#12817" class="Bound">res</a> <a id="12872" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="12874" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="12876" class="Symbol">)</a> <a id="12878" href="Test.Golden.html#12789" class="Bound">acc</a><a id="12881" class="Symbol">)</a> <a id="12883" href="Test.Golden.html#12801" class="Bound">tests</a>

<a id="runner"></a><a id="12890" href="Test.Golden.html#12890" class="Function">runner</a> <a id="12897" class="Symbol">:</a> <a id="12899" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="12904" href="Test.Golden.html#11220" class="Record">TestPool</a> <a id="12913" class="Symbol">→</a> <a id="12915" href="IO.Base.html#1121" class="Datatype">IO</a> <a id="12918" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="12920" href="Test.Golden.html#12890" class="Function">runner</a> <a id="12927" href="Test.Golden.html#12927" class="Bound">tests</a> <a id="12933" class="Symbol">=</a> <a id="12935" class="Keyword">do</a>
  <a id="12940" class="Comment">-- figure out the options</a>
  <a id="12968" href="Test.Golden.html#12968" class="Bound">args</a> <a id="12973" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="12975" href="System.Environment.html#646" class="Function">getArgs</a>
  <a id="12985" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="12990" href="Test.Golden.html#12990" class="Bound">opts</a> <a id="12995" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="12997" href="Test.Golden.html#5565" class="Function">options</a> <a id="13005" href="Test.Golden.html#12968" class="Bound">args</a>
    <a id="13014" class="Keyword">where</a> <a id="13020" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="13025" href="Test.Golden.html#13025" class="Bound">err</a> <a id="13029" class="Symbol">→</a> <a id="13031" href="System.Exit.html#1357" class="Function">die</a> <a id="13035" class="Symbol">(</a><a id="13036" href="Data.String.Base.html#2767" class="Function">unlines</a> <a id="13044" class="Symbol">(</a><a id="13045" href="Test.Golden.html#5378" class="Function">show</a> <a id="13050" href="Test.Golden.html#13025" class="Bound">err</a> <a id="13054" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13056" href="Test.Golden.html#5082" class="Function">usage</a> <a id="13062" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13064" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="13066" class="Symbol">))</a>

  <a id="13072" class="Comment">-- run the tests</a>
  <a id="13091" href="Test.Golden.html#13091" class="Bound">ress</a> <a id="13096" href="IO.Base.html#2068" class="Function Operator">←</a> <a id="13098" href="IO.html#2044" class="Function">List.mapM</a> <a id="13108" class="Symbol">(</a><a id="13109" href="Test.Golden.html#12190" class="Function">poolRunner</a> <a id="13120" href="Test.Golden.html#12990" class="Bound">opts</a><a id="13124" class="Symbol">)</a> <a id="13126" href="Test.Golden.html#12927" class="Bound">tests</a>
  <a id="13134" class="Keyword">let</a> <a id="13138" class="Keyword">open</a> <a id="13143" href="Test.Golden.html#11346" class="Module">Summary</a>
  <a id="13153" class="Keyword">let</a> <a id="13157" href="Test.Golden.html#13157" class="Bound">res</a> <a id="13161" class="Symbol">=</a> <a id="13163" href="Data.List.Base.html#4293" class="Function">List.foldl</a> <a id="13174" href="Test.Golden.html#11586" class="Function">merge</a> <a id="13180" href="Test.Golden.html#11543" class="Function">init</a> <a id="13185" href="Test.Golden.html#13091" class="Bound">ress</a>

  <a id="13193" class="Comment">-- report the result</a>
  <a id="13216" class="Keyword">let</a> <a id="13220" href="Test.Golden.html#13220" class="Bound">nsucc</a> <a id="13226" class="Symbol">=</a> <a id="13228" href="Data.List.Base.html#4864" class="Function">List.length</a> <a id="13240" class="Symbol">(</a><a id="13241" href="Test.Golden.html#13157" class="Bound">res</a> <a id="13245" class="Symbol">.</a><a id="13246" href="Test.Golden.html#11468" class="Field">success</a><a id="13253" class="Symbol">)</a>
  <a id="13257" class="Keyword">let</a> <a id="13261" href="Test.Golden.html#13261" class="Bound">nfail</a> <a id="13267" class="Symbol">=</a> <a id="13269" href="Data.List.Base.html#4864" class="Function">List.length</a> <a id="13281" class="Symbol">(</a><a id="13282" href="Test.Golden.html#13157" class="Bound">res</a> <a id="13286" class="Symbol">.</a><a id="13287" href="Test.Golden.html#11496" class="Field">failure</a><a id="13294" class="Symbol">)</a>
  <a id="13298" class="Keyword">let</a> <a id="13302" href="Test.Golden.html#13302" class="Bound">ntotal</a> <a id="13309" class="Symbol">=</a> <a id="13311" href="Test.Golden.html#13220" class="Bound">nsucc</a> <a id="13317" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="13319" href="Test.Golden.html#13261" class="Bound">nfail</a>
  <a id="13327" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="13336" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13338" href="Data.String.Base.html#2554" class="Function">concat</a> <a id="13345" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13347" href="Data.Nat.Show.html#1928" class="Function">ℕ.show</a> <a id="13354" href="Test.Golden.html#13220" class="Bound">nsucc</a> <a id="13360" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13362" class="String">&quot;/&quot;</a> <a id="13366" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13368" href="Data.Nat.Show.html#1928" class="Function">ℕ.show</a> <a id="13375" href="Test.Golden.html#13302" class="Bound">ntotal</a> <a id="13382" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13384" class="String">&quot; tests successful&quot;</a> <a id="13404" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="13406" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="13412" class="Comment">-- deal with failures</a>
  <a id="13436" class="Keyword">let</a> <a id="13440" href="Test.Golden.html#13440" class="Bound">list</a> <a id="13445" class="Symbol">=</a> <a id="13447" href="Data.String.Base.html#2767" class="Function">unlines</a> <a id="13455" class="Symbol">(</a><a id="13456" href="Test.Golden.html#13157" class="Bound">res</a> <a id="13460" class="Symbol">.</a><a id="13461" href="Test.Golden.html#11496" class="Field">failure</a><a id="13468" class="Symbol">)</a>
  <a id="13472" href="IO.Base.html#3324" class="Function">when</a> <a id="13477" class="Symbol">(</a><a id="13478" class="Number">0</a> <a id="13480" href="Data.Nat.Base.html#1301" class="Primitive Operator">&lt;ᵇ</a> <a id="13483" href="Test.Golden.html#13261" class="Bound">nfail</a><a id="13488" class="Symbol">)</a> <a id="13490" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13492" class="Keyword">do</a>
    <a id="13499" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="13508" class="String">&quot;Failing tests:&quot;</a>
    <a id="13529" href="IO.Finite.html#1497" class="Function">putStrLn</a> <a id="13538" href="Test.Golden.html#13440" class="Bound">list</a>
  <a id="13545" href="IO.Base.html#3447" class="Function">whenJust</a> <a id="13554" class="Symbol">(</a><a id="13555" href="Test.Golden.html#12990" class="Bound">opts</a> <a id="13560" class="Symbol">.</a><a id="13561" href="Test.Golden.html#4755" class="Field">failureFile</a><a id="13572" class="Symbol">)</a> <a id="13574" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="13576" class="Symbol">λ</a> <a id="13578" href="Test.Golden.html#13578" class="Bound">fp</a> <a id="13581" class="Symbol">→</a> <a id="13583" href="IO.Finite.html#1267" class="Function">writeFile</a> <a id="13593" href="Test.Golden.html#13578" class="Bound">fp</a> <a id="13596" href="Test.Golden.html#13440" class="Bound">list</a>

  <a id="13604" class="Comment">-- exit</a>
  <a id="13614" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="13617" class="Number">0</a> <a id="13619" href="Data.Nat.Base.html#1127" class="Primitive Operator">≡ᵇ</a> <a id="13622" href="Test.Golden.html#13261" class="Bound">nfail</a>
   <a id="13631" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="13636" href="System.Exit.html#1302" class="Function">exitSuccess</a>
   <a id="13651" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="13656" href="System.Exit.html#1239" class="Function">exitFailure</a>
</pre></body></html>