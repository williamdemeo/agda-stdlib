<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">--</a>

<a id="2621" class="Comment">------------------------------------------------------------------------</a>
<a id="2694" class="Comment">-- Usage</a>
<a id="2703" class="Comment">--</a>
<a id="2706" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2763" class="Comment">--</a>
<a id="2766" class="Comment">--```sh</a>
<a id="2774" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2817" class="Comment">--   [--timing]</a>
<a id="2833" class="Comment">--   [--interactive]</a>
<a id="2854" class="Comment">--   [--only-file PATH]</a>
<a id="2878" class="Comment">--   [--failure-file PATH]</a>
<a id="2905" class="Comment">--   [--no-colour]</a>
<a id="2924" class="Comment">--   [--only [NAMES]]</a>
<a id="2946" class="Comment">--```</a>
<a id="2952" class="Comment">--</a>
<a id="2955" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3036" class="Symbol">{-#</a> <a id="3040" class="Keyword">OPTIONS</a> <a id="3048" class="Pragma">--cubical-compatible</a> <a id="3069" class="Pragma">--guardedness</a> <a id="3083" class="Symbol">#-}</a>

<a id="3088" class="Keyword">module</a> <a id="3095" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3107" class="Keyword">where</a>

<a id="3114" class="Keyword">open</a> <a id="3119" class="Keyword">import</a> <a id="3126" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3141" class="Keyword">using</a> <a id="3147" class="Symbol">(</a><a id="3148" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a><a id="3152" class="Symbol">;</a> <a id="3154" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="3158" class="Symbol">;</a> <a id="3160" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="3165" class="Symbol">;</a> <a id="3167" href="Data.Bool.Base.html#1505" class="Function Operator">if_then_else_</a><a id="3180" class="Symbol">)</a>
<a id="3182" class="Keyword">import</a> <a id="3189" href="Data.Char.html" class="Module">Data.Char</a> <a id="3199" class="Symbol">as</a> <a id="3202" class="Module">Char</a>
<a id="3207" class="Keyword">open</a> <a id="3212" class="Keyword">import</a> <a id="3219" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3228" class="Keyword">using</a> <a id="3234" class="Symbol">(</a><a id="3235" href="Data.Fin.html#739" class="Function Operator">#_</a><a id="3237" class="Symbol">)</a>
<a id="3239" class="Keyword">import</a> <a id="3246" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3264" class="Symbol">as</a> <a id="3267" class="Module">ℤ</a>
<a id="3269" class="Keyword">open</a> <a id="3274" class="Keyword">import</a> <a id="3281" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3296" class="Symbol">as</a> <a id="3299" class="Module">List</a> <a id="3304" class="Keyword">using</a> <a id="3310" class="Symbol">(</a><a id="3311" href="Agda.Builtin.List.html#147" class="Datatype">List</a><a id="3315" class="Symbol">;</a> <a id="3317" href="Data.List.Base.html#7793" class="InductiveConstructor">[]</a><a id="3319" class="Symbol">;</a> <a id="3321" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">_∷_</a><a id="3324" class="Symbol">;</a> <a id="3326" href="Data.List.Base.html#1954" class="Function Operator">_++_</a><a id="3330" class="Symbol">;</a> <a id="3332" href="Data.List.Base.html#10878" class="Function">filter</a><a id="3338" class="Symbol">;</a> <a id="3340" href="Data.List.Base.html#3904" class="Function">partitionSums</a><a id="3353" class="Symbol">)</a>
<a id="3355" class="Keyword">open</a> <a id="3360" class="Keyword">import</a> <a id="3367" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3424" class="Keyword">using</a> <a id="3430" class="Symbol">(</a><a id="3431" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6720" class="Function">infix?</a><a id="3437" class="Symbol">)</a>
<a id="3439" class="Keyword">open</a> <a id="3444" class="Keyword">import</a> <a id="3451" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3480" class="Keyword">using</a> <a id="3486" class="Symbol">(</a><a id="3487" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a><a id="3491" class="Symbol">)</a>
<a id="3493" class="Keyword">open</a> <a id="3498" class="Keyword">import</a> <a id="3505" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3521" class="Keyword">using</a> <a id="3527" class="Symbol">(</a><a id="3528" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="3533" class="Symbol">;</a> <a id="3535" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="3539" class="Symbol">;</a> <a id="3541" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="3548" class="Symbol">;</a> <a id="3550" href="Data.Maybe.Base.html#1661" class="Function">fromMaybe</a><a id="3559" class="Symbol">)</a>
<a id="3561" class="Keyword">open</a> <a id="3566" class="Keyword">import</a> <a id="3573" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3587" class="Keyword">using</a> <a id="3593" class="Symbol">(</a><a id="3594" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3595" class="Symbol">;</a> <a id="3597" href="Data.Nat.Base.html#1283" class="Primitive Operator">_≡ᵇ_</a><a id="3601" class="Symbol">;</a> <a id="3603" href="Data.Nat.Base.html#1457" class="Primitive Operator">_&lt;ᵇ_</a><a id="3607" class="Symbol">;</a> <a id="3609" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">_+_</a><a id="3612" class="Symbol">;</a> <a id="3614" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="3617" class="Symbol">)</a>
<a id="3619" class="Keyword">import</a> <a id="3626" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3640" class="Symbol">as</a> <a id="3643" class="Module">ℕ</a> <a id="3645" class="Keyword">using</a> <a id="3651" class="Symbol">(</a><a id="3652" href="Data.Nat.Show.html#1962" class="Function">show</a><a id="3656" class="Symbol">)</a>
<a id="3658" class="Keyword">open</a> <a id="3663" class="Keyword">import</a> <a id="3670" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="3688" class="Keyword">using</a> <a id="3694" class="Symbol">(</a><a id="3695" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="3698" class="Symbol">;</a> <a id="3700" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="3703" class="Symbol">)</a>
<a id="3705" class="Keyword">open</a> <a id="3710" class="Keyword">import</a> <a id="3717" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="3734" class="Symbol">as</a> <a id="3737" class="Module">String</a> <a id="3744" class="Keyword">using</a> <a id="3750" class="Symbol">(</a><a id="3751" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="3757" class="Symbol">;</a> <a id="3759" href="Data.String.Base.html#5080" class="Function">lines</a><a id="3764" class="Symbol">;</a> <a id="3766" href="Data.String.Base.html#2805" class="Function">unlines</a><a id="3773" class="Symbol">;</a> <a id="3775" href="Data.String.Base.html#2747" class="Function">unwords</a><a id="3782" class="Symbol">;</a> <a id="3784" href="Data.String.Base.html#2592" class="Function">concat</a><a id="3790" class="Symbol">)</a>
<a id="3792" class="Keyword">open</a> <a id="3797" class="Keyword">import</a> <a id="3804" href="Data.String.Properties.html" class="Module">Data.String.Properties</a> <a id="3827" class="Symbol">as</a> <a id="3830" class="Module">String</a> <a id="3837" class="Keyword">using</a> <a id="3843" class="Symbol">(</a><a id="3844" href="Data.String.Properties.html#2717" class="Function Operator">_≟_</a><a id="3847" class="Symbol">)</a>
<a id="3849" class="Keyword">open</a> <a id="3854" class="Keyword">import</a> <a id="3861" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3875" class="Keyword">using</a> <a id="3881" class="Symbol">(</a><a id="3882" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3885" class="Symbol">;</a> <a id="3887" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3891" class="Symbol">;</a> <a id="3893" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3897" class="Symbol">)</a>
<a id="3899" class="Keyword">open</a> <a id="3904" class="Keyword">import</a> <a id="3911" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3926" class="Keyword">using</a> <a id="3932" class="Symbol">(</a><a id="3933" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="3934" class="Symbol">)</a>

<a id="3937" class="Keyword">open</a> <a id="3942" class="Keyword">import</a> <a id="3949" href="Function.Base.html" class="Module">Function.Base</a> <a id="3963" class="Keyword">using</a> <a id="3969" class="Symbol">(</a><a id="3970" href="Function.Base.html#704" class="Function">id</a><a id="3972" class="Symbol">;</a> <a id="3974" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="3977" class="Symbol">;</a> <a id="3979" href="Function.Base.html#4042" class="Function Operator">case_of_</a><a id="3987" class="Symbol">)</a>

<a id="3990" class="Keyword">open</a> <a id="3995" class="Keyword">import</a> <a id="4002" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="4029" class="Keyword">using</a> <a id="4035" class="Symbol">(</a><a id="4036" href="Relation.Nullary.Decidable.Core.html#1551" class="Field">does</a><a id="4040" class="Symbol">)</a>

<a id="4043" class="Keyword">open</a> <a id="4048" class="Keyword">import</a> <a id="4055" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4079" class="Keyword">using</a> <a id="4085" class="Symbol">(</a><a id="4086" href="Agda.Builtin.Coinduction.html#229" class="CoinductiveConstructor Operator">♯_</a><a id="4088" class="Symbol">)</a>
<a id="4090" class="Keyword">open</a> <a id="4095" class="Keyword">import</a> <a id="4102" href="IO.html" class="Module">IO</a>

<a id="4106" class="Keyword">open</a> <a id="4111" class="Keyword">import</a> <a id="4118" href="System.Clock.html" class="Module">System.Clock</a> <a id="4131" class="Symbol">as</a> <a id="4134" class="Module">Clock</a> <a id="4140" class="Keyword">using</a> <a id="4146" class="Symbol">(</a><a id="4147" href="System.Clock.html#2777" class="Function">time′</a><a id="4152" class="Symbol">;</a> <a id="4154" href="System.Clock.html#1932" class="Record">Time</a><a id="4158" class="Symbol">;</a> <a id="4160" href="System.Clock.html#1978" class="Field">seconds</a><a id="4167" class="Symbol">)</a>
<a id="4169" class="Keyword">open</a> <a id="4174" class="Keyword">import</a> <a id="4181" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4201" class="Keyword">open</a> <a id="4206" class="Keyword">import</a> <a id="4213" href="System.Directory.html" class="Module">System.Directory</a> <a id="4230" class="Keyword">using</a> <a id="4236" class="Symbol">(</a><a id="4237" href="System.Directory.html#3068" class="Function">doesFileExist</a><a id="4250" class="Symbol">;</a> <a id="4252" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a><a id="4270" class="Symbol">)</a>
<a id="4272" class="Keyword">open</a> <a id="4277" class="Keyword">import</a> <a id="4284" href="System.Environment.html" class="Module">System.Environment</a> <a id="4303" class="Keyword">using</a> <a id="4309" class="Symbol">(</a><a id="4310" href="System.Environment.html#660" class="Function">getArgs</a><a id="4317" class="Symbol">;</a> <a id="4319" href="System.Environment.html#777" class="Function">lookupEnv</a><a id="4328" class="Symbol">)</a>
<a id="4330" class="Keyword">open</a> <a id="4335" class="Keyword">import</a> <a id="4342" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4354" class="Keyword">open</a> <a id="4359" class="Keyword">import</a> <a id="4366" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4388" class="Keyword">using</a> <a id="4394" class="Symbol">(</a><a id="4395" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a><a id="4405" class="Symbol">)</a>
<a id="4407" class="Keyword">open</a> <a id="4412" class="Keyword">import</a> <a id="4419" href="System.Process.html" class="Module">System.Process</a> <a id="4434" class="Keyword">using</a> <a id="4440" class="Symbol">(</a><a id="4441" href="System.Process.html#655" class="Function">callCommand</a><a id="4452" class="Symbol">;</a> <a id="4454" href="System.Process.html#735" class="Function">system</a><a id="4460" class="Symbol">)</a>

<a id="4463" class="Keyword">record</a> <a id="Options"></a><a id="4470" href="Test.Golden.html#4470" class="Record">Options</a> <a id="4478" class="Symbol">:</a> <a id="4480" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4484" class="Keyword">where</a>
  <a id="4492" class="Keyword">field</a>
    <a id="4502" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4550" href="Test.Golden.html#4550" class="Field">exeUnderTest</a> <a id="4563" class="Symbol">:</a> <a id="4565" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4576" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4623" href="Test.Golden.html#4623" class="Field">onlyNames</a> <a id="4633" class="Symbol">:</a> <a id="4635" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4640" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4651" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4702" href="Test.Golden.html#4702" class="Field">interactive</a> <a id="4714" class="Symbol">:</a> <a id="4716" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4725" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4770" href="Test.Golden.html#4770" class="Field">timing</a> <a id="4777" class="Symbol">:</a> <a id="4779" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4788" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4848" href="Test.Golden.html#4848" class="Field">failureFile</a> <a id="4860" class="Symbol">:</a> <a id="4862" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4868" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4879" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4940" href="Test.Golden.html#4940" class="Field">colour</a> <a id="4947" class="Symbol">:</a> <a id="4949" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="4954" class="Keyword">open</a> <a id="4959" href="Test.Golden.html#4470" class="Module">Options</a>

<a id="initOptions"></a><a id="4968" href="Test.Golden.html#4968" class="Function">initOptions</a> <a id="4980" class="Symbol">:</a> <a id="4982" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="4989" class="Symbol">→</a> <a id="4991" href="Test.Golden.html#4470" class="Record">Options</a>
<a id="4999" href="Test.Golden.html#4968" class="Function">initOptions</a> <a id="5011" href="Test.Golden.html#5011" class="Bound">exe</a> <a id="5015" class="Symbol">=</a> <a id="5017" class="Keyword">record</a>
  <a id="5026" class="Symbol">{</a> <a id="5028" href="Test.Golden.html#4550" class="Field">exeUnderTest</a> <a id="5041" class="Symbol">=</a> <a id="5043" href="Test.Golden.html#5011" class="Bound">exe</a>
  <a id="5049" class="Symbol">;</a> <a id="5051" href="Test.Golden.html#4623" class="Field">onlyNames</a>    <a id="5064" class="Symbol">=</a> <a id="5066" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
  <a id="5071" class="Symbol">;</a> <a id="5073" href="Test.Golden.html#4702" class="Field">interactive</a>  <a id="5086" class="Symbol">=</a> <a id="5088" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5096" class="Symbol">;</a> <a id="5098" href="Test.Golden.html#4770" class="Field">timing</a>       <a id="5111" class="Symbol">=</a> <a id="5113" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5121" class="Symbol">;</a> <a id="5123" href="Test.Golden.html#4848" class="Field">failureFile</a>  <a id="5136" class="Symbol">=</a> <a id="5138" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
  <a id="5148" class="Symbol">;</a> <a id="5150" href="Test.Golden.html#4940" class="Field">colour</a>       <a id="5163" class="Symbol">=</a> <a id="5165" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
  <a id="5172" class="Symbol">}</a>

<a id="usage"></a><a id="5175" href="Test.Golden.html#5175" class="Function">usage</a> <a id="5181" class="Symbol">:</a> <a id="5183" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5190" href="Test.Golden.html#5175" class="Function">usage</a> <a id="5196" class="Symbol">=</a> <a id="5198" href="Data.String.Base.html#2747" class="Function">unwords</a>
  <a id="5208" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5210" class="String">&quot;Usage:&quot;</a>
  <a id="5221" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5223" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5243" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5245" class="String">&quot;[--timing]&quot;</a>
  <a id="5260" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5262" class="String">&quot;[--interactive]&quot;</a>
  <a id="5282" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5284" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5310" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5312" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5335" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5337" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5355" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5357" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5378" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5380" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="5384" class="Keyword">data</a> <a id="Error"></a><a id="5389" href="Test.Golden.html#5389" class="Datatype">Error</a> <a id="5395" class="Symbol">:</a> <a id="5397" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5401" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5409" href="Test.Golden.html#5409" class="InductiveConstructor">MissingExecutable</a> <a id="5427" class="Symbol">:</a> <a id="5429" href="Test.Golden.html#5389" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5437" href="Test.Golden.html#5437" class="InductiveConstructor">InvalidArgument</a> <a id="5453" class="Symbol">:</a> <a id="5455" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5462" class="Symbol">→</a> <a id="5464" href="Test.Golden.html#5389" class="Datatype">Error</a>

<a id="show"></a><a id="5471" href="Test.Golden.html#5471" class="Function">show</a> <a id="5476" class="Symbol">:</a> <a id="5478" href="Test.Golden.html#5389" class="Datatype">Error</a> <a id="5484" class="Symbol">→</a> <a id="5486" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5493" href="Test.Golden.html#5471" class="Function">show</a> <a id="5498" href="Test.Golden.html#5409" class="InductiveConstructor">MissingExecutable</a> <a id="5516" class="Symbol">=</a> <a id="5518" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5557" href="Test.Golden.html#5471" class="Function">show</a> <a id="5562" class="Symbol">(</a><a id="5563" href="Test.Golden.html#5437" class="InductiveConstructor">InvalidArgument</a> <a id="5579" href="Test.Golden.html#5579" class="Bound">arg</a><a id="5582" class="Symbol">)</a> <a id="5584" class="Symbol">=</a> <a id="5586" class="String">&quot;Invalid argument: &quot;</a> <a id="5607" href="Data.String.Base.html#2404" class="Function Operator">String.++</a> <a id="5617" href="Test.Golden.html#5579" class="Bound">arg</a>

<a id="5622" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5658" href="Test.Golden.html#5658" class="Function">options</a> <a id="5666" class="Symbol">:</a> <a id="5668" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5673" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5680" class="Symbol">→</a> <a id="5682" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="5685" class="Symbol">(</a><a id="5686" href="Test.Golden.html#5389" class="Datatype">Error</a> <a id="5692" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5694" href="Test.Golden.html#4470" class="Record">Options</a><a id="5701" class="Symbol">)</a>
<a id="5703" href="Test.Golden.html#5658" class="Function">options</a><a id="5710" class="Symbol">(</a><a id="5711" href="Test.Golden.html#5711" class="Bound">exe</a> <a id="5715" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5717" href="Test.Golden.html#5717" class="Bound">rest</a><a id="5721" class="Symbol">)</a> <a id="5723" class="Symbol">=</a> <a id="5725" href="Test.Golden.html#6526" class="Function">mkOptions</a> <a id="5735" href="Test.Golden.html#5711" class="Bound">exe</a> <a id="5739" href="Test.Golden.html#5717" class="Bound">rest</a> <a id="5744" class="Keyword">where</a>

  <a id="5753" href="Test.Golden.html#5753" class="Function">go</a> <a id="5756" class="Symbol">:</a> <a id="5758" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5763" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5770" class="Symbol">→</a> <a id="5772" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5778" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5785" class="Symbol">→</a> <a id="5787" href="Test.Golden.html#4470" class="Record">Options</a> <a id="5795" class="Symbol">→</a> <a id="5797" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5804" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5806" class="Symbol">(</a><a id="5807" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5813" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5820" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5822" href="Test.Golden.html#4470" class="Record">Options</a><a id="5829" class="Symbol">)</a>
  <a id="5833" href="Test.Golden.html#5753" class="Function">go</a> <a id="5836" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>                             <a id="5867" href="Test.Golden.html#5867" class="Bound">mfp</a> <a id="5871" href="Test.Golden.html#5871" class="Bound">opts</a> <a id="5876" class="Symbol">=</a> <a id="5878" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5883" class="Symbol">(</a><a id="5884" href="Test.Golden.html#5867" class="Bound">mfp</a> <a id="5888" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5890" href="Test.Golden.html#5871" class="Bound">opts</a><a id="5894" class="Symbol">)</a>
  <a id="5898" href="Test.Golden.html#5753" class="Function">go</a> <a id="5901" class="Symbol">(</a><a id="5902" class="String">&quot;--timing&quot;</a>            <a id="5924" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5926" href="Test.Golden.html#5926" class="Bound">args</a><a id="5930" class="Symbol">)</a> <a id="5932" href="Test.Golden.html#5932" class="Bound">mfp</a> <a id="5936" href="Test.Golden.html#5936" class="Bound">opts</a> <a id="5941" class="Symbol">=</a>
    <a id="5947" href="Test.Golden.html#5753" class="Function">go</a> <a id="5950" href="Test.Golden.html#5926" class="Bound">args</a> <a id="5955" href="Test.Golden.html#5932" class="Bound">mfp</a> <a id="5959" class="Symbol">(</a><a id="5960" class="Keyword">record</a> <a id="5967" href="Test.Golden.html#5936" class="Bound">opts</a> <a id="5972" class="Symbol">{</a> <a id="5974" href="Test.Golden.html#4770" class="Field">timing</a> <a id="5981" class="Symbol">=</a> <a id="5983" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="5988" class="Symbol">})</a>
  <a id="5993" href="Test.Golden.html#5753" class="Function">go</a> <a id="5996" class="Symbol">(</a><a id="5997" class="String">&quot;--interactive&quot;</a>       <a id="6019" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6021" href="Test.Golden.html#6021" class="Bound">args</a><a id="6025" class="Symbol">)</a> <a id="6027" href="Test.Golden.html#6027" class="Bound">mfp</a> <a id="6031" href="Test.Golden.html#6031" class="Bound">opts</a> <a id="6036" class="Symbol">=</a>
    <a id="6042" href="Test.Golden.html#5753" class="Function">go</a> <a id="6045" href="Test.Golden.html#6021" class="Bound">args</a> <a id="6050" href="Test.Golden.html#6027" class="Bound">mfp</a> <a id="6054" class="Symbol">(</a><a id="6055" class="Keyword">record</a> <a id="6062" href="Test.Golden.html#6031" class="Bound">opts</a> <a id="6067" class="Symbol">{</a> <a id="6069" href="Test.Golden.html#4702" class="Field">interactive</a> <a id="6081" class="Symbol">=</a> <a id="6083" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="6088" class="Symbol">})</a>
  <a id="6093" href="Test.Golden.html#5753" class="Function">go</a> <a id="6096" class="Symbol">(</a><a id="6097" class="String">&quot;--failure-file&quot;</a> <a id="6114" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6116" href="Test.Golden.html#6116" class="Bound">fp</a> <a id="6119" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6121" href="Test.Golden.html#6121" class="Bound">args</a><a id="6125" class="Symbol">)</a> <a id="6127" href="Test.Golden.html#6127" class="Bound">mfp</a> <a id="6131" href="Test.Golden.html#6131" class="Bound">opts</a> <a id="6136" class="Symbol">=</a>
    <a id="6142" href="Test.Golden.html#5753" class="Function">go</a> <a id="6145" href="Test.Golden.html#6121" class="Bound">args</a> <a id="6150" href="Test.Golden.html#6127" class="Bound">mfp</a> <a id="6154" class="Symbol">(</a><a id="6155" class="Keyword">record</a> <a id="6162" href="Test.Golden.html#6131" class="Bound">opts</a> <a id="6167" class="Symbol">{</a> <a id="6169" href="Test.Golden.html#4848" class="Field">failureFile</a> <a id="6181" class="Symbol">=</a> <a id="6183" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6188" href="Test.Golden.html#6116" class="Bound">fp</a> <a id="6191" class="Symbol">})</a>
  <a id="6196" href="Test.Golden.html#5753" class="Function">go</a> <a id="6199" class="Symbol">(</a><a id="6200" class="String">&quot;--only&quot;</a>              <a id="6222" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6224" href="Test.Golden.html#6224" class="Bound">args</a><a id="6228" class="Symbol">)</a> <a id="6230" href="Test.Golden.html#6230" class="Bound">mfp</a> <a id="6234" href="Test.Golden.html#6234" class="Bound">opts</a> <a id="6239" class="Symbol">=</a>
    <a id="6245" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6250" class="Symbol">(</a><a id="6251" href="Test.Golden.html#6230" class="Bound">mfp</a> <a id="6255" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6257" class="Symbol">(</a><a id="6258" class="Keyword">record</a> <a id="6265" href="Test.Golden.html#6234" class="Bound">opts</a> <a id="6270" class="Symbol">{</a> <a id="6272" href="Test.Golden.html#4623" class="Field">onlyNames</a> <a id="6282" class="Symbol">=</a> <a id="6284" href="Test.Golden.html#6224" class="Bound">args</a> <a id="6289" class="Symbol">}))</a>
  <a id="6295" href="Test.Golden.html#5753" class="Function">go</a> <a id="6298" class="Symbol">(</a><a id="6299" class="String">&quot;--only-file&quot;</a> <a id="6313" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6315" href="Test.Golden.html#6315" class="Bound">fp</a>    <a id="6321" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6323" href="Test.Golden.html#6323" class="Bound">args</a><a id="6327" class="Symbol">)</a> <a id="6329" href="Test.Golden.html#6329" class="Bound">mfp</a> <a id="6333" href="Test.Golden.html#6333" class="Bound">opts</a> <a id="6338" class="Symbol">=</a>
    <a id="6344" href="Test.Golden.html#5753" class="Function">go</a> <a id="6347" href="Test.Golden.html#6323" class="Bound">args</a> <a id="6352" class="Symbol">(</a><a id="6353" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6358" href="Test.Golden.html#6315" class="Bound">fp</a><a id="6360" class="Symbol">)</a> <a id="6362" class="Symbol">(</a><a id="6363" class="Keyword">record</a> <a id="6370" href="Test.Golden.html#6333" class="Bound">opts</a> <a id="6375" class="Symbol">{</a> <a id="6377" href="Test.Golden.html#4623" class="Field">onlyNames</a> <a id="6387" class="Symbol">=</a> <a id="6389" href="Test.Golden.html#6323" class="Bound">args</a> <a id="6394" class="Symbol">})</a>
  <a id="6399" href="Test.Golden.html#5753" class="Function">go</a> <a id="6402" class="Symbol">(</a><a id="6403" class="String">&quot;--no-colour&quot;</a>         <a id="6425" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6427" href="Test.Golden.html#6427" class="Bound">args</a><a id="6431" class="Symbol">)</a> <a id="6433" href="Test.Golden.html#6433" class="Bound">mfp</a> <a id="6437" href="Test.Golden.html#6437" class="Bound">opts</a> <a id="6442" class="Symbol">=</a>
    <a id="6448" href="Test.Golden.html#5753" class="Function">go</a> <a id="6451" href="Test.Golden.html#6427" class="Bound">args</a> <a id="6456" href="Test.Golden.html#6433" class="Bound">mfp</a> <a id="6460" class="Symbol">(</a><a id="6461" class="Keyword">record</a> <a id="6468" href="Test.Golden.html#6437" class="Bound">opts</a> <a id="6473" class="Symbol">{</a> <a id="6475" href="Test.Golden.html#4940" class="Field">colour</a> <a id="6482" class="Symbol">=</a> <a id="6484" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6490" class="Symbol">})</a>
  <a id="6495" href="Test.Golden.html#5753" class="CatchallClause Function">go</a><a id="6497" class="CatchallClause"> </a><a id="6498" class="CatchallClause Symbol">(</a><a id="6499" href="Test.Golden.html#6499" class="CatchallClause Bound">arg</a><a id="6502" class="CatchallClause"> </a><a id="6503" href="Agda.Builtin.List.html#199" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6504" class="CatchallClause"> </a><a id="6505" class="CatchallClause Symbol">_)</a><a id="6507" class="CatchallClause"> </a><a id="6508" class="CatchallClause Symbol">_</a><a id="6509" class="CatchallClause"> </a><a id="6510" class="CatchallClause Symbol">_</a> <a id="6512" class="Symbol">=</a> <a id="6514" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6519" href="Test.Golden.html#6499" class="Bound">arg</a>

  <a id="6526" href="Test.Golden.html#6526" class="Function">mkOptions</a> <a id="6536" class="Symbol">:</a> <a id="6538" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6545" class="Symbol">→</a> <a id="6547" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6552" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6559" class="Symbol">→</a> <a id="6561" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="6564" class="Symbol">(</a><a id="6565" href="Test.Golden.html#5389" class="Datatype">Error</a> <a id="6571" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6573" href="Test.Golden.html#4470" class="Record">Options</a><a id="6580" class="Symbol">)</a>
  <a id="6584" href="Test.Golden.html#6526" class="Function">mkOptions</a> <a id="6594" href="Test.Golden.html#6594" class="Bound">exe</a> <a id="6598" href="Test.Golden.html#6598" class="Bound">rest</a> <a id="6603" class="Symbol">=</a> <a id="6605" class="Keyword">do</a>
    <a id="6612" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6617" class="Symbol">(</a><a id="6618" href="Test.Golden.html#6618" class="Bound">mfp</a> <a id="6622" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6624" href="Test.Golden.html#6624" class="Bound">opts</a><a id="6628" class="Symbol">)</a> <a id="6630" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6632" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6637" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6639" href="Test.Golden.html#5753" class="Function">go</a> <a id="6642" href="Test.Golden.html#6598" class="Bound">rest</a> <a id="6647" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="6655" class="Symbol">(</a><a id="6656" href="Test.Golden.html#4968" class="Function">initOptions</a> <a id="6668" href="Test.Golden.html#6594" class="Bound">exe</a><a id="6671" class="Symbol">)</a>
      <a id="6679" class="Keyword">where</a> <a id="6685" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6690" href="Test.Golden.html#6690" class="Bound">arg</a> <a id="6694" class="Symbol">→</a> <a id="6696" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6701" class="Symbol">(</a><a id="6702" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6707" class="Symbol">(</a><a id="6708" href="Test.Golden.html#5437" class="InductiveConstructor">InvalidArgument</a> <a id="6724" href="Test.Golden.html#6690" class="Bound">arg</a><a id="6727" class="Symbol">))</a>
    <a id="6734" href="Test.Golden.html#6734" class="Bound">term</a> <a id="6739" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6741" href="Data.Maybe.Base.html#1661" class="Function">fromMaybe</a> <a id="6751" class="String">&quot;&quot;</a> <a id="6754" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="6758" href="System.Environment.html#777" class="Function">lookupEnv</a> <a id="6768" class="String">&quot;TERM&quot;</a>
    <a id="6779" class="Keyword">let</a> <a id="6783" href="Test.Golden.html#6783" class="Bound">opts</a> <a id="6788" class="Symbol">=</a> <a id="6790" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="6793" href="Relation.Nullary.Decidable.Core.html#1551" class="Field">does</a> <a id="6798" class="Symbol">(</a><a id="6799" href="Test.Golden.html#6734" class="Bound">term</a> <a id="6804" href="Data.String.Properties.html#2717" class="Function Operator">≟</a> <a id="6806" class="String">&quot;DUMB&quot;</a><a id="6812" class="Symbol">)</a>
               <a id="6829" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="6834" class="Keyword">record</a> <a id="6841" href="Test.Golden.html#6624" class="Bound">opts</a> <a id="6846" class="Symbol">{</a> <a id="6848" href="Test.Golden.html#4940" class="Field">colour</a> <a id="6855" class="Symbol">=</a> <a id="6857" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6863" class="Symbol">}</a>
               <a id="6880" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="6885" href="Test.Golden.html#6624" class="Bound">opts</a>
    <a id="6894" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6899" href="Test.Golden.html#6899" class="Bound">fp</a> <a id="6902" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6904" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6909" href="Test.Golden.html#6618" class="Bound">mfp</a>
      <a id="6919" class="Keyword">where</a> <a id="6925" class="CatchallClause Symbol">_</a> <a id="6927" class="Symbol">→</a> <a id="6929" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6934" class="Symbol">(</a><a id="6935" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6940" href="Test.Golden.html#6783" class="Bound">opts</a><a id="6944" class="Symbol">)</a>
    <a id="6950" href="Test.Golden.html#6950" class="Bound">only</a> <a id="6955" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6957" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="6972" href="Test.Golden.html#6899" class="Bound">fp</a>
    <a id="6979" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6984" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6986" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6991" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6993" class="Keyword">record</a> <a id="7000" href="Test.Golden.html#6783" class="Bound">opts</a> <a id="7005" class="Symbol">{</a> <a id="7007" href="Test.Golden.html#4623" class="Field">onlyNames</a> <a id="7017" class="Symbol">=</a> <a id="7019" href="Data.String.Base.html#5080" class="Function">lines</a> <a id="7025" href="Test.Golden.html#6950" class="Bound">only</a> <a id="7030" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="7033" href="Test.Golden.html#4623" class="Field">onlyNames</a> <a id="7043" href="Test.Golden.html#6783" class="Bound">opts</a> <a id="7048" class="Symbol">}</a>

<a id="7051" href="Test.Golden.html#5658" class="Function">options</a> <a id="7059" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7062" class="Symbol">=</a> <a id="7064" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7069" class="Symbol">(</a><a id="7070" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7075" href="Test.Golden.html#5409" class="InductiveConstructor">MissingExecutable</a><a id="7092" class="Symbol">)</a>


<a id="7096" class="Comment">-- The result of a test run</a>
<a id="7124" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7184" href="Test.Golden.html#7184" class="Function">Result</a> <a id="7191" class="Symbol">:</a> <a id="7193" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="7197" href="Test.Golden.html#7184" class="Function">Result</a> <a id="7204" class="Symbol">=</a> <a id="7206" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7213" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7215" href="Agda.Builtin.String.html#335" class="Postulate">String</a>

<a id="7223" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7283" href="Test.Golden.html#7283" class="Function">runTest</a> <a id="7291" class="Symbol">:</a> <a id="7293" href="Test.Golden.html#4470" class="Record">Options</a> <a id="7301" class="Symbol">→</a> <a id="7303" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7310" class="Symbol">→</a> <a id="7312" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="7315" href="Test.Golden.html#7184" class="Function">Result</a>
<a id="7322" href="Test.Golden.html#7283" class="Function">runTest</a> <a id="7330" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="7335" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="7344" class="Symbol">=</a> <a id="7346" class="Keyword">do</a>

  <a id="7352" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="7357" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7359" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a> <a id="7378" class="Symbol">(</a><a id="7379" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="7390" href="Test.Golden.html#7335" class="Bound">testPath</a><a id="7398" class="Symbol">)</a>
    <a id="7404" class="Keyword">where</a> <a id="7410" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="7416" class="Symbol">→</a> <a id="7418" href="Test.Golden.html#8963" class="Function">fail</a> <a id="7423" href="Test.Golden.html#8584" class="Function">directoryNotFound</a>

  <a id="7444" href="Test.Golden.html#7444" class="Bound">time</a> <a id="7449" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7451" href="System.Clock.html#2777" class="Function">time′</a> <a id="7457" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7459" href="System.Process.html#655" class="Function">callCommand</a> <a id="7471" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7473" href="Data.String.Base.html#2747" class="Function">unwords</a>
           <a id="7492" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7494" class="String">&quot;cd&quot;</a> <a id="7499" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7501" href="Test.Golden.html#7335" class="Bound">testPath</a>
           <a id="7521" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7523" class="String">&quot;&amp;&amp;&quot;</a> <a id="7528" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7530" class="String">&quot;sh ./run&quot;</a> <a id="7541" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7543" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="7548" class="Symbol">.</a><a id="7549" href="Test.Golden.html#4550" class="Field">exeUnderTest</a>
           <a id="7573" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7575" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7611" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7613" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="7619" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7624" href="Test.Golden.html#7624" class="Bound">out</a> <a id="7628" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7630" href="Test.Golden.html#9064" class="Function">readLocalFile</a> <a id="7644" class="String">&quot;output&quot;</a>
    <a id="7657" class="Keyword">where</a> <a id="7663" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7671" class="Symbol">→</a> <a id="7673" href="Test.Golden.html#8963" class="Function">fail</a> <a id="7678" class="Symbol">(</a><a id="7679" href="Test.Golden.html#8763" class="Function">fileNotFound</a> <a id="7692" class="String">&quot;output&quot;</a><a id="7700" class="Symbol">)</a>
  <a id="7704" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7709" href="Test.Golden.html#7709" class="Bound">exp</a> <a id="7713" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7715" href="Test.Golden.html#9064" class="Function">readLocalFile</a> <a id="7729" class="String">&quot;expected&quot;</a>
    <a id="7744" class="Keyword">where</a> <a id="7750" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7758" class="Symbol">→</a> <a id="7760" class="Keyword">do</a> <a id="7763" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="7766" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="7771" class="Symbol">.</a><a id="7772" href="Test.Golden.html#4702" class="Field">interactive</a>
                         <a id="7809" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="7814" href="Test.Golden.html#9831" class="Function">mayOverwrite</a> <a id="7827" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7835" href="Test.Golden.html#7624" class="Bound">out</a>
                         <a id="7864" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="7869" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="7878" class="Symbol">(</a><a id="7879" href="Test.Golden.html#8763" class="Function">fileNotFound</a> <a id="7892" class="String">&quot;expected&quot;</a><a id="7902" class="Symbol">)</a>
                       <a id="7927" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7932" class="Symbol">(</a><a id="7933" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7938" href="Test.Golden.html#7335" class="Bound">testPath</a><a id="7946" class="Symbol">)</a>

  <a id="7951" class="Keyword">let</a> <a id="7955" href="Test.Golden.html#7955" class="Bound">result</a> <a id="7962" class="Symbol">=</a> <a id="7964" href="Relation.Nullary.Decidable.Core.html#1551" class="Field">does</a> <a id="7969" class="Symbol">(</a><a id="7970" href="Test.Golden.html#7624" class="Bound">out</a> <a id="7974" href="Data.String.Properties.html#2717" class="Function Operator">String.≟</a> <a id="7983" href="Test.Golden.html#7709" class="Bound">exp</a><a id="7986" class="Symbol">)</a>

  <a id="7991" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="7994" href="Test.Golden.html#7955" class="Bound">result</a>
    <a id="8005" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8010" href="Test.Golden.html#10647" class="Function">printTiming</a> <a id="8022" class="Symbol">(</a><a id="8023" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="8028" class="Symbol">.</a><a id="8029" href="Test.Golden.html#4770" class="Field">timing</a><a id="8035" class="Symbol">)</a> <a id="8037" href="Test.Golden.html#7444" class="Bound">time</a>
           <a id="8053" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8055" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8058" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="8063" class="Symbol">.</a><a id="8064" href="Test.Golden.html#4940" class="Field">colour</a>
               <a id="8086" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8091" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8103" class="Symbol">(</a><a id="8104" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8114" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8125" href="System.Console.ANSI.html#699" class="InductiveConstructor">classic</a> <a id="8133" href="System.Console.ANSI.html#623" class="InductiveConstructor">green</a><a id="8138" class="Symbol">)</a>
               <a id="8155" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8160" href="Function.Base.html#704" class="Function">id</a>
           <a id="8174" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8176" class="String">&quot;success&quot;</a>
    <a id="8190" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8195" class="Keyword">do</a> <a id="8198" href="Test.Golden.html#10647" class="Function">printTiming</a> <a id="8210" class="Symbol">(</a><a id="8211" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="8216" class="Symbol">.</a><a id="8217" href="Test.Golden.html#4770" class="Field">timing</a><a id="8223" class="Symbol">)</a> <a id="8225" href="Test.Golden.html#7444" class="Bound">time</a>
             <a id="8243" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8245" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8248" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="8253" class="Symbol">.</a><a id="8254" href="Test.Golden.html#4940" class="Field">colour</a>
               <a id="8276" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8281" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8293" class="Symbol">(</a><a id="8294" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8304" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8315" href="System.Console.ANSI.html#707" class="InductiveConstructor">bright</a> <a id="8322" href="System.Console.ANSI.html#619" class="InductiveConstructor">red</a><a id="8325" class="Symbol">)</a>
               <a id="8342" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8347" href="Function.Base.html#704" class="Function">id</a>
             <a id="8363" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8365" class="String">&quot;FAILURE&quot;</a>
            <a id="8387" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8390" href="Test.Golden.html#7330" class="Bound">opts</a> <a id="8395" class="Symbol">.</a><a id="8396" href="Test.Golden.html#4702" class="Field">interactive</a>
              <a id="8422" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8427" href="Test.Golden.html#9831" class="Function">mayOverwrite</a> <a id="8440" class="Symbol">(</a><a id="8441" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8446" href="Test.Golden.html#7709" class="Bound">exp</a><a id="8449" class="Symbol">)</a> <a id="8451" href="Test.Golden.html#7624" class="Bound">out</a>
              <a id="8469" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8474" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8483" class="Symbol">(</a><a id="8484" href="Data.String.Base.html#2805" class="Function">unlines</a> <a id="8492" class="Symbol">(</a><a id="8493" href="Test.Golden.html#9597" class="Function">expVsOut</a> <a id="8502" href="Test.Golden.html#7709" class="Bound">exp</a> <a id="8506" href="Test.Golden.html#7624" class="Bound">out</a><a id="8509" class="Symbol">))</a>

  <a id="8515" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8520" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8522" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8525" href="Test.Golden.html#7955" class="Bound">result</a> <a id="8532" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8537" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8542" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="8551" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8556" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8561" href="Test.Golden.html#7335" class="Bound">testPath</a>

  <a id="8573" class="Keyword">where</a>

    <a id="8584" href="Test.Golden.html#8584" class="Function">directoryNotFound</a> <a id="8602" class="Symbol">:</a> <a id="8604" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8615" href="Test.Golden.html#8584" class="Function">directoryNotFound</a> <a id="8633" class="Symbol">=</a> <a id="8635" href="Data.String.Base.html#2747" class="Function">unwords</a>
                      <a id="8665" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8667" class="String">&quot;Directory&quot;</a>
                      <a id="8701" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8703" href="Test.Golden.html#7335" class="Bound">testPath</a>
                      <a id="8734" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8736" class="String">&quot;does not exist&quot;</a> <a id="8753" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8755" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="8763" href="Test.Golden.html#8763" class="Function">fileNotFound</a> <a id="8776" class="Symbol">:</a> <a id="8778" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="8785" class="Symbol">→</a> <a id="8787" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8798" href="Test.Golden.html#8763" class="Function">fileNotFound</a> <a id="8811" href="Test.Golden.html#8811" class="Bound">name</a> <a id="8816" class="Symbol">=</a> <a id="8818" href="Data.String.Base.html#2747" class="Function">unwords</a>
                      <a id="8848" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8850" class="String">&quot;File&quot;</a>
                      <a id="8879" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8881" class="Symbol">(</a><a id="8882" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="8891" href="Data.String.Base.html#2404" class="Function Operator">String.++</a> <a id="8901" class="String">&quot;/output&quot;</a><a id="8910" class="Symbol">)</a>
                      <a id="8934" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8936" class="String">&quot;does not exist&quot;</a> <a id="8953" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8955" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="8963" href="Test.Golden.html#8963" class="Function">fail</a> <a id="8968" class="Symbol">:</a> <a id="8970" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="8977" class="Symbol">→</a> <a id="8979" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="8982" href="Test.Golden.html#7184" class="Function">Result</a>
    <a id="8993" href="Test.Golden.html#8963" class="Function">fail</a> <a id="8998" href="Test.Golden.html#8998" class="Bound">msg</a> <a id="9002" class="Symbol">=</a> <a id="9004" class="Keyword">do</a> <a id="9007" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9016" href="Test.Golden.html#8998" class="Bound">msg</a>
                  <a id="9038" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9043" class="Symbol">(</a><a id="9044" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="9049" href="Test.Golden.html#7335" class="Bound">testPath</a><a id="9057" class="Symbol">)</a>

    <a id="9064" href="Test.Golden.html#9064" class="Function">readLocalFile</a> <a id="9078" class="Symbol">:</a> <a id="9080" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9087" class="Symbol">→</a> <a id="9089" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9092" class="Symbol">(</a><a id="9093" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9099" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="9105" class="Symbol">)</a>
    <a id="9111" href="Test.Golden.html#9064" class="Function">readLocalFile</a> <a id="9125" href="Test.Golden.html#9125" class="Bound">name</a> <a id="9130" class="Symbol">=</a> <a id="9132" class="Keyword">do</a>
      <a id="9141" class="Keyword">let</a> <a id="9145" href="Test.Golden.html#9145" class="Bound">fp</a> <a id="9148" class="Symbol">=</a> <a id="9150" href="Data.String.Base.html#2592" class="Function">concat</a> <a id="9157" class="Symbol">(</a><a id="9158" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="9167" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9169" class="String">&quot;/&quot;</a> <a id="9173" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9175" href="Test.Golden.html#9125" class="Bound">name</a> <a id="9180" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9182" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="9184" class="Symbol">)</a>
      <a id="9192" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="9197" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9199" href="System.Directory.html#3068" class="Function">doesFileExist</a> <a id="9213" class="Symbol">(</a><a id="9214" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="9225" href="Test.Golden.html#9145" class="Bound">fp</a><a id="9227" class="Symbol">)</a>
        <a id="9237" class="Keyword">where</a> <a id="9243" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9249" class="Symbol">→</a> <a id="9251" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9256" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
      <a id="9270" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9275" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="9279" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="9294" href="Test.Golden.html#9145" class="Bound">fp</a>

    <a id="9302" href="Test.Golden.html#9302" class="Function">getAnswer</a> <a id="9312" class="Symbol">:</a> <a id="9314" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9317" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9326" href="Test.Golden.html#9302" class="Function">getAnswer</a> <a id="9336" class="Symbol">=</a> <a id="9338" href="IO.Base.html#3674" class="Function">untilJust</a> <a id="9348" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9350" class="Keyword">do</a>
      <a id="9359" href="Test.Golden.html#9359" class="Bound">str</a> <a id="9363" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9365" href="IO.Finite.html#1045" class="Function">getLine</a>
      <a id="9379" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="9384" href="Test.Golden.html#9359" class="Bound">str</a> <a id="9388" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="9391" class="Symbol">λ</a> <a id="9393" class="Keyword">where</a>
        <a id="9407" class="String">&quot;y&quot;</a> <a id="9411" class="Symbol">→</a> <a id="9413" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9418" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9420" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9425" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
        <a id="9438" class="String">&quot;n&quot;</a> <a id="9442" class="Symbol">→</a> <a id="9444" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9449" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9451" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9456" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
        <a id="9470" class="String">&quot;&quot;</a>  <a id="9474" class="Symbol">→</a> <a id="9476" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9481" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9483" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9488" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9494" class="Comment">-- default answer is no</a>
        <a id="9526" class="Symbol">_</a>   <a id="9530" class="Symbol">→</a> <a id="9532" class="Keyword">do</a> <a id="9535" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9544" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9579" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9584" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

    <a id="9597" href="Test.Golden.html#9597" class="Function">expVsOut</a> <a id="9606" class="Symbol">:</a> <a id="9608" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9615" class="Symbol">→</a> <a id="9617" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9624" class="Symbol">→</a> <a id="9626" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9631" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="9642" href="Test.Golden.html#9597" class="Function">expVsOut</a> <a id="9651" href="Test.Golden.html#9651" class="Bound">exp</a> <a id="9655" href="Test.Golden.html#9655" class="Bound">out</a> <a id="9659" class="Symbol">=</a> <a id="9661" class="String">&quot;Expected:&quot;</a> <a id="9673" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9675" href="Test.Golden.html#9651" class="Bound">exp</a> <a id="9679" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9681" class="String">&quot;Given:&quot;</a> <a id="9690" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9692" href="Test.Golden.html#9655" class="Bound">out</a> <a id="9696" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9698" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="9706" href="Test.Golden.html#9706" class="Function">hasFailed</a> <a id="9716" class="Symbol">:</a> <a id="9718" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9727" class="Symbol">→</a> <a id="9729" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9738" href="Test.Golden.html#9706" class="Function">hasFailed</a> <a id="9748" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9767" class="Symbol">=</a> <a id="9769" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
    <a id="9779" href="Test.Golden.html#9706" class="Function">hasFailed</a> <a id="9789" class="Symbol">(</a><a id="9790" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9802" href="Test.Golden.html#9802" class="Bound">code</a><a id="9806" class="Symbol">)</a> <a id="9808" class="Symbol">=</a> <a id="9810" href="Test.Golden.html#9802" class="Bound">code</a> <a id="9815" href="Data.Integer.Base.html#2628" class="Function Operator">ℤ.≤ᵇ</a> <a id="9820" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="9824" class="Number">0</a>

    <a id="9831" href="Test.Golden.html#9831" class="Function">mayOverwrite</a> <a id="9844" class="Symbol">:</a> <a id="9846" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9852" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9859" class="Symbol">→</a> <a id="9861" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9868" class="Symbol">→</a> <a id="9870" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9873" class="Symbol">_</a>
    <a id="9879" href="Test.Golden.html#9831" class="Function">mayOverwrite</a> <a id="9892" href="Test.Golden.html#9892" class="Bound">mexp</a> <a id="9897" href="Test.Golden.html#9897" class="Bound">out</a> <a id="9901" class="Symbol">=</a> <a id="9903" class="Keyword">do</a>
      <a id="9912" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="9917" href="Test.Golden.html#9892" class="Bound">mexp</a> <a id="9922" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="9925" class="Symbol">λ</a> <a id="9927" class="Keyword">where</a>
        <a id="9941" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9949" class="Symbol">→</a> <a id="9951" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9960" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9962" href="Data.String.Base.html#2805" class="Function">unlines</a>
          <a id="9980" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9982" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="10049" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10051" href="Test.Golden.html#9897" class="Bound">out</a>
          <a id="10065" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10067" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10110" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10112" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
        <a id="10123" class="Symbol">(</a><a id="10124" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="10129" href="Test.Golden.html#10129" class="Bound">exp</a><a id="10132" class="Symbol">)</a> <a id="10134" class="Symbol">→</a> <a id="10136" class="Keyword">do</a>
          <a id="10149" href="Test.Golden.html#10149" class="Bound">code</a> <a id="10154" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10156" href="System.Process.html#735" class="Function">system</a> <a id="10163" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10165" href="Data.String.Base.html#2592" class="Function">concat</a>
            <a id="10184" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10186" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10251" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10253" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="10262" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10264" class="String">&quot;/expected &quot;</a>
            <a id="10289" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10291" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="10300" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10302" class="String">&quot;/output&quot;</a>
            <a id="10324" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10326" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
          <a id="10339" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10348" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10350" href="Data.String.Base.html#2805" class="Function">unlines</a>
            <a id="10370" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10372" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10426" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10428" class="Symbol">(</a><a id="10429" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="10432" href="Test.Golden.html#9706" class="Function">hasFailed</a> <a id="10442" href="Test.Golden.html#10149" class="Bound">code</a> <a id="10447" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="10452" href="Test.Golden.html#9597" class="Function">expVsOut</a> <a id="10461" href="Test.Golden.html#10129" class="Bound">exp</a> <a id="10465" href="Test.Golden.html#9897" class="Bound">out</a> <a id="10469" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="10474" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10476" class="Symbol">)</a>
            <a id="10490" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="10493" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10554" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10556" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="10566" href="Test.Golden.html#10566" class="Bound">b</a> <a id="10568" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10570" href="Test.Golden.html#9302" class="Function">getAnswer</a>
      <a id="10586" href="IO.Base.html#3334" class="Function">when</a> <a id="10591" href="Test.Golden.html#10566" class="Bound">b</a> <a id="10593" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10595" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="10605" class="Symbol">(</a><a id="10606" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="10615" href="Data.String.Base.html#2404" class="Function Operator">String.++</a> <a id="10625" class="String">&quot;/expected&quot;</a><a id="10636" class="Symbol">)</a> <a id="10638" href="Test.Golden.html#9897" class="Bound">out</a>

    <a id="10647" href="Test.Golden.html#10647" class="Function">printTiming</a> <a id="10659" class="Symbol">:</a> <a id="10661" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="10666" class="Symbol">→</a> <a id="10668" href="System.Clock.html#1932" class="Record">Time</a> <a id="10673" class="Symbol">→</a> <a id="10675" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="10682" class="Symbol">→</a> <a id="10684" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="10687" class="Symbol">_</a>
    <a id="10693" href="Test.Golden.html#10647" class="Function">printTiming</a> <a id="10705" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="10711" class="Symbol">_</a>    <a id="10716" href="Test.Golden.html#10716" class="Bound">msg</a> <a id="10720" class="Symbol">=</a> <a id="10722" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10731" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10733" href="Data.String.Base.html#2592" class="Function">concat</a> <a id="10740" class="Symbol">(</a><a id="10741" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="10750" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10752" class="String">&quot;: &quot;</a> <a id="10757" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10759" href="Test.Golden.html#10716" class="Bound">msg</a> <a id="10763" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10765" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10767" class="Symbol">)</a>
    <a id="10773" href="Test.Golden.html#10647" class="Function">printTiming</a> <a id="10785" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>  <a id="10791" href="Test.Golden.html#10791" class="Bound">time</a> <a id="10796" href="Test.Golden.html#10796" class="Bound">msg</a> <a id="10800" class="Symbol">=</a>
      <a id="10808" class="Keyword">let</a> <a id="10812" href="Test.Golden.html#10812" class="Bound">time</a>  <a id="10818" class="Symbol">=</a> <a id="10820" href="Data.Nat.Show.html#1962" class="Function">ℕ.show</a> <a id="10827" class="Symbol">(</a><a id="10828" href="Test.Golden.html#10791" class="Bound">time</a> <a id="10833" class="Symbol">.</a><a id="10834" href="System.Clock.html#1978" class="Field">seconds</a><a id="10841" class="Symbol">)</a> <a id="10843" href="Data.String.Base.html#2404" class="Function Operator">String.++</a> <a id="10853" class="String">&quot;s&quot;</a>
          <a id="10867" href="Test.Golden.html#10867" class="Bound">spent</a> <a id="10873" class="Symbol">=</a> <a id="10875" class="Number">9</a> <a id="10877" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="10879" href="Data.List.Base.html#5003" class="Function">List.sum</a> <a id="10888" class="Symbol">(</a><a id="10889" href="Data.List.Base.html#1631" class="Function">List.map</a> <a id="10898" href="Data.String.Base.html#2468" class="Function">String.length</a> <a id="10912" class="Symbol">(</a><a id="10913" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="10922" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10924" href="Test.Golden.html#10812" class="Bound">time</a> <a id="10929" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10931" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10933" class="Symbol">))</a>
               <a id="10951" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="11027" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11110" href="Test.Golden.html#11110" class="Bound">pad</a>   <a id="11116" class="Symbol">=</a> <a id="11118" href="Data.String.Base.html#2519" class="Function">String.replicate</a> <a id="11135" class="Symbol">(</a><a id="11136" class="Number">72</a> <a id="11139" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="11141" href="Test.Golden.html#10867" class="Bound">spent</a><a id="11146" class="Symbol">)</a> <a id="11148" class="String">&#39; &#39;</a>
      <a id="11158" class="Keyword">in</a> <a id="11161" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="11170" class="Symbol">(</a><a id="11171" href="Data.String.Base.html#2592" class="Function">concat</a> <a id="11178" class="Symbol">(</a><a id="11179" href="Test.Golden.html#7335" class="Bound">testPath</a> <a id="11188" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11190" class="String">&quot;: &quot;</a> <a id="11195" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11197" href="Test.Golden.html#10796" class="Bound">msg</a> <a id="11201" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11203" href="Test.Golden.html#11110" class="Bound">pad</a> <a id="11207" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11209" href="Test.Golden.html#10812" class="Bound">time</a> <a id="11214" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11216" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="11218" class="Symbol">))</a>

<a id="11222" class="Comment">-- A test pool is characterised by</a>
<a id="11257" class="Comment">--  + a name</a>
<a id="11270" class="Comment">--  + and a list of directory paths</a>
<a id="11306" class="Keyword">record</a> <a id="TestPool"></a><a id="11313" href="Test.Golden.html#11313" class="Record">TestPool</a> <a id="11322" class="Symbol">:</a> <a id="11324" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11328" class="Keyword">where</a>
  <a id="11336" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11348" href="Test.Golden.html#11348" class="InductiveConstructor">mkTestPool</a>
  <a id="11361" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11371" href="Test.Golden.html#11371" class="Field">poolName</a> <a id="11380" class="Symbol">:</a> <a id="11382" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11393" href="Test.Golden.html#11393" class="Field">testCases</a> <a id="11403" class="Symbol">:</a> <a id="11405" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11410" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="11417" class="Keyword">open</a> <a id="11422" href="Test.Golden.html#11313" class="Module">TestPool</a>

<a id="11432" class="Keyword">module</a> <a id="Summary"></a><a id="11439" href="Test.Golden.html#11439" class="Module">Summary</a> <a id="11447" class="Keyword">where</a>

  <a id="11456" class="Comment">-- The summary of a test pool run</a>
  <a id="11492" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11499" href="Test.Golden.html#11499" class="Record">Summary</a> <a id="11507" class="Symbol">:</a> <a id="11509" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11513" class="Keyword">where</a>
    <a id="11523" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11535" href="Test.Golden.html#11535" class="InductiveConstructor">mkSummary</a>
    <a id="11549" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11561" href="Test.Golden.html#11561" class="Field">success</a> <a id="11569" class="Symbol">:</a> <a id="11571" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11576" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11589" href="Test.Golden.html#11589" class="Field">failure</a> <a id="11597" class="Symbol">:</a> <a id="11599" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11604" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="11613" class="Keyword">open</a> <a id="11618" href="Test.Golden.html#11499" class="Module">Summary</a> <a id="11626" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11636" href="Test.Golden.html#11636" class="Function">init</a> <a id="11641" class="Symbol">:</a> <a id="11643" href="Test.Golden.html#11499" class="Record">Summary</a>
  <a id="11653" href="Test.Golden.html#11636" class="Function">init</a> <a id="11658" class="Symbol">=</a> <a id="11660" href="Test.Golden.html#11535" class="InductiveConstructor">mkSummary</a> <a id="11670" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="11673" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11679" href="Test.Golden.html#11679" class="Function">merge</a> <a id="11685" class="Symbol">:</a> <a id="11687" href="Test.Golden.html#11499" class="Record">Summary</a> <a id="11695" class="Symbol">→</a> <a id="11697" href="Test.Golden.html#11499" class="Record">Summary</a> <a id="11705" class="Symbol">→</a> <a id="11707" href="Test.Golden.html#11499" class="Record">Summary</a>
  <a id="11717" href="Test.Golden.html#11679" class="Function">merge</a> <a id="11723" class="Symbol">(</a><a id="11724" href="Test.Golden.html#11535" class="InductiveConstructor">mkSummary</a> <a id="11734" href="Test.Golden.html#11734" class="Bound">ws1</a> <a id="11738" href="Test.Golden.html#11738" class="Bound">ls1</a><a id="11741" class="Symbol">)</a> <a id="11743" class="Symbol">(</a><a id="11744" href="Test.Golden.html#11535" class="InductiveConstructor">mkSummary</a> <a id="11754" href="Test.Golden.html#11754" class="Bound">ws2</a> <a id="11758" href="Test.Golden.html#11758" class="Bound">ls2</a><a id="11761" class="Symbol">)</a> <a id="11763" class="Symbol">=</a>
   <a id="11768" href="Test.Golden.html#11535" class="InductiveConstructor">mkSummary</a> <a id="11778" class="Symbol">(</a><a id="11779" href="Test.Golden.html#11754" class="Bound">ws2</a> <a id="11783" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="11786" href="Test.Golden.html#11734" class="Bound">ws1</a><a id="11789" class="Symbol">)</a> <a id="11791" class="Symbol">(</a><a id="11792" href="Test.Golden.html#11758" class="Bound">ls2</a> <a id="11796" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="11799" href="Test.Golden.html#11738" class="Bound">ls1</a><a id="11802" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11807" href="Test.Golden.html#11807" class="Function">update</a> <a id="11814" class="Symbol">:</a> <a id="11816" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11821" href="Test.Golden.html#7184" class="Function">Result</a> <a id="11828" class="Symbol">→</a> <a id="11830" href="Test.Golden.html#11499" class="Record">Summary</a> <a id="11838" class="Symbol">→</a> <a id="11840" href="Test.Golden.html#11499" class="Record">Summary</a>
  <a id="11850" href="Test.Golden.html#11807" class="Function">update</a> <a id="11857" href="Test.Golden.html#11857" class="Bound">res</a> <a id="11861" href="Test.Golden.html#11861" class="Bound">sum</a> <a id="11865" class="Symbol">=</a>
    <a id="11871" class="Keyword">let</a> <a id="11875" class="Symbol">(</a><a id="11876" href="Test.Golden.html#11876" class="Bound">ls2</a> <a id="11880" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11882" href="Test.Golden.html#11882" class="Bound">ws2</a><a id="11885" class="Symbol">)</a> <a id="11887" class="Symbol">=</a> <a id="11889" href="Data.List.Base.html#3904" class="Function">partitionSums</a> <a id="11903" href="Test.Golden.html#11857" class="Bound">res</a> <a id="11907" class="Keyword">in</a>
    <a id="11914" href="Test.Golden.html#11679" class="Function">merge</a> <a id="11920" href="Test.Golden.html#11861" class="Bound">sum</a> <a id="11924" class="Symbol">(</a><a id="11925" href="Test.Golden.html#11535" class="InductiveConstructor">mkSummary</a> <a id="11935" href="Test.Golden.html#11882" class="Bound">ws2</a> <a id="11939" href="Test.Golden.html#11876" class="Bound">ls2</a><a id="11942" class="Symbol">)</a>

<a id="11945" class="Keyword">open</a> <a id="11950" href="Test.Golden.html#11439" class="Module">Summary</a> <a id="11958" class="Keyword">using</a> <a id="11964" class="Symbol">(</a><a id="11965" href="Test.Golden.html#11499" class="Record">Summary</a><a id="11972" class="Symbol">)</a> <a id="11974" class="Keyword">hiding</a> <a id="11981" class="Symbol">(</a><a id="11982" class="Keyword">module</a> <a id="11989" href="Test.Golden.html#11499" class="Module">Summary</a><a id="11996" class="Symbol">)</a>

<a id="11999" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="12047" href="Test.Golden.html#12047" class="Function">filterTests</a> <a id="12059" class="Symbol">:</a> <a id="12061" href="Test.Golden.html#4470" class="Record">Options</a> <a id="12069" class="Symbol">→</a> <a id="12071" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12076" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12083" class="Symbol">→</a> <a id="12085" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12090" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="12097" href="Test.Golden.html#12047" class="Function">filterTests</a> <a id="12109" href="Test.Golden.html#12109" class="Bound">opts</a> <a id="12114" class="Symbol">=</a> <a id="12116" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="12121" href="Test.Golden.html#4623" class="Field">onlyNames</a> <a id="12131" href="Test.Golden.html#12109" class="Bound">opts</a> <a id="12136" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="12139" class="Symbol">λ</a> <a id="12141" class="Keyword">where</a>
  <a id="12149" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12152" class="Symbol">→</a> <a id="12154" href="Function.Base.html#704" class="Function">id</a>
  <a id="12159" href="Test.Golden.html#12159" class="CatchallClause Bound">xs</a> <a id="12162" class="Symbol">→</a> <a id="12164" class="Keyword">let</a> <a id="12168" href="Test.Golden.html#12168" class="Bound">names</a> <a id="12174" class="Symbol">=</a> <a id="12176" href="Data.List.Base.html#1631" class="Function">List.map</a> <a id="12185" href="Data.String.Base.html#1537" class="Primitive">String.toList</a> <a id="12199" href="Test.Golden.html#12159" class="Bound">xs</a> <a id="12202" class="Keyword">in</a>
       <a id="12212" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="12219" class="Symbol">(λ</a> <a id="12222" href="Test.Golden.html#12222" class="Bound">n</a> <a id="12224" class="Symbol">→</a> <a id="12226" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="12231" class="Symbol">(λ</a> <a id="12234" href="Test.Golden.html#12234" class="Bound">m</a> <a id="12236" class="Symbol">→</a> <a id="12238" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6720" class="Function">infix?</a> <a id="12245" href="Data.Char.Properties.html#2071" class="Function Operator">Char._≟_</a> <a id="12254" href="Test.Golden.html#12234" class="Bound">m</a> <a id="12256" class="Symbol">(</a><a id="12257" href="Data.String.Base.html#1537" class="Primitive">String.toList</a> <a id="12271" href="Test.Golden.html#12222" class="Bound">n</a><a id="12272" class="Symbol">))</a> <a id="12275" href="Test.Golden.html#12168" class="Bound">names</a><a id="12280" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12283" href="Test.Golden.html#12283" class="Function">poolRunner</a> <a id="12294" class="Symbol">:</a> <a id="12296" href="Test.Golden.html#4470" class="Record">Options</a> <a id="12304" class="Symbol">→</a> <a id="12306" href="Test.Golden.html#11313" class="Record">TestPool</a> <a id="12315" class="Symbol">→</a> <a id="12317" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12320" href="Test.Golden.html#11499" class="Record">Summary</a>
<a id="12328" href="Test.Golden.html#12283" class="Function">poolRunner</a> <a id="12339" href="Test.Golden.html#12339" class="Bound">opts</a> <a id="12344" href="Test.Golden.html#12344" class="Bound">pool</a> <a id="12349" class="Symbol">=</a> <a id="12351" class="Keyword">do</a>
  <a id="12356" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12417" class="Keyword">let</a> <a id="12421" href="Test.Golden.html#12421" class="Bound">tests</a> <a id="12427" class="Symbol">=</a> <a id="12429" href="Test.Golden.html#12047" class="Function">filterTests</a> <a id="12441" href="Test.Golden.html#12339" class="Bound">opts</a> <a id="12446" class="Symbol">(</a><a id="12447" href="Test.Golden.html#12344" class="Bound">pool</a> <a id="12452" class="Symbol">.</a><a id="12453" href="Test.Golden.html#11393" class="Field">testCases</a><a id="12462" class="Symbol">)</a>
  <a id="12466" class="Symbol">(_</a> <a id="12469" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12471" class="Symbol">_)</a> <a id="12474" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="12476" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12481" href="Test.Golden.html#12421" class="Bound">tests</a>
    <a id="12491" class="Keyword">where</a> <a id="12497" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12500" class="Symbol">→</a> <a id="12502" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12507" href="Test.Golden.html#11636" class="Function">Summary.init</a>

  <a id="12523" class="Comment">-- announce the test pool and run them</a>
  <a id="12564" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="12573" href="Test.Golden.html#12678" class="Function">banner</a>
  <a id="12582" href="Test.Golden.html#12808" class="Function">loop</a> <a id="12587" href="Test.Golden.html#11636" class="Function">Summary.init</a> <a id="12600" href="Test.Golden.html#12421" class="Bound">tests</a>

  <a id="12609" class="Keyword">where</a>

  <a id="12618" href="Test.Golden.html#12618" class="Function">separator</a> <a id="12628" class="Symbol">:</a> <a id="12630" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12639" href="Test.Golden.html#12618" class="Function">separator</a> <a id="12649" class="Symbol">=</a> <a id="12651" href="Data.String.Base.html#2519" class="Function">String.replicate</a> <a id="12668" class="Number">72</a> <a id="12671" class="String">&#39;-&#39;</a>

  <a id="12678" href="Test.Golden.html#12678" class="Function">banner</a> <a id="12685" class="Symbol">:</a> <a id="12687" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12696" href="Test.Golden.html#12678" class="Function">banner</a> <a id="12703" class="Symbol">=</a> <a id="12705" href="Data.String.Base.html#2805" class="Function">unlines</a>
         <a id="12722" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="12724" class="String">&quot;&quot;</a> <a id="12727" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12729" href="Test.Golden.html#12618" class="Function">separator</a>
         <a id="12748" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12750" href="Test.Golden.html#12344" class="Bound">pool</a> <a id="12755" class="Symbol">.</a><a id="12756" href="Test.Golden.html#11371" class="Field">poolName</a>
         <a id="12774" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12776" href="Test.Golden.html#12618" class="Function">separator</a> <a id="12786" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12788" class="String">&quot;&quot;</a>
         <a id="12800" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12802" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="12808" href="Test.Golden.html#12808" class="Function">loop</a> <a id="12813" class="Symbol">:</a> <a id="12815" href="Test.Golden.html#11499" class="Record">Summary</a> <a id="12823" class="Symbol">→</a> <a id="12825" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12830" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12837" class="Symbol">→</a> <a id="12839" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12842" href="Test.Golden.html#11499" class="Record">Summary</a>
  <a id="12852" href="Test.Golden.html#12808" class="Function">loop</a> <a id="12857" href="Test.Golden.html#12857" class="Bound">acc</a> <a id="12861" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12864" class="Symbol">=</a> <a id="12866" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12871" href="Test.Golden.html#12857" class="Bound">acc</a>
  <a id="12877" href="Test.Golden.html#12808" class="Function">loop</a> <a id="12882" href="Test.Golden.html#12882" class="Bound">acc</a> <a id="12886" class="Symbol">(</a><a id="12887" href="Test.Golden.html#12887" class="Bound">test</a> <a id="12892" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12894" href="Test.Golden.html#12894" class="Bound">tests</a><a id="12899" class="Symbol">)</a> <a id="12901" class="Symbol">=</a> <a id="12903" class="Keyword">do</a>
    <a id="12910" href="Test.Golden.html#12910" class="Bound">res</a> <a id="12914" href="IO.Base.html#2084" class="Function Operator">&lt;-</a> <a id="12917" href="Test.Golden.html#7283" class="Function">runTest</a> <a id="12925" href="Test.Golden.html#12339" class="Bound">opts</a> <a id="12930" href="Test.Golden.html#12887" class="Bound">test</a>
    <a id="12939" href="Test.Golden.html#12808" class="Function">loop</a> <a id="12944" class="Symbol">(</a><a id="12945" href="Test.Golden.html#11807" class="Function">Summary.update</a> <a id="12960" class="Symbol">(</a><a id="12961" href="Test.Golden.html#12910" class="Bound">res</a> <a id="12965" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12967" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="12969" class="Symbol">)</a> <a id="12971" href="Test.Golden.html#12882" class="Bound">acc</a><a id="12974" class="Symbol">)</a> <a id="12976" href="Test.Golden.html#12894" class="Bound">tests</a>

<a id="runner"></a><a id="12983" href="Test.Golden.html#12983" class="Function">runner</a> <a id="12990" class="Symbol">:</a> <a id="12992" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12997" href="Test.Golden.html#11313" class="Record">TestPool</a> <a id="13006" class="Symbol">→</a> <a id="13008" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="13011" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="13013" href="Test.Golden.html#12983" class="Function">runner</a> <a id="13020" href="Test.Golden.html#13020" class="Bound">tests</a> <a id="13026" class="Symbol">=</a> <a id="13028" class="Keyword">do</a>
  <a id="13033" class="Comment">-- figure out the options</a>
  <a id="13061" href="Test.Golden.html#13061" class="Bound">args</a> <a id="13066" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13068" href="System.Environment.html#660" class="Function">getArgs</a>
  <a id="13078" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13083" href="Test.Golden.html#13083" class="Bound">opts</a> <a id="13088" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13090" href="Test.Golden.html#5658" class="Function">options</a> <a id="13098" href="Test.Golden.html#13061" class="Bound">args</a>
    <a id="13107" class="Keyword">where</a> <a id="13113" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13118" href="Test.Golden.html#13118" class="Bound">err</a> <a id="13122" class="Symbol">→</a> <a id="13124" href="System.Exit.html#1366" class="Function">die</a> <a id="13128" class="Symbol">(</a><a id="13129" href="Data.String.Base.html#2805" class="Function">unlines</a> <a id="13137" class="Symbol">(</a><a id="13138" href="Test.Golden.html#5471" class="Function">show</a> <a id="13143" href="Test.Golden.html#13118" class="Bound">err</a> <a id="13147" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13149" href="Test.Golden.html#5175" class="Function">usage</a> <a id="13155" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13157" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="13159" class="Symbol">))</a>

  <a id="13165" class="Comment">-- run the tests</a>
  <a id="13184" href="Test.Golden.html#13184" class="Bound">ress</a> <a id="13189" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13191" href="IO.html#2045" class="Function">List.mapM</a> <a id="13201" class="Symbol">(</a><a id="13202" href="Test.Golden.html#12283" class="Function">poolRunner</a> <a id="13213" href="Test.Golden.html#13083" class="Bound">opts</a><a id="13217" class="Symbol">)</a> <a id="13219" href="Test.Golden.html#13020" class="Bound">tests</a>
  <a id="13227" class="Keyword">let</a> <a id="13231" class="Keyword">open</a> <a id="13236" href="Test.Golden.html#11439" class="Module">Summary</a>
  <a id="13246" class="Keyword">let</a> <a id="13250" href="Test.Golden.html#13250" class="Bound">res</a> <a id="13254" class="Symbol">=</a> <a id="13256" href="Data.List.Base.html#4437" class="Function">List.foldl</a> <a id="13267" href="Test.Golden.html#11679" class="Function">merge</a> <a id="13273" href="Test.Golden.html#11636" class="Function">init</a> <a id="13278" href="Test.Golden.html#13184" class="Bound">ress</a>

  <a id="13286" class="Comment">-- report the result</a>
  <a id="13309" class="Keyword">let</a> <a id="13313" href="Test.Golden.html#13313" class="Bound">nsucc</a> <a id="13319" class="Symbol">=</a> <a id="13321" href="Data.List.Base.html#5083" class="Function">List.length</a> <a id="13333" class="Symbol">(</a><a id="13334" href="Test.Golden.html#13250" class="Bound">res</a> <a id="13338" class="Symbol">.</a><a id="13339" href="Test.Golden.html#11561" class="Field">success</a><a id="13346" class="Symbol">)</a>
  <a id="13350" class="Keyword">let</a> <a id="13354" href="Test.Golden.html#13354" class="Bound">nfail</a> <a id="13360" class="Symbol">=</a> <a id="13362" href="Data.List.Base.html#5083" class="Function">List.length</a> <a id="13374" class="Symbol">(</a><a id="13375" href="Test.Golden.html#13250" class="Bound">res</a> <a id="13379" class="Symbol">.</a><a id="13380" href="Test.Golden.html#11589" class="Field">failure</a><a id="13387" class="Symbol">)</a>
  <a id="13391" class="Keyword">let</a> <a id="13395" href="Test.Golden.html#13395" class="Bound">ntotal</a> <a id="13402" class="Symbol">=</a> <a id="13404" href="Test.Golden.html#13313" class="Bound">nsucc</a> <a id="13410" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="13412" href="Test.Golden.html#13354" class="Bound">nfail</a>
  <a id="13420" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13429" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13431" href="Data.String.Base.html#2592" class="Function">concat</a> <a id="13438" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13440" href="Data.Nat.Show.html#1962" class="Function">ℕ.show</a> <a id="13447" href="Test.Golden.html#13313" class="Bound">nsucc</a> <a id="13453" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13455" class="String">&quot;/&quot;</a> <a id="13459" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13461" href="Data.Nat.Show.html#1962" class="Function">ℕ.show</a> <a id="13468" href="Test.Golden.html#13395" class="Bound">ntotal</a> <a id="13475" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13477" class="String">&quot; tests successful&quot;</a> <a id="13497" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13499" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="13505" class="Comment">-- deal with failures</a>
  <a id="13529" class="Keyword">let</a> <a id="13533" href="Test.Golden.html#13533" class="Bound">list</a> <a id="13538" class="Symbol">=</a> <a id="13540" href="Data.String.Base.html#2805" class="Function">unlines</a> <a id="13548" class="Symbol">(</a><a id="13549" href="Test.Golden.html#13250" class="Bound">res</a> <a id="13553" class="Symbol">.</a><a id="13554" href="Test.Golden.html#11589" class="Field">failure</a><a id="13561" class="Symbol">)</a>
  <a id="13565" href="IO.Base.html#3334" class="Function">when</a> <a id="13570" class="Symbol">(</a><a id="13571" class="Number">0</a> <a id="13573" href="Data.Nat.Base.html#1457" class="Primitive Operator">&lt;ᵇ</a> <a id="13576" href="Test.Golden.html#13354" class="Bound">nfail</a><a id="13581" class="Symbol">)</a> <a id="13583" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13585" class="Keyword">do</a>
    <a id="13592" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13601" class="String">&quot;Failing tests:&quot;</a>
    <a id="13622" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13631" href="Test.Golden.html#13533" class="Bound">list</a>
  <a id="13638" href="IO.Base.html#3457" class="Function">whenJust</a> <a id="13647" class="Symbol">(</a><a id="13648" href="Test.Golden.html#13083" class="Bound">opts</a> <a id="13653" class="Symbol">.</a><a id="13654" href="Test.Golden.html#4848" class="Field">failureFile</a><a id="13665" class="Symbol">)</a> <a id="13667" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13669" class="Symbol">λ</a> <a id="13671" href="Test.Golden.html#13671" class="Bound">fp</a> <a id="13674" class="Symbol">→</a> <a id="13676" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="13686" href="Test.Golden.html#13671" class="Bound">fp</a> <a id="13689" href="Test.Golden.html#13533" class="Bound">list</a>

  <a id="13697" class="Comment">-- exit</a>
  <a id="13707" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="13710" class="Number">0</a> <a id="13712" href="Data.Nat.Base.html#1283" class="Primitive Operator">≡ᵇ</a> <a id="13715" href="Test.Golden.html#13354" class="Bound">nfail</a>
   <a id="13724" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="13729" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13744" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="13749" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>