<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Format.Generic</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Format strings for Printf and Scanf</a>
<a id="145" class="Comment">------------------------------------------------------------------------</a>

<a id="219" class="Symbol">{-#</a> <a id="223" class="Keyword">OPTIONS</a> <a id="231" class="Pragma">--cubical-compatible</a> <a id="252" class="Pragma">--safe</a> <a id="259" class="Symbol">#-}</a>

<a id="264" class="Keyword">open</a> <a id="269" class="Keyword">import</a> <a id="276" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="291" class="Keyword">using</a> <a id="297" class="Symbol">(</a><a id="298" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a><a id="302" class="Symbol">)</a>
<a id="304" class="Keyword">open</a> <a id="309" class="Keyword">import</a> <a id="316" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="332" class="Keyword">using</a> <a id="338" class="Symbol">(</a><a id="339" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a><a id="344" class="Symbol">)</a>

<a id="347" class="Keyword">module</a> <a id="354" href="Text.Format.Generic.html" class="Module">Text.Format.Generic</a> <a id="374" class="Keyword">where</a>

<a id="381" class="Keyword">open</a> <a id="386" class="Keyword">import</a> <a id="393" href="Level.html" class="Module">Level</a> <a id="399" class="Keyword">using</a> <a id="405" class="Symbol">(</a><a id="406" href="Level.html#521" class="Function">0ℓ</a><a id="408" class="Symbol">)</a>
<a id="410" class="Keyword">open</a> <a id="415" class="Keyword">import</a> <a id="422" href="Effect.Applicative.html" class="Module">Effect.Applicative</a>
<a id="441" class="Keyword">open</a> <a id="446" class="Keyword">import</a> <a id="453" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="468" class="Symbol">as</a> <a id="471" class="Module">List</a>
<a id="476" class="Keyword">open</a> <a id="481" class="Keyword">import</a> <a id="488" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="499" class="Symbol">as</a> <a id="502" class="Module">Maybe</a>
<a id="508" class="Keyword">open</a> <a id="513" class="Keyword">import</a> <a id="520" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="534" class="Keyword">open</a> <a id="539" class="Keyword">import</a> <a id="546" href="Data.Product.html" class="Module">Data.Product</a>
<a id="559" class="Keyword">open</a> <a id="564" class="Keyword">import</a> <a id="571" href="Data.Product.Nary.NonDependent.html" class="Module">Data.Product.Nary.NonDependent</a>
<a id="602" class="Keyword">open</a> <a id="607" class="Keyword">import</a> <a id="614" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a>
<a id="628" class="Keyword">open</a> <a id="633" class="Keyword">import</a> <a id="640" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="657" class="Keyword">import</a> <a id="664" href="Data.Sum.Effectful.Left.html" class="Module">Data.Sum.Effectful.Left</a> <a id="688" class="Symbol">as</a> <a id="691" class="Module">Sumₗ</a>
<a id="696" class="Keyword">open</a> <a id="701" class="Keyword">import</a> <a id="708" href="Function.html" class="Module">Function</a>
<a id="717" class="Keyword">open</a> <a id="722" class="Keyword">import</a> <a id="729" href="Function.Nary.NonDependent.html" class="Module">Function.Nary.NonDependent</a> <a id="756" class="Keyword">using</a> <a id="762" class="Symbol">(</a><a id="763" href="Function.Nary.NonDependent.html#1540" class="Function">0ℓs</a><a id="766" class="Symbol">;</a> <a id="768" href="Function.Nary.NonDependent.Base.html#2339" class="Function">Sets</a><a id="772" class="Symbol">)</a>
<a id="774" class="Keyword">open</a> <a id="779" class="Keyword">import</a> <a id="786" href="Function.Strict.html" class="Module">Function.Strict</a>

<a id="803" class="Comment">------------------------------------------------------------------------</a>
<a id="876" class="Comment">-- Format specifications.</a>
<a id="902" class="Comment">-- Defines the supported %-codes.</a>

<a id="937" class="Keyword">record</a> <a id="FormatSpec"></a><a id="944" href="Text.Format.Generic.html#944" class="Record">FormatSpec</a> <a id="955" class="Symbol">:</a> <a id="957" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="962" class="Keyword">where</a>
  <a id="970" class="Keyword">field</a>
    <a id="FormatSpec.ArgChunk"></a><a id="980" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a> <a id="989" class="Symbol">:</a> <a id="991" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="FormatSpec.ArgType"></a><a id="999" href="Text.Format.Generic.html#999" class="Field">ArgType</a>  <a id="1008" class="Symbol">:</a> <a id="1010" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a> <a id="1019" class="Symbol">→</a> <a id="1021" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="FormatSpec.lexArg"></a><a id="1029" href="Text.Format.Generic.html#1029" class="Field">lexArg</a>   <a id="1038" class="Symbol">:</a> <a id="1040" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="1045" class="Symbol">→</a> <a id="1047" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1053" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a>

<a id="1063" class="Keyword">module</a> <a id="1070" href="Text.Format.Generic.html#1070" class="Module">_</a> <a id="1072" class="Keyword">where</a>
  <a id="1080" class="Keyword">open</a> <a id="1085" href="Text.Format.Generic.html#944" class="Module">FormatSpec</a>

  <a id="1099" class="Comment">-- Left-biased union of format specs.</a>
  <a id="1139" href="Text.Format.Generic.html#1139" class="Function">unionSpec</a> <a id="1149" class="Symbol">:</a> <a id="1151" href="Text.Format.Generic.html#944" class="Record">FormatSpec</a> <a id="1162" class="Symbol">→</a> <a id="1164" href="Text.Format.Generic.html#944" class="Record">FormatSpec</a> <a id="1175" class="Symbol">→</a> <a id="1177" href="Text.Format.Generic.html#944" class="Record">FormatSpec</a>
  <a id="1190" href="Text.Format.Generic.html#1139" class="Function">unionSpec</a> <a id="1200" href="Text.Format.Generic.html#1200" class="Bound">spec₁</a> <a id="1206" href="Text.Format.Generic.html#1206" class="Bound">spec₂</a> <a id="1212" class="Symbol">.</a><a id="1213" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a>  <a id="1223" class="Symbol">=</a> <a id="1225" href="Text.Format.Generic.html#1200" class="Bound">spec₁</a> <a id="1231" class="Symbol">.</a><a id="1232" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a> <a id="1241" href="Data.Sum.Base.html#743" class="Datatype Operator">⊎</a> <a id="1243" href="Text.Format.Generic.html#1206" class="Bound">spec₂</a> <a id="1249" class="Symbol">.</a><a id="1250" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a>
  <a id="1261" href="Text.Format.Generic.html#1139" class="Function">unionSpec</a> <a id="1271" href="Text.Format.Generic.html#1271" class="Bound">spec₁</a> <a id="1277" href="Text.Format.Generic.html#1277" class="Bound">spec₂</a> <a id="1283" class="Symbol">.</a><a id="1284" href="Text.Format.Generic.html#999" class="Field">ArgType</a> <a id="1292" class="Symbol">(</a><a id="1293" href="Data.Sum.Base.html#793" class="InductiveConstructor">inj₁</a> <a id="1298" href="Text.Format.Generic.html#1298" class="Bound">a</a><a id="1299" class="Symbol">)</a> <a id="1301" class="Symbol">=</a> <a id="1303" href="Text.Format.Generic.html#1271" class="Bound">spec₁</a> <a id="1309" class="Symbol">.</a><a id="1310" href="Text.Format.Generic.html#999" class="Field">ArgType</a> <a id="1318" href="Text.Format.Generic.html#1298" class="Bound">a</a>
  <a id="1322" href="Text.Format.Generic.html#1139" class="Function">unionSpec</a> <a id="1332" href="Text.Format.Generic.html#1332" class="Bound">spec₁</a> <a id="1338" href="Text.Format.Generic.html#1338" class="Bound">spec₂</a> <a id="1344" class="Symbol">.</a><a id="1345" href="Text.Format.Generic.html#999" class="Field">ArgType</a> <a id="1353" class="Symbol">(</a><a id="1354" href="Data.Sum.Base.html#818" class="InductiveConstructor">inj₂</a> <a id="1359" href="Text.Format.Generic.html#1359" class="Bound">a</a><a id="1360" class="Symbol">)</a> <a id="1362" class="Symbol">=</a> <a id="1364" href="Text.Format.Generic.html#1338" class="Bound">spec₂</a> <a id="1370" class="Symbol">.</a><a id="1371" href="Text.Format.Generic.html#999" class="Field">ArgType</a> <a id="1379" href="Text.Format.Generic.html#1359" class="Bound">a</a>
  <a id="1383" href="Text.Format.Generic.html#1139" class="Function">unionSpec</a> <a id="1393" href="Text.Format.Generic.html#1393" class="Bound">spec₁</a> <a id="1399" href="Text.Format.Generic.html#1399" class="Bound">spec₂</a> <a id="1405" class="Symbol">.</a><a id="1406" href="Text.Format.Generic.html#1029" class="Field">lexArg</a>  <a id="1414" href="Text.Format.Generic.html#1414" class="Bound">c</a> <a id="1416" class="Symbol">=</a>
    <a id="1422" href="Data.Maybe.Base.html#2029" class="Function">Maybe.map</a> <a id="1432" href="Data.Sum.Base.html#793" class="InductiveConstructor">inj₁</a> <a id="1437" class="Symbol">(</a><a id="1438" href="Text.Format.Generic.html#1393" class="Bound">spec₁</a> <a id="1444" class="Symbol">.</a><a id="1445" href="Text.Format.Generic.html#1029" class="Field">lexArg</a> <a id="1452" href="Text.Format.Generic.html#1414" class="Bound">c</a><a id="1453" class="Symbol">)</a> <a id="1455" href="Data.Maybe.Base.html#2359" class="Function Operator">&lt;∣&gt;</a>
    <a id="1463" href="Data.Maybe.Base.html#2029" class="Function">Maybe.map</a> <a id="1473" href="Data.Sum.Base.html#818" class="InductiveConstructor">inj₂</a> <a id="1478" class="Symbol">(</a><a id="1479" href="Text.Format.Generic.html#1399" class="Bound">spec₂</a> <a id="1485" class="Symbol">.</a><a id="1486" href="Text.Format.Generic.html#1029" class="Field">lexArg</a> <a id="1493" href="Text.Format.Generic.html#1414" class="Bound">c</a><a id="1494" class="Symbol">)</a>

<a id="1497" class="Keyword">module</a> <a id="Format"></a><a id="1504" href="Text.Format.Generic.html#1504" class="Module">Format</a> <a id="1511" class="Symbol">(</a><a id="1512" href="Text.Format.Generic.html#1512" class="Bound">spec</a> <a id="1517" class="Symbol">:</a> <a id="1519" href="Text.Format.Generic.html#944" class="Record">FormatSpec</a><a id="1529" class="Symbol">)</a> <a id="1531" class="Keyword">where</a>

  <a id="1540" class="Keyword">open</a> <a id="1545" href="Text.Format.Generic.html#944" class="Module">FormatSpec</a> <a id="1556" href="Text.Format.Generic.html#1512" class="Bound">spec</a>

  <a id="1564" class="Comment">------------------------------------------------------------------------</a>
  <a id="1639" class="Comment">-- Basic types</a>

  <a id="1657" class="Keyword">data</a> <a id="Format.Chunk"></a><a id="1662" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a> <a id="1668" class="Symbol">:</a> <a id="1670" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1674" class="Keyword">where</a>
    <a id="Format.Chunk.Arg"></a><a id="1684" href="Text.Format.Generic.html#1684" class="InductiveConstructor">Arg</a> <a id="1688" class="Symbol">:</a> <a id="1690" href="Text.Format.Generic.html#980" class="Field">ArgChunk</a> <a id="1699" class="Symbol">→</a> <a id="1701" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>
    <a id="Format.Chunk.Raw"></a><a id="1711" href="Text.Format.Generic.html#1711" class="InductiveConstructor">Raw</a> <a id="1715" class="Symbol">:</a> <a id="1717" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="1724" class="Symbol">→</a> <a id="1726" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>

  <a id="Format.Format"></a><a id="1735" href="Text.Format.Generic.html#1735" class="Function">Format</a> <a id="1742" class="Symbol">:</a> <a id="1744" href="Agda.Primitive.html#320" class="Primitive">Set</a>
  <a id="1750" href="Text.Format.Generic.html#1735" class="Function">Format</a> <a id="1757" class="Symbol">=</a> <a id="1759" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1764" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>

  <a id="1773" class="Comment">------------------------------------------------------------------------</a>
  <a id="1848" class="Comment">-- Semantics</a>

  <a id="Format.size"></a><a id="1864" href="Text.Format.Generic.html#1864" class="Function">size</a> <a id="1869" class="Symbol">:</a> <a id="1871" href="Text.Format.Generic.html#1735" class="Function">Format</a> <a id="1878" class="Symbol">→</a> <a id="1880" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
  <a id="1884" href="Text.Format.Generic.html#1864" class="Function">size</a> <a id="1889" class="Symbol">=</a> <a id="1891" href="Data.List.Base.html#4808" class="Function">List.sum</a> <a id="1900" href="Function.Base.html#3646" class="Function Operator">∘′</a> <a id="1903" href="Data.List.Base.html#1572" class="Function">List.map</a> <a id="1912" class="Symbol">λ</a> <a id="1914" class="Symbol">{</a> <a id="1916" class="Symbol">(</a><a id="1917" href="Text.Format.Generic.html#1711" class="InductiveConstructor">Raw</a> <a id="1921" class="Symbol">_)</a> <a id="1924" class="Symbol">→</a> <a id="1926" class="Number">0</a><a id="1927" class="Symbol">;</a> <a id="1929" class="CatchallClause Symbol">_</a> <a id="1931" class="Symbol">→</a> <a id="1933" class="Number">1</a> <a id="1935" class="Symbol">}</a>

  <a id="1940" class="Comment">-- Meaning of a format as a list of value types</a>

  <a id="Format.⟦_⟧"></a><a id="1991" href="Text.Format.Generic.html#1991" class="Function Operator">⟦_⟧</a> <a id="1995" class="Symbol">:</a> <a id="1997" class="Symbol">(</a><a id="1998" href="Text.Format.Generic.html#1998" class="Bound">fmt</a> <a id="2002" class="Symbol">:</a> <a id="2004" href="Text.Format.Generic.html#1735" class="Function">Format</a><a id="2010" class="Symbol">)</a> <a id="2012" class="Symbol">→</a> <a id="2014" href="Function.Nary.NonDependent.Base.html#2339" class="Function">Sets</a> <a id="2019" class="Symbol">(</a><a id="2020" href="Text.Format.Generic.html#1864" class="Function">size</a> <a id="2025" href="Text.Format.Generic.html#1998" class="Bound">fmt</a><a id="2028" class="Symbol">)</a> <a id="2030" href="Function.Nary.NonDependent.html#1540" class="Function">0ℓs</a>
  <a id="2036" href="Text.Format.Generic.html#1991" class="Function Operator">⟦</a> <a id="2038" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>          <a id="2050" href="Text.Format.Generic.html#1991" class="Function Operator">⟧</a> <a id="2052" class="Symbol">=</a> <a id="2054" class="Symbol">_</a>
  <a id="2058" href="Text.Format.Generic.html#1991" class="Function Operator">⟦</a> <a id="2060" href="Text.Format.Generic.html#1684" class="InductiveConstructor">Arg</a> <a id="2064" href="Text.Format.Generic.html#2064" class="Bound">a</a>  <a id="2067" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2069" href="Text.Format.Generic.html#2069" class="Bound">cs</a> <a id="2072" href="Text.Format.Generic.html#1991" class="Function Operator">⟧</a> <a id="2074" class="Symbol">=</a> <a id="2076" href="Text.Format.Generic.html#999" class="Field">ArgType</a> <a id="2084" href="Text.Format.Generic.html#2064" class="Bound">a</a> <a id="2086" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2088" href="Text.Format.Generic.html#1991" class="Function Operator">⟦</a> <a id="2090" href="Text.Format.Generic.html#2069" class="Bound">cs</a> <a id="2093" href="Text.Format.Generic.html#1991" class="Function Operator">⟧</a>
  <a id="2097" href="Text.Format.Generic.html#1991" class="Function Operator">⟦</a> <a id="2099" href="Text.Format.Generic.html#1711" class="InductiveConstructor">Raw</a> <a id="2103" class="Symbol">_</a>  <a id="2106" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2108" href="Text.Format.Generic.html#2108" class="Bound">cs</a> <a id="2111" href="Text.Format.Generic.html#1991" class="Function Operator">⟧</a> <a id="2113" class="Symbol">=</a>             <a id="2127" href="Text.Format.Generic.html#1991" class="Function Operator">⟦</a> <a id="2129" href="Text.Format.Generic.html#2108" class="Bound">cs</a> <a id="2132" href="Text.Format.Generic.html#1991" class="Function Operator">⟧</a>

  <a id="2137" class="Comment">------------------------------------------------------------------------</a>
  <a id="2212" class="Comment">-- Lexer: from Strings to Formats</a>

  <a id="2249" class="Comment">-- Lexing may fail. To have a useful error message, we defined the following</a>
  <a id="2328" class="Comment">-- enumerated type</a>

  <a id="2350" class="Keyword">data</a> <a id="Format.Error"></a><a id="2355" href="Text.Format.Generic.html#2355" class="Datatype">Error</a> <a id="2361" class="Symbol">:</a> <a id="2363" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2367" class="Keyword">where</a>
    <a id="Format.Error.UnexpectedEndOfString"></a><a id="2377" href="Text.Format.Generic.html#2377" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="2399" class="Symbol">:</a> <a id="2401" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2408" class="Symbol">→</a> <a id="2410" href="Text.Format.Generic.html#2355" class="Datatype">Error</a>
    <a id="2420" class="Comment">-- ^ expected a type declaration; found an empty string</a>
    <a id="Format.Error.InvalidType"></a><a id="2480" href="Text.Format.Generic.html#2480" class="InductiveConstructor">InvalidType</a> <a id="2492" class="Symbol">:</a> <a id="2494" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2501" class="Symbol">→</a> <a id="2503" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="2508" class="Symbol">→</a> <a id="2510" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2517" class="Symbol">→</a> <a id="2519" href="Text.Format.Generic.html#2355" class="Datatype">Error</a>
    <a id="2529" class="Comment">-- ^ invalid type declaration</a>
    <a id="2563" class="Comment">--   return a focus: prefix processed, character causing failure, rest</a>

  <a id="Format.lexer"></a><a id="2637" href="Text.Format.Generic.html#2637" class="Function">lexer</a> <a id="2643" class="Symbol">:</a> <a id="2645" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2652" class="Symbol">→</a> <a id="2654" href="Text.Format.Generic.html#2355" class="Datatype">Error</a> <a id="2660" href="Data.Sum.Base.html#743" class="Datatype Operator">⊎</a> <a id="2662" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2667" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>
  <a id="2675" href="Text.Format.Generic.html#2637" class="Function">lexer</a> <a id="2681" href="Text.Format.Generic.html#2681" class="Bound">input</a> <a id="2687" class="Symbol">=</a> <a id="2689" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="2694" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="2697" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="2700" class="Symbol">(</a><a id="2701" href="Data.String.Base.html#1540" class="Primitive">toList</a> <a id="2708" href="Text.Format.Generic.html#2681" class="Bound">input</a><a id="2713" class="Symbol">)</a> <a id="2715" class="Keyword">where</a>

    <a id="2726" class="Keyword">open</a> <a id="2731" href="Effect.Applicative.html#607" class="Module">RawApplicative</a> <a id="2746" class="Symbol">(</a><a id="2747" href="Data.Sum.Effectful.Left.html#948" class="Function">Sumₗ.applicative</a> <a id="2764" href="Text.Format.Generic.html#2355" class="Datatype">Error</a> <a id="2770" href="Level.html#521" class="Function">0ℓ</a><a id="2772" class="Symbol">)</a>

    <a id="2779" class="Comment">-- Type synonyms used locally to document the code</a>
    <a id="2834" href="Text.Format.Generic.html#2834" class="Function">RevWord</a> <a id="2842" class="Symbol">=</a> <a id="2844" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2849" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="2854" class="Comment">-- Mere characters accumulated so far</a>
    <a id="2896" href="Text.Format.Generic.html#2896" class="Function">Prefix</a>  <a id="2904" class="Symbol">=</a> <a id="2906" href="Text.Format.Generic.html#2834" class="Function">RevWord</a>   <a id="2916" class="Comment">-- Prefix of the input String already read</a>

    <a id="2964" href="Text.Format.Generic.html#2964" class="Function">toRevString</a> <a id="2976" class="Symbol">:</a> <a id="2978" href="Text.Format.Generic.html#2834" class="Function">RevWord</a> <a id="2986" class="Symbol">→</a> <a id="2988" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="2999" href="Text.Format.Generic.html#2964" class="Function">toRevString</a> <a id="3011" class="Symbol">=</a> <a id="3013" href="Data.String.Base.html#1573" class="Primitive">fromList</a> <a id="3022" href="Function.Base.html#3646" class="Function Operator">∘′</a> <a id="3025" href="Data.List.Base.html#6817" class="Function">reverse</a>

    <a id="3038" class="Comment">-- Push a Raw token if we have accumulated some mere characters</a>
    <a id="3106" href="Text.Format.Generic.html#3106" class="Function">push</a> <a id="3111" class="Symbol">:</a> <a id="3113" href="Text.Format.Generic.html#2834" class="Function">RevWord</a> <a id="3121" class="Symbol">→</a> <a id="3123" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3128" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a> <a id="3134" class="Symbol">→</a> <a id="3136" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3141" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>
    <a id="3151" href="Text.Format.Generic.html#3106" class="Function">push</a> <a id="3156" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="3159" href="Text.Format.Generic.html#3159" class="Bound">ks</a> <a id="3162" class="Symbol">=</a> <a id="3164" href="Text.Format.Generic.html#3159" class="Bound">ks</a>
    <a id="3171" href="Text.Format.Generic.html#3106" class="CatchallClause Function">push</a><a id="3175" class="CatchallClause"> </a><a id="3176" href="Text.Format.Generic.html#3176" class="CatchallClause Bound">cs</a><a id="3178" class="CatchallClause"> </a><a id="3179" href="Text.Format.Generic.html#3179" class="CatchallClause Bound">ks</a> <a id="3182" class="Symbol">=</a> <a id="3184" href="Text.Format.Generic.html#1711" class="InductiveConstructor">Raw</a> <a id="3188" class="Symbol">(</a><a id="3189" href="Text.Format.Generic.html#2964" class="Function">toRevString</a> <a id="3201" href="Text.Format.Generic.html#3176" class="Bound">cs</a><a id="3203" class="Symbol">)</a> <a id="3205" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3207" href="Text.Format.Generic.html#3179" class="Bound">ks</a>

    <a id="3215" class="Comment">-- Main loop</a>
    <a id="3232" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3237" class="Symbol">:</a> <a id="3239" href="Text.Format.Generic.html#2834" class="Function">RevWord</a> <a id="3247" class="Symbol">→</a> <a id="3249" href="Text.Format.Generic.html#2896" class="Function">Prefix</a> <a id="3256" class="Symbol">→</a> <a id="3258" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3263" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="3268" class="Symbol">→</a> <a id="3270" href="Text.Format.Generic.html#2355" class="Datatype">Error</a> <a id="3276" href="Data.Sum.Base.html#743" class="Datatype Operator">⊎</a> <a id="3278" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3283" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>
    <a id="3293" href="Text.Format.Generic.html#3293" class="Function">type</a> <a id="3298" class="Symbol">:</a>           <a id="3310" href="Text.Format.Generic.html#2896" class="Function">Prefix</a> <a id="3317" class="Symbol">→</a> <a id="3319" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3324" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="3329" class="Symbol">→</a> <a id="3331" href="Text.Format.Generic.html#2355" class="Datatype">Error</a> <a id="3337" href="Data.Sum.Base.html#743" class="Datatype Operator">⊎</a> <a id="3339" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3344" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>

    <a id="3355" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3360" href="Text.Format.Generic.html#3360" class="Bound">acc</a> <a id="3364" href="Text.Format.Generic.html#3364" class="Bound">bef</a> <a id="3368" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>               <a id="3385" class="Symbol">=</a> <a id="3387" href="Effect.Applicative.Indexed.html#1000" class="Function">pure</a> <a id="3392" class="Symbol">(</a><a id="3393" href="Text.Format.Generic.html#3106" class="Function">push</a> <a id="3398" href="Text.Format.Generic.html#3360" class="Bound">acc</a> <a id="3402" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3404" class="Symbol">)</a>
    <a id="3410" class="Comment">-- escaped &#39;%&#39; character: treat like a mere character</a>
    <a id="3468" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3473" href="Text.Format.Generic.html#3473" class="Bound">acc</a> <a id="3477" href="Text.Format.Generic.html#3477" class="Bound">bef</a> <a id="3481" class="Symbol">(</a><a id="3482" class="String">&#39;%&#39;</a> <a id="3486" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3488" class="String">&#39;%&#39;</a> <a id="3492" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3494" href="Text.Format.Generic.html#3494" class="Bound">cs</a><a id="3496" class="Symbol">)</a> <a id="3498" class="Symbol">=</a> <a id="3500" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3505" class="Symbol">(</a><a id="3506" class="String">&#39;%&#39;</a> <a id="3510" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3512" href="Text.Format.Generic.html#3473" class="Bound">acc</a><a id="3515" class="Symbol">)</a> <a id="3517" class="Symbol">(</a><a id="3518" class="String">&#39;%&#39;</a> <a id="3522" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3524" class="String">&#39;%&#39;</a> <a id="3528" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3530" href="Text.Format.Generic.html#3477" class="Bound">bef</a><a id="3533" class="Symbol">)</a> <a id="3535" href="Text.Format.Generic.html#3494" class="Bound">cs</a>
    <a id="3542" class="Comment">-- non escaped &#39;%&#39;: type declaration following</a>
    <a id="3593" href="Text.Format.Generic.html#3232" class="CatchallClause Function">loop</a><a id="3597" class="CatchallClause"> </a><a id="3598" href="Text.Format.Generic.html#3598" class="CatchallClause Bound">acc</a><a id="3601" class="CatchallClause"> </a><a id="3602" href="Text.Format.Generic.html#3602" class="CatchallClause Bound">bef</a><a id="3605" class="CatchallClause"> </a><a id="3606" class="CatchallClause Symbol">(</a><a id="3607" class="CatchallClause String">&#39;%&#39;</a><a id="3610" class="CatchallClause"> </a><a id="3611" href="Agda.Builtin.List.html#182" class="CatchallClause InductiveConstructor Operator">∷</a><a id="3612" class="CatchallClause"> </a><a id="3613" href="Text.Format.Generic.html#3613" class="CatchallClause Bound">cs</a><a id="3615" class="CatchallClause Symbol">)</a>       <a id="3623" class="Symbol">=</a> <a id="3625" href="Text.Format.Generic.html#3106" class="Function">push</a> <a id="3630" href="Text.Format.Generic.html#3598" class="Bound">acc</a> <a id="3634" href="Effect.Functor.html#607" class="Function Operator">&lt;$&gt;</a> <a id="3638" href="Text.Format.Generic.html#3293" class="Function">type</a> <a id="3643" class="Symbol">(</a><a id="3644" class="String">&#39;%&#39;</a> <a id="3648" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3650" href="Text.Format.Generic.html#3602" class="Bound">bef</a><a id="3653" class="Symbol">)</a> <a id="3655" href="Text.Format.Generic.html#3613" class="Bound">cs</a>
    <a id="3662" class="Comment">-- mere character: push onto the accumulator</a>
    <a id="3711" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3716" href="Text.Format.Generic.html#3716" class="Bound">acc</a> <a id="3720" href="Text.Format.Generic.html#3720" class="Bound">bef</a> <a id="3724" class="Symbol">(</a><a id="3725" href="Text.Format.Generic.html#3725" class="Bound">c</a> <a id="3727" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3729" href="Text.Format.Generic.html#3729" class="Bound">cs</a><a id="3731" class="Symbol">)</a>         <a id="3741" class="Symbol">=</a> <a id="3743" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3748" class="Symbol">(</a><a id="3749" href="Text.Format.Generic.html#3725" class="Bound">c</a> <a id="3751" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3753" href="Text.Format.Generic.html#3716" class="Bound">acc</a><a id="3756" class="Symbol">)</a> <a id="3758" class="Symbol">(</a><a id="3759" href="Text.Format.Generic.html#3725" class="Bound">c</a> <a id="3761" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3763" href="Text.Format.Generic.html#3720" class="Bound">bef</a><a id="3766" class="Symbol">)</a> <a id="3768" href="Text.Format.Generic.html#3729" class="Bound">cs</a>

    <a id="3776" href="Text.Format.Generic.html#3293" class="Function">type</a> <a id="3781" href="Text.Format.Generic.html#3781" class="Bound">bef</a> <a id="3785" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>       <a id="3794" class="Symbol">=</a> <a id="3796" href="Data.Sum.Base.html#793" class="InductiveConstructor">inj₁</a> <a id="3801" class="Symbol">(</a><a id="3802" href="Text.Format.Generic.html#2377" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="3824" href="Text.Format.Generic.html#2681" class="Bound">input</a><a id="3829" class="Symbol">)</a>
    <a id="3835" href="Text.Format.Generic.html#3293" class="Function">type</a> <a id="3840" href="Text.Format.Generic.html#3840" class="Bound">bef</a> <a id="3844" class="Symbol">(</a><a id="3845" href="Text.Format.Generic.html#3845" class="Bound">c</a> <a id="3847" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3849" href="Text.Format.Generic.html#3849" class="Bound">cs</a><a id="3851" class="Symbol">)</a> <a id="3853" class="Symbol">=</a> <a id="3855" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a> <a id="3859" href="Effect.Functor.html#607" class="Function Operator">&lt;$&gt;</a> <a id="3863" href="Text.Format.Generic.html#3907" class="Function">chunk</a> <a id="3869" href="Text.Format.Generic.html#3845" class="Bound">c</a> <a id="3871" href="Effect.Applicative.Indexed.html#1031" class="Function Operator">⊛</a> <a id="3873" href="Text.Format.Generic.html#3232" class="Function">loop</a> <a id="3878" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="3881" class="Symbol">(</a><a id="3882" href="Text.Format.Generic.html#3845" class="Bound">c</a> <a id="3884" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3886" href="Text.Format.Generic.html#3840" class="Bound">bef</a><a id="3889" class="Symbol">)</a> <a id="3891" href="Text.Format.Generic.html#3849" class="Bound">cs</a> <a id="3894" class="Keyword">where</a>

      <a id="3907" href="Text.Format.Generic.html#3907" class="Function">chunk</a> <a id="3913" class="Symbol">:</a> <a id="3915" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="3920" class="Symbol">→</a> <a id="3922" href="Text.Format.Generic.html#2355" class="Datatype">Error</a> <a id="3928" href="Data.Sum.Base.html#743" class="Datatype Operator">⊎</a> <a id="3930" href="Text.Format.Generic.html#1662" class="Datatype">Chunk</a>
      <a id="3942" href="Text.Format.Generic.html#3907" class="Function">chunk</a> <a id="3948" href="Text.Format.Generic.html#3948" class="Bound">c</a> <a id="3950" class="Symbol">=</a>
        <a id="3960" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="3965" href="Text.Format.Generic.html#1029" class="Field">lexArg</a> <a id="3972" href="Text.Format.Generic.html#3948" class="Bound">c</a> <a id="3974" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="3977" class="Symbol">λ</a> <a id="3979" class="Keyword">where</a>
          <a id="3995" class="Symbol">(</a><a id="3996" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4001" href="Text.Format.Generic.html#4001" class="Bound">ch</a><a id="4003" class="Symbol">)</a> <a id="4005" class="Symbol">→</a> <a id="4007" href="Effect.Applicative.Indexed.html#1000" class="Function">pure</a> <a id="4012" class="Symbol">(</a><a id="4013" href="Text.Format.Generic.html#1684" class="InductiveConstructor">Arg</a> <a id="4017" href="Text.Format.Generic.html#4001" class="Bound">ch</a><a id="4019" class="Symbol">)</a>
          <a id="4031" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>   <a id="4041" class="Symbol">→</a>
            <a id="4055" href="Function.Strict.html#1672" class="Function">force′</a> <a id="4062" class="Symbol">(</a><a id="4063" href="Text.Format.Generic.html#2964" class="Function">toRevString</a> <a id="4075" href="Text.Format.Generic.html#3840" class="Bound">bef</a><a id="4078" class="Symbol">)</a> <a id="4080" class="Symbol">λ</a> <a id="4082" href="Text.Format.Generic.html#4082" class="Bound">prefix</a> <a id="4089" class="Symbol">→</a>
            <a id="4103" href="Function.Strict.html#1672" class="Function">force′</a> <a id="4110" class="Symbol">(</a><a id="4111" href="Data.String.Base.html#1573" class="Primitive">fromList</a> <a id="4120" href="Text.Format.Generic.html#3849" class="Bound">cs</a><a id="4122" class="Symbol">)</a>     <a id="4128" class="Symbol">λ</a> <a id="4130" href="Text.Format.Generic.html#4130" class="Bound">suffix</a> <a id="4137" class="Symbol">→</a>
            <a id="4151" href="Data.Sum.Base.html#793" class="InductiveConstructor">inj₁</a> <a id="4156" class="Symbol">(</a><a id="4157" href="Text.Format.Generic.html#2480" class="InductiveConstructor">InvalidType</a> <a id="4169" href="Text.Format.Generic.html#4082" class="Bound">prefix</a> <a id="4176" href="Text.Format.Generic.html#3948" class="Bound">c</a> <a id="4178" href="Text.Format.Generic.html#4130" class="Bound">suffix</a><a id="4184" class="Symbol">)</a>
</pre></body></html>