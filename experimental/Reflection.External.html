<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Reflection.External</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Support for system calls as part of reflection</a>
<a id="156" class="Comment">------------------------------------------------------------------------</a>

<a id="230" class="Symbol">{-#</a> <a id="234" class="Keyword">OPTIONS</a> <a id="242" class="Pragma">--cubical-compatible</a> <a id="263" class="Pragma">--safe</a> <a id="270" class="Symbol">#-}</a>

<a id="275" class="Keyword">module</a> <a id="282" href="Reflection.External.html" class="Module">Reflection.External</a> <a id="302" class="Keyword">where</a>

<a id="309" class="Keyword">import</a> <a id="316" href="Agda.Builtin.Reflection.External.html" class="Module">Agda.Builtin.Reflection.External</a> <a id="349" class="Symbol">as</a> <a id="352" class="Module">Builtin</a>

<a id="361" class="Keyword">open</a> <a id="366" class="Keyword">import</a> <a id="373" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="387" class="Keyword">using</a> <a id="393" class="Symbol">(</a><a id="394" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="395" class="Symbol">;</a> <a id="397" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a><a id="400" class="Symbol">;</a> <a id="402" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a><a id="406" class="Symbol">;</a> <a id="408" href="Data.Nat.Base.html#2499" class="Record">NonZero</a><a id="415" class="Symbol">)</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="444" class="Keyword">using</a> <a id="450" class="Symbol">(</a><a id="451" href="Agda.Builtin.List.html#130" class="Datatype">List</a><a id="455" class="Symbol">;</a> <a id="457" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a><a id="460" class="Symbol">;</a> <a id="462" href="Data.List.Base.html#7191" class="InductiveConstructor">[]</a><a id="464" class="Symbol">)</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Data.Product.html" class="Module">Data.Product</a> <a id="491" class="Keyword">using</a> <a id="497" class="Symbol">(</a><a id="498" href="Data.Product.html#1176" class="Function Operator">_×_</a><a id="501" class="Symbol">;</a> <a id="503" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">_,_</a><a id="506" class="Symbol">)</a>
<a id="508" class="Keyword">open</a> <a id="513" class="Keyword">import</a> <a id="520" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="537" class="Symbol">as</a> <a id="540" class="Module">String</a> <a id="547" class="Keyword">using</a> <a id="553" class="Symbol">(</a><a id="554" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="560" class="Symbol">;</a> <a id="562" href="Data.String.Base.html#2413" class="Function Operator">_++_</a><a id="566" class="Symbol">)</a>
<a id="568" class="Keyword">open</a> <a id="573" class="Keyword">import</a> <a id="580" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="589" class="Keyword">using</a> <a id="595" class="Symbol">(</a><a id="596" href="Data.Sum.Base.html#743" class="Datatype Operator">_⊎_</a><a id="599" class="Symbol">;</a> <a id="601" href="Data.Sum.Base.html#793" class="InductiveConstructor">inj₁</a><a id="605" class="Symbol">;</a> <a id="607" href="Data.Sum.Base.html#818" class="InductiveConstructor">inj₂</a><a id="611" class="Symbol">;</a> <a id="613" href="Data.Sum.Base.html#929" class="Function Operator">[_,_]</a><a id="618" class="Symbol">)</a>
<a id="620" class="Keyword">open</a> <a id="625" class="Keyword">import</a> <a id="632" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="647" class="Keyword">using</a> <a id="653" class="Symbol">(</a><a id="654" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a><a id="655" class="Symbol">;</a> <a id="657" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a><a id="659" class="Symbol">)</a>
<a id="661" class="Keyword">open</a> <a id="666" class="Keyword">import</a> <a id="673" href="Function.html" class="Module">Function</a> <a id="682" class="Keyword">using</a> <a id="688" class="Symbol">(</a><a id="689" href="Function.Base.html#4062" class="Function Operator">case_of_</a><a id="697" class="Symbol">;</a> <a id="699" href="Function.Base.html#2003" class="Function Operator">_$_</a><a id="702" class="Symbol">;</a> <a id="704" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="707" class="Symbol">)</a>
<a id="709" class="Keyword">open</a> <a id="714" class="Keyword">import</a> <a id="721" href="Reflection.html" class="Module">Reflection</a> <a id="732" class="Keyword">hiding</a> <a id="739" class="Symbol">(</a><a id="740" href="Agda.Builtin.Reflection.html#4266" class="InductiveConstructor">name</a><a id="744" class="Symbol">)</a>

<a id="747" class="Comment">-- Type aliases for the various strings.</a>

<a id="CmdName"></a><a id="789" href="Reflection.External.html#789" class="Function">CmdName</a> <a id="797" class="Symbol">=</a> <a id="799" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdIn"></a><a id="806" href="Reflection.External.html#806" class="Function">StdIn</a>   <a id="814" class="Symbol">=</a> <a id="816" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdErr"></a><a id="823" href="Reflection.External.html#823" class="Function">StdErr</a>  <a id="831" class="Symbol">=</a> <a id="833" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdOut"></a><a id="840" href="Reflection.External.html#840" class="Function">StdOut</a>  <a id="848" class="Symbol">=</a> <a id="850" href="Agda.Builtin.String.html#318" class="Postulate">String</a>

<a id="858" class="Comment">-- Representation for exit codes, assuming 0 is consistently used to indicate</a>
<a id="936" class="Comment">-- success across platforms.</a>
<a id="965" class="Keyword">data</a> <a id="ExitCode"></a><a id="970" href="Reflection.External.html#970" class="Datatype">ExitCode</a> <a id="979" class="Symbol">:</a> <a id="981" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="985" class="Keyword">where</a>
  <a id="ExitCode.exitSuccess"></a><a id="993" href="Reflection.External.html#993" class="InductiveConstructor">exitSuccess</a> <a id="1005" class="Symbol">:</a> <a id="1007" href="Reflection.External.html#970" class="Datatype">ExitCode</a>
  <a id="ExitCode.exitFailure"></a><a id="1018" href="Reflection.External.html#1018" class="InductiveConstructor">exitFailure</a> <a id="1030" class="Symbol">:</a> <a id="1032" class="Symbol">(</a><a id="1033" href="Reflection.External.html#1033" class="Bound">n</a> <a id="1035" class="Symbol">:</a> <a id="1037" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="1038" class="Symbol">)</a> <a id="1040" class="Symbol">{</a><a id="1041" href="Reflection.External.html#1041" class="Bound">n≢0</a> <a id="1045" class="Symbol">:</a> <a id="1047" href="Data.Nat.Base.html#2499" class="Record">NonZero</a> <a id="1055" href="Reflection.External.html#1033" class="Bound">n</a><a id="1056" class="Symbol">}</a> <a id="1058" class="Symbol">→</a> <a id="1060" href="Reflection.External.html#970" class="Datatype">ExitCode</a>

<a id="1070" class="Comment">-- Specification for a command.</a>
<a id="1102" class="Keyword">record</a> <a id="CmdSpec"></a><a id="1109" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="1117" class="Symbol">:</a> <a id="1119" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1123" class="Keyword">where</a>
  <a id="1131" class="Keyword">constructor</a> <a id="cmdSpec"></a><a id="1143" href="Reflection.External.html#1143" class="InductiveConstructor">cmdSpec</a>
  <a id="1153" class="Keyword">field</a>
    <a id="CmdSpec.name"></a><a id="1163" href="Reflection.External.html#1163" class="Field">name</a>  <a id="1169" class="Symbol">:</a> <a id="1171" href="Reflection.External.html#789" class="Function">CmdName</a>     <a id="1183" class="Comment">-- ^ Executable name (see ~/.agda/executables)</a>
    <a id="CmdSpec.args"></a><a id="1234" href="Reflection.External.html#1234" class="Field">args</a>  <a id="1240" class="Symbol">:</a> <a id="1242" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1247" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="1254" class="Comment">-- ^ Command-line arguments for executable</a>
    <a id="CmdSpec.input"></a><a id="1301" href="Reflection.External.html#1301" class="Field">input</a> <a id="1307" class="Symbol">:</a> <a id="1309" href="Reflection.External.html#806" class="Function">StdIn</a>       <a id="1321" class="Comment">-- ^ Contents of standard input</a>

<a id="1354" class="Comment">-- Result of running a command.</a>
<a id="1386" class="Keyword">record</a> <a id="Result"></a><a id="1393" href="Reflection.External.html#1393" class="Record">Result</a> <a id="1400" class="Symbol">:</a> <a id="1402" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1406" class="Keyword">where</a>
  <a id="1414" class="Keyword">constructor</a> <a id="result"></a><a id="1426" href="Reflection.External.html#1426" class="InductiveConstructor">result</a>
  <a id="1435" class="Keyword">field</a>
    <a id="Result.exitCode"></a><a id="1445" href="Reflection.External.html#1445" class="Field">exitCode</a> <a id="1454" class="Symbol">:</a> <a id="1456" href="Reflection.External.html#970" class="Datatype">ExitCode</a> <a id="1465" class="Comment">-- ^ Exit code returned by the process</a>
    <a id="Result.output"></a><a id="1508" href="Reflection.External.html#1508" class="Field">output</a>   <a id="1517" class="Symbol">:</a> <a id="1519" href="Reflection.External.html#840" class="Function">StdOut</a>   <a id="1528" class="Comment">-- ^ Contents of standard output</a>
    <a id="Result.error"></a><a id="1565" href="Reflection.External.html#1565" class="Field">error</a>    <a id="1574" class="Symbol">:</a> <a id="1576" href="Reflection.External.html#823" class="Function">StdErr</a>   <a id="1585" class="Comment">-- ^ Contents of standard error</a>

<a id="1618" class="Comment">-- Convert a natural number to an exit code.</a>
<a id="toExitCode"></a><a id="1663" href="Reflection.External.html#1663" class="Function">toExitCode</a> <a id="1674" class="Symbol">:</a> <a id="1676" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="1678" class="Symbol">→</a> <a id="1680" href="Reflection.External.html#970" class="Datatype">ExitCode</a>
<a id="1689" href="Reflection.External.html#1663" class="Function">toExitCode</a> <a id="1700" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a>    <a id="1708" class="Symbol">=</a> <a id="1710" href="Reflection.External.html#993" class="InductiveConstructor">exitSuccess</a>
<a id="1722" href="Reflection.External.html#1663" class="Function">toExitCode</a> <a id="1733" class="Symbol">(</a><a id="1734" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1738" href="Reflection.External.html#1738" class="Bound">n</a><a id="1739" class="Symbol">)</a> <a id="1741" class="Symbol">=</a> <a id="1743" href="Reflection.External.html#1018" class="InductiveConstructor">exitFailure</a> <a id="1755" class="Symbol">(</a><a id="1756" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1760" href="Reflection.External.html#1738" class="Bound">n</a><a id="1761" class="Symbol">)</a>

<a id="1764" class="Comment">-- Quote an exit code as an Agda term.</a>
<a id="quoteExitCode"></a><a id="1803" href="Reflection.External.html#1803" class="Function">quoteExitCode</a> <a id="1817" class="Symbol">:</a> <a id="1819" href="Reflection.External.html#970" class="Datatype">ExitCode</a> <a id="1828" class="Symbol">→</a> <a id="1830" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a>
<a id="1835" href="Reflection.External.html#1803" class="Function">quoteExitCode</a> <a id="1849" href="Reflection.External.html#993" class="InductiveConstructor">exitSuccess</a> <a id="1861" class="Symbol">=</a>
  <a id="1865" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1869" class="Symbol">(</a><a id="1870" class="Keyword">quote</a> <a id="1876" href="Reflection.External.html#993" class="InductiveConstructor">exitSuccess</a><a id="1887" class="Symbol">)</a> <a id="1889" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
<a id="1892" href="Reflection.External.html#1803" class="Function">quoteExitCode</a> <a id="1906" class="Symbol">(</a><a id="1907" href="Reflection.External.html#1018" class="InductiveConstructor">exitFailure</a> <a id="1919" href="Reflection.External.html#1919" class="Bound">n</a><a id="1920" class="Symbol">)</a> <a id="1922" class="Symbol">=</a>
  <a id="1926" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1930" class="Symbol">(</a><a id="1931" class="Keyword">quote</a> <a id="1937" href="Reflection.External.html#1018" class="InductiveConstructor">exitFailure</a><a id="1948" class="Symbol">)</a> <a id="1950" class="Symbol">(</a><a id="1951" href="Reflection.AST.Argument.html#1272" class="InductiveConstructor">vArg</a> <a id="1956" class="Symbol">(</a><a id="1957" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="1961" class="Symbol">(</a><a id="1962" href="Agda.Builtin.Reflection.html#4096" class="InductiveConstructor">nat</a> <a id="1966" href="Reflection.External.html#1919" class="Bound">n</a><a id="1967" class="Symbol">))</a> <a id="1970" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1972" href="Reflection.AST.Argument.html#1334" class="InductiveConstructor">hArg</a> <a id="1977" class="Symbol">(</a><a id="1978" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1982" class="Symbol">(</a><a id="1983" class="Keyword">quote</a> <a id="1989" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a><a id="1991" class="Symbol">)</a> <a id="1993" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="1995" class="Symbol">)</a> <a id="1997" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1999" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="2001" class="Symbol">)</a>

<a id="2004" class="Comment">-- Quote a result as an Agda term.</a>
<a id="quoteResult"></a><a id="2039" href="Reflection.External.html#2039" class="Function">quoteResult</a> <a id="2051" class="Symbol">:</a> <a id="2053" href="Reflection.External.html#1393" class="Record">Result</a> <a id="2060" class="Symbol">→</a> <a id="2062" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a>
<a id="2067" href="Reflection.External.html#2039" class="Function">quoteResult</a> <a id="2079" class="Symbol">(</a><a id="2080" href="Reflection.External.html#1426" class="InductiveConstructor">result</a> <a id="2087" href="Reflection.External.html#2087" class="Bound">exitCode</a> <a id="2096" href="Reflection.External.html#2096" class="Bound">output</a> <a id="2103" href="Reflection.External.html#2103" class="Bound">error</a><a id="2108" class="Symbol">)</a> <a id="2110" class="Symbol">=</a>
  <a id="2114" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="2118" class="Symbol">(</a><a id="2119" class="Keyword">quote</a> <a id="2125" href="Reflection.External.html#1426" class="InductiveConstructor">result</a><a id="2131" class="Symbol">)</a> <a id="2133" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2135" href="Reflection.AST.Argument.html#1272" class="InductiveConstructor">vArg</a> <a id="2140" class="Symbol">(</a><a id="2141" href="Reflection.External.html#1803" class="Function">quoteExitCode</a> <a id="2155" href="Reflection.External.html#2087" class="Bound">exitCode</a><a id="2163" class="Symbol">)</a>
                     <a id="2186" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2188" href="Reflection.AST.Argument.html#1272" class="InductiveConstructor">vArg</a> <a id="2193" class="Symbol">(</a><a id="2194" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="2198" class="Symbol">(</a><a id="2199" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a> <a id="2206" href="Reflection.External.html#2096" class="Bound">output</a><a id="2212" class="Symbol">))</a>
                     <a id="2236" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2238" href="Reflection.AST.Argument.html#1272" class="InductiveConstructor">vArg</a> <a id="2243" class="Symbol">(</a><a id="2244" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="2248" class="Symbol">(</a><a id="2249" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a> <a id="2256" href="Reflection.External.html#2103" class="Bound">error</a><a id="2261" class="Symbol">))</a>
                     <a id="2285" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2287" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

<a id="2291" class="Comment">-- Run command from specification and return the full result.</a>
<a id="2353" class="Comment">--</a>
<a id="2356" class="Comment">-- NOTE: If the command fails, this macro still succeeds, and returns the</a>
<a id="2430" class="Comment">--       full result, including exit code and the contents of stderr.</a>
<a id="2500" class="Comment">--</a>
<a id="unsafeRunCmdTC"></a><a id="2503" href="Reflection.External.html#2503" class="Function">unsafeRunCmdTC</a> <a id="2518" class="Symbol">:</a> <a id="2520" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="2528" class="Symbol">→</a> <a id="2530" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="2533" href="Reflection.External.html#1393" class="Record">Result</a>
<a id="2540" href="Reflection.External.html#2503" class="Function">unsafeRunCmdTC</a> <a id="2555" href="Reflection.External.html#2555" class="Bound">c</a> <a id="2557" class="Symbol">=</a> <a id="2559" class="Keyword">do</a>
  <a id="2564" class="Symbol">(</a><a id="2565" href="Reflection.External.html#2565" class="Bound">exitCode</a> <a id="2574" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2576" class="Symbol">(</a><a id="2577" href="Reflection.External.html#2577" class="Bound">stdOut</a> <a id="2584" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2586" href="Reflection.External.html#2586" class="Bound">stdErr</a><a id="2592" class="Symbol">))</a>
    <a id="2599" href="Reflection.TCM.Syntax.html#676" class="Function Operator">←</a> <a id="2601" href="Agda.Builtin.Reflection.External.html#298" class="Postulate">Builtin.execTC</a> <a id="2616" class="Symbol">(</a><a id="2617" href="Reflection.External.html#1163" class="Field">CmdSpec.name</a> <a id="2630" href="Reflection.External.html#2555" class="Bound">c</a><a id="2631" class="Symbol">)</a> <a id="2633" class="Symbol">(</a><a id="2634" href="Reflection.External.html#1234" class="Field">CmdSpec.args</a> <a id="2647" href="Reflection.External.html#2555" class="Bound">c</a><a id="2648" class="Symbol">)</a> <a id="2650" class="Symbol">(</a><a id="2651" href="Reflection.External.html#1301" class="Field">CmdSpec.input</a> <a id="2665" href="Reflection.External.html#2555" class="Bound">c</a><a id="2666" class="Symbol">)</a>
  <a id="2670" href="Reflection.TCM.html#1025" class="Postulate">return</a> <a id="2677" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2679" href="Reflection.External.html#1426" class="InductiveConstructor">result</a> <a id="2686" class="Symbol">(</a><a id="2687" href="Reflection.External.html#1663" class="Function">toExitCode</a> <a id="2698" href="Reflection.External.html#2565" class="Bound">exitCode</a><a id="2706" class="Symbol">)</a> <a id="2708" href="Reflection.External.html#2577" class="Bound">stdOut</a> <a id="2715" href="Reflection.External.html#2586" class="Bound">stdErr</a>

<a id="2723" class="Keyword">macro</a>
  <a id="unsafeRunCmd"></a><a id="2731" href="Reflection.External.html#2731" class="Function">unsafeRunCmd</a> <a id="2744" class="Symbol">:</a> <a id="2746" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="2754" class="Symbol">→</a> <a id="2756" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a> <a id="2761" class="Symbol">→</a> <a id="2763" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="2766" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
  <a id="2770" href="Reflection.External.html#2731" class="Function">unsafeRunCmd</a> <a id="2783" href="Reflection.External.html#2783" class="Bound">c</a> <a id="2785" href="Reflection.External.html#2785" class="Bound">hole</a> <a id="2790" class="Symbol">=</a> <a id="2792" href="Reflection.External.html#2503" class="Function">unsafeRunCmdTC</a> <a id="2807" href="Reflection.External.html#2783" class="Bound">c</a> <a id="2809" href="Reflection.TCM.Syntax.html#676" class="Function Operator">&gt;&gt;=</a> <a id="2813" href="Agda.Builtin.Reflection.html#8452" class="Postulate">unify</a> <a id="2819" href="Reflection.External.html#2785" class="Bound">hole</a> <a id="2824" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2826" href="Reflection.External.html#2039" class="Function">quoteResult</a>


<a id="2840" class="Comment">-- Show a command for the user.</a>
<a id="showCmdSpec"></a><a id="2872" href="Reflection.External.html#2872" class="Function">showCmdSpec</a> <a id="2884" class="Symbol">:</a> <a id="2886" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="2894" class="Symbol">→</a> <a id="2896" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="2903" href="Reflection.External.html#2872" class="Function">showCmdSpec</a> <a id="2915" href="Reflection.External.html#2915" class="Bound">c</a> <a id="2917" class="Symbol">=</a> <a id="2919" href="Data.String.Base.html#2756" class="Function">String.unwords</a> <a id="2934" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2936" href="Reflection.External.html#1163" class="Field">CmdSpec.name</a> <a id="2949" href="Reflection.External.html#2915" class="Bound">c</a> <a id="2951" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2953" href="Reflection.External.html#1234" class="Field">CmdSpec.args</a> <a id="2966" href="Reflection.External.html#2915" class="Bound">c</a>


<a id="2970" class="Keyword">private</a>
  <a id="2980" class="Comment">-- Helper function for throwing an error from reflection.</a>
  <a id="userError"></a><a id="3040" href="Reflection.External.html#3040" class="Function">userError</a> <a id="3050" class="Symbol">:</a> <a id="3052" class="Symbol">∀</a> <a id="3054" class="Symbol">{</a><a id="3055" href="Reflection.External.html#3055" class="Bound">a</a><a id="3056" class="Symbol">}</a> <a id="3058" class="Symbol">{</a><a id="3059" href="Reflection.External.html#3059" class="Bound">A</a> <a id="3061" class="Symbol">:</a> <a id="3063" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3067" href="Reflection.External.html#3055" class="Bound">a</a><a id="3068" class="Symbol">}</a> <a id="3070" class="Symbol">→</a> <a id="3072" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="3080" class="Symbol">→</a> <a id="3082" href="Reflection.External.html#840" class="Function">StdOut</a> <a id="3089" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="3091" href="Reflection.External.html#823" class="Function">StdErr</a> <a id="3098" class="Symbol">→</a> <a id="3100" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="3103" href="Reflection.External.html#3059" class="Bound">A</a>
  <a id="3107" href="Reflection.External.html#3040" class="Function">userError</a> <a id="3117" href="Reflection.External.html#3117" class="Bound">c</a> <a id="3119" class="Symbol">(</a><a id="3120" href="Reflection.External.html#3120" class="Bound">stdout</a> <a id="3127" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3129" href="Reflection.External.html#3129" class="Bound">stderr</a><a id="3135" class="Symbol">)</a> <a id="3137" class="Symbol">=</a> <a id="3139" href="Agda.Builtin.Reflection.html#8492" class="Postulate">typeError</a> <a id="3149" class="Symbol">(</a><a id="3150" href="Agda.Builtin.Reflection.html#7900" class="InductiveConstructor">strErr</a> <a id="3157" href="Reflection.External.html#3186" class="Function">errMsg</a> <a id="3164" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3166" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3168" class="Symbol">)</a>
    <a id="3174" class="Keyword">where</a>
      <a id="3186" href="Reflection.External.html#3186" class="Function">errMsg</a> <a id="3193" class="Symbol">:</a> <a id="3195" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
      <a id="3208" href="Reflection.External.html#3186" class="Function">errMsg</a> <a id="3215" class="Symbol">=</a> <a id="3217" href="Data.String.Base.html#2814" class="Function">String.unlines</a>
             <a id="3245" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="3247" class="Symbol">(</a><a id="3248" class="String">&quot;Error while running command &#39;&quot;</a> <a id="3280" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3283" href="Reflection.External.html#2872" class="Function">showCmdSpec</a> <a id="3295" href="Reflection.External.html#3117" class="Bound">c</a> <a id="3297" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3300" class="String">&quot;&#39;&quot;</a><a id="3303" class="Symbol">)</a>
             <a id="3318" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3320" class="Symbol">(</a><a id="3321" class="String">&quot;Input:\n&quot;</a> <a id="3332" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3335" href="Reflection.External.html#1301" class="Field">CmdSpec.input</a> <a id="3349" href="Reflection.External.html#3117" class="Bound">c</a><a id="3350" class="Symbol">)</a>
             <a id="3365" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3367" class="Symbol">(</a><a id="3368" class="String">&quot;Output:\n&quot;</a> <a id="3380" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3383" href="Reflection.External.html#3120" class="Bound">stdout</a><a id="3389" class="Symbol">)</a>
             <a id="3404" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3406" class="Symbol">(</a><a id="3407" class="String">&quot;Error:\n&quot;</a> <a id="3418" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3421" href="Reflection.External.html#3129" class="Bound">stderr</a><a id="3427" class="Symbol">)</a>
             <a id="3442" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3444" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>


<a id="3449" class="Comment">-- Run command from specification. If the command succeeds, it returns the</a>
<a id="3524" class="Comment">-- contents of stdout. Otherwise, it throws a type error with the contents</a>
<a id="3599" class="Comment">-- of stderr.</a>
<a id="runCmdTC"></a><a id="3613" href="Reflection.External.html#3613" class="Function">runCmdTC</a> <a id="3622" class="Symbol">:</a> <a id="3624" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="3632" class="Symbol">→</a> <a id="3634" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="3637" href="Reflection.External.html#840" class="Function">StdOut</a>
<a id="3644" href="Reflection.External.html#3613" class="Function">runCmdTC</a> <a id="3653" href="Reflection.External.html#3653" class="Bound">c</a> <a id="3655" class="Symbol">=</a> <a id="3657" class="Keyword">do</a>
  <a id="3662" href="Reflection.External.html#3662" class="Bound">r</a> <a id="3664" href="Reflection.TCM.Syntax.html#676" class="Function Operator">←</a> <a id="3666" href="Reflection.External.html#2503" class="Function">unsafeRunCmdTC</a> <a id="3681" href="Reflection.External.html#3653" class="Bound">c</a>
  <a id="3685" class="Keyword">let</a> <a id="3689" href="Reflection.External.html#3689" class="Bound">debugPrefix</a> <a id="3701" class="Symbol">=</a> <a id="3703" class="Symbol">(</a><a id="3704" class="String">&quot;user.&quot;</a> <a id="3712" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3715" href="Reflection.External.html#1163" class="Field">CmdSpec.name</a> <a id="3728" href="Reflection.External.html#3653" class="Bound">c</a><a id="3729" class="Symbol">)</a>
  <a id="3733" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="3738" href="Reflection.External.html#1445" class="Field">Result.exitCode</a> <a id="3754" href="Reflection.External.html#3662" class="Bound">r</a> <a id="3756" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="3759" class="Symbol">λ</a>
    <a id="3765" class="Symbol">{</a> <a id="3767" href="Reflection.External.html#993" class="InductiveConstructor">exitSuccess</a> <a id="3779" class="Symbol">→</a> <a id="3781" class="Keyword">do</a>
      <a id="3790" href="Agda.Builtin.Reflection.html#10141" class="Postulate">debugPrint</a> <a id="3801" class="Symbol">(</a><a id="3802" href="Reflection.External.html#3689" class="Bound">debugPrefix</a> <a id="3814" href="Data.String.Base.html#2413" class="Function Operator">++</a> <a id="3817" class="String">&quot;.stderr&quot;</a><a id="3826" class="Symbol">)</a> <a id="3828" class="Number">10</a> <a id="3831" class="Symbol">(</a><a id="3832" href="Agda.Builtin.Reflection.html#7900" class="InductiveConstructor">strErr</a> <a id="3839" class="Symbol">(</a><a id="3840" href="Reflection.External.html#1565" class="Field">Result.error</a> <a id="3853" href="Reflection.External.html#3662" class="Bound">r</a><a id="3854" class="Symbol">)</a> <a id="3856" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3858" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3860" class="Symbol">)</a>
      <a id="3868" href="Reflection.TCM.html#1025" class="Postulate">return</a> <a id="3875" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="3877" href="Reflection.External.html#1508" class="Field">Result.output</a> <a id="3891" href="Reflection.External.html#3662" class="Bound">r</a>
    <a id="3897" class="Symbol">;</a> <a id="3899" class="Symbol">(</a><a id="3900" href="Reflection.External.html#1018" class="InductiveConstructor">exitFailure</a> <a id="3912" href="Reflection.External.html#3912" class="Bound">n</a><a id="3913" class="Symbol">)</a> <a id="3915" class="Symbol">→</a> <a id="3917" class="Keyword">do</a>
      <a id="3926" href="Reflection.External.html#3040" class="Function">userError</a> <a id="3936" href="Reflection.External.html#3653" class="Bound">c</a> <a id="3938" class="Symbol">(</a><a id="3939" href="Reflection.External.html#1508" class="Field">Result.output</a> <a id="3953" href="Reflection.External.html#3662" class="Bound">r</a> <a id="3955" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3957" href="Reflection.External.html#1565" class="Field">Result.error</a> <a id="3970" href="Reflection.External.html#3662" class="Bound">r</a><a id="3971" class="Symbol">)</a>
    <a id="3977" class="Symbol">}</a>

<a id="3980" class="Keyword">macro</a>
  <a id="runCmd"></a><a id="3988" href="Reflection.External.html#3988" class="Function">runCmd</a> <a id="3995" class="Symbol">:</a> <a id="3997" href="Reflection.External.html#1109" class="Record">CmdSpec</a> <a id="4005" class="Symbol">→</a> <a id="4007" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a> <a id="4012" class="Symbol">→</a> <a id="4014" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="4017" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
  <a id="4021" href="Reflection.External.html#3988" class="Function">runCmd</a> <a id="4028" href="Reflection.External.html#4028" class="Bound">c</a> <a id="4030" href="Reflection.External.html#4030" class="Bound">hole</a> <a id="4035" class="Symbol">=</a> <a id="4037" href="Reflection.External.html#3613" class="Function">runCmdTC</a> <a id="4046" href="Reflection.External.html#4028" class="Bound">c</a> <a id="4048" href="Reflection.TCM.Syntax.html#676" class="Function Operator">&gt;&gt;=</a> <a id="4052" href="Agda.Builtin.Reflection.html#8452" class="Postulate">unify</a> <a id="4058" href="Reflection.External.html#4030" class="Bound">hole</a> <a id="4063" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4065" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="4069" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4071" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a>
</pre></body></html>